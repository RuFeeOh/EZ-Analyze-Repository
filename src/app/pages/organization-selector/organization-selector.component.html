<div class="org-page">
        <div class="org-list">
                <h2>Select Your Organization</h2>
                <div class="org-grid">
                        @for (org of organizationList(); track org.Uid) {
                        <div class="org-chip"
                             [class.active]="currentOrg()?.Uid === org.Uid"
                             [class.editing]="editingOrgId === org.Uid"
                             role="button"
                             tabindex="0"
                             (click)="editingOrgId === org.Uid ? null : setOrganization(org)"
                             (keydown.enter)="editingOrgId === org.Uid ? null : setOrganization(org)"
                             (keydown.space)="editingOrgId === org.Uid ? null : setOrganization(org)"
                             [matTooltip]="editingOrgId === org.Uid ? 'Editing...' : 'Use this organization'">
                                <organization-circle [org]="org"></organization-circle>
                                @if (editingOrgId === org.Uid) {
                                <input class="edit-input"
                                       [(ngModel)]="editingOrgName"
                                       [disabled]="saving"
                                       (click)="$event.stopPropagation()"
                                       (keydown.enter)="confirmEdit(org)"
                                       (keydown.escape)="cancelEdit()"
                                       #editInput />
                                <button mat-icon-button
                                        type="button"
                                        class="icon-btn"
                                        [disabled]="saving"
                                        (click)="confirmEdit(org); $event.stopPropagation()">
                                        <mat-icon>check</mat-icon>
                                </button>
                                <button mat-icon-button
                                        type="button"
                                        class="icon-btn"
                                        [disabled]="saving"
                                        (click)="cancelEdit(); $event.stopPropagation()">
                                        <mat-icon>close</mat-icon>
                                </button>
                                } @else {
                                <span class="label">{{ org.Name }}</span>
                                <button mat-icon-button
                                        type="button"
                                        class="icon-btn"
                                        aria-label="More actions"
                                        [matMenuTriggerFor]="menu"
                                        (click)="$event.stopPropagation()"
                                        (keydown)="$event.stopPropagation()">
                                        <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                        <button mat-menu-item
                                                (click)="beginEdit(org, $event)">
                                                <mat-icon>edit</mat-icon>
                                                <span>Edit</span>
                                        </button>
                                        <button mat-menu-item
                                                (click)="confirmDelete(org)">
                                                <mat-icon>delete</mat-icon>
                                                <span>Delete</span>
                                        </button>
                                </mat-menu>
                                }
                        </div>
                        }
                </div>
        </div>

        <div class="org-create">
                <h3>My organization isn’t listed</h3>
                <form class="create-row"
                      (ngSubmit)="saveOrganization()">
                        <mat-form-field appearance="fill"
                                        class="name-field">
                                <mat-label>Organization name</mat-label>
                                <input matInput
                                       [(ngModel)]="organizationName"
                                       name="newOrg"
                                       placeholder="Organization"
                                       [disabled]="saving"
                                       required />
                        </mat-form-field>
                        <button mat-flat-button
                                color="primary"
                                type="submit"
                                [disabled]="saving || !organizationName.trim()">
                                <ng-container *ngIf="!saving; else savingTpl">Save</ng-container>
                        </button>
                        <ng-template #savingTpl>
                                <span style="display:inline-flex; align-items:center; gap:6px;">
                                        <mat-icon inline>hourglass_top</mat-icon>
                                        Saving…
                                </span>
                        </ng-template>
                </form>
        </div>
</div>