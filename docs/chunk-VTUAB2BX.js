import{a as pd,b as gd,e as ja,f as P}from"./chunk-USWKGUWN.js";var yd=()=>{};var vd=function(n){let t=[],e=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?t[e++]=i:i<2048?(t[e++]=i>>6|192,t[e++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=i>>18|240,t[e++]=i>>12&63|128,t[e++]=i>>6&63|128,t[e++]=i&63|128):(t[e++]=i>>12|224,t[e++]=i>>6&63|128,t[e++]=i&63|128)}return t},oy=function(n){let t=[],e=0,r=0;for(;e<n.length;){let i=n[e++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=n[e++];t[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){let s=n[e++],o=n[e++],u=n[e++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(c>>10)),t[r++]=String.fromCharCode(56320+(c&1023))}else{let s=n[e++],o=n[e++];t[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return t.join("")},Ed={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){let s=n[i],o=i+1<n.length,u=o?n[i+1]:0,c=i+2<n.length,h=c?n[i+2]:0,f=s>>2,m=(s&3)<<4|u>>4,g=(u&15)<<2|h>>6,T=h&63;c||(T=64,o||(g=64)),r.push(e[f],e[m],e[g],e[T])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(vd(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):oy(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){let s=e[n.charAt(i++)],u=i<n.length?e[n.charAt(i)]:0;++i;let h=i<n.length?e[n.charAt(i)]:64;++i;let m=i<n.length?e[n.charAt(i)]:64;if(++i,s==null||u==null||h==null||m==null)throw new $a;let g=s<<2|u>>4;if(r.push(g),h!==64){let T=u<<4&240|h>>2;if(r.push(T),m!==64){let D=h<<6&192|m;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},$a=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},ay=function(n){let t=vd(n);return Ed.encodeByteArray(t,!0)},ii=function(n){return ay(n).replace(/\./g,"")},Id=function(n){try{return Ed.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ka(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var uy=()=>Ka().__FIREBASE_DEFAULTS__,cy=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},ly=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&Id(n[1]);return t&&JSON.parse(t)},Cs=()=>{try{return yd()||uy()||cy()||ly()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},hy=n=>{var t,e;return(e=(t=Cs())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},Td=n=>{let t=hy(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Wa=()=>{var n;return(n=Cs())===null||n===void 0?void 0:n.config},Mv=n=>{var t;return(t=Cs())===null||t===void 0?void 0:t[`_${n}`]};var Ps=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}};function oi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Qa(n){return P(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function bd(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},r=t||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ii(JSON.stringify(e)),ii(JSON.stringify(o)),""].join(".")}var ri={};function dy(){let n={prod:[],emulator:[]};for(let t of Object.keys(ri))ri[t]?n.emulator.push(t):n.prod.push(t);return n}function fy(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}var _d=!1;function Ad(n,t){if(typeof window>"u"||typeof document>"u"||!oi(window.location.host)||ri[n]===t||ri[n]||_d)return;ri[n]=t;function e(g){return`__firebase__banner__${g}`}let r="__firebase__banner",s=dy().prod.length>0;function o(){let g=document.getElementById(r);g&&g.remove()}function u(g){g.style.display="flex",g.style.background="#7faaf0",g.style.position="fixed",g.style.bottom="5px",g.style.left="5px",g.style.padding=".5em",g.style.borderRadius="5px",g.style.alignItems="center"}function c(g,T){g.setAttribute("width","24"),g.setAttribute("id",T),g.setAttribute("height","24"),g.setAttribute("viewBox","0 0 24 24"),g.setAttribute("fill","none"),g.style.marginLeft="-6px"}function h(){let g=document.createElement("span");return g.style.cursor="pointer",g.style.marginLeft="16px",g.style.fontSize="24px",g.innerHTML=" &times;",g.onclick=()=>{_d=!0,o()},g}function f(g,T){g.setAttribute("id",T),g.innerText="Learn more",g.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",g.setAttribute("target","__blank"),g.style.paddingLeft="5px",g.style.textDecoration="underline"}function m(){let g=fy(r),T=e("text"),D=document.getElementById(T)||document.createElement("span"),x=e("learnmore"),N=document.getElementById(x)||document.createElement("a"),B=e("preprendIcon"),j=document.getElementById(B)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(g.created){let U=g.element;u(U),f(N,x);let W=h();c(j,B),U.append(j,D,N,W),document.body.appendChild(U)}s?(D.innerText="Preview backend disconnected.",j.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(j.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,D.innerText="Preview backend running in this workspace."),D.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",m):m()}function ln(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Lv(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ln())}function Sd(){var n;let t=(n=Cs())===null||n===void 0?void 0:n.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Bv(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Uv(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function qv(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function jv(){let n=ln();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Ha(){return!Sd()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Xa(){return!Sd()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function Ds(){try{return typeof indexedDB=="object"}catch{return!1}}function Rd(){return new Promise((n,t)=>{try{let e=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{e=!1},i.onerror=()=>{var s;t(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(e){t(e)}})}var my="FirebaseError",fe=class n extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=my,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,si.prototype.create)}},si=class{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){let r=e[0]||{},i=`${this.service}/${t}`,s=this.errors[t],o=s?py(s,r):"Error",u=`${this.serviceName}: ${o} (${i}).`;return new fe(i,u,r)}};function py(n,t){return n.replace(gy,(e,r)=>{let i=t[r];return i!=null?String(i):`<${r}?>`})}var gy=/\{\$([^}]+)}/g;function zv(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function Yt(n,t){if(n===t)return!0;let e=Object.keys(n),r=Object.keys(t);for(let i of e){if(!r.includes(i))return!1;let s=n[i],o=t[i];if(wd(s)&&wd(o)){if(!Yt(s,o))return!1}else if(s!==o)return!1}for(let i of r)if(!e.includes(i))return!1;return!0}function wd(n){return n!==null&&typeof n=="object"}function $v(n){let t=[];for(let[e,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function Gv(n,t){let e=new Ga(n,t);return e.subscribe.bind(e)}var Ga=class{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(r=>{this.error(r)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,r){let i;if(t===void 0&&e===void 0&&r===void 0)throw new Error("Missing Observer.");yy(t,["next","error","complete"])?i=t:i={next:t,error:e,complete:r},i.next===void 0&&(i.next=za),i.error===void 0&&(i.error=za),i.complete===void 0&&(i.complete=za);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function yy(n,t){if(typeof n!="object"||n===null)return!1;for(let e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function za(){}var Kv=14400*1e3;function gt(n){return n&&n._delegate?n._delegate:n}var me=class{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var hn="[DEFAULT]";var Ja=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let r=new Ps;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{let i=this.getOrInitializeService({instanceIdentifier:e});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let r=this.normalizeInstanceIdentifier(t?.identifier),i=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(wy(t))try{this.getOrInitializeService({instanceIdentifier:hn})}catch{}for(let[e,r]of this.instancesDeferred.entries()){let i=this.normalizeInstanceIdentifier(e);try{let s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(t=hn){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return P(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=hn){return this.instances.has(t)}getOptions(t=hn){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:r,options:e});for(let[s,o]of this.instancesDeferred.entries()){let u=this.normalizeInstanceIdentifier(s);r===u&&o.resolve(i)}return i}onInit(t,e){var r;let i=this.normalizeInstanceIdentifier(e),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(t),this.onInitCallbacks.set(i,s);let o=this.instances.get(i);return o&&t(o,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){let r=this.onInitCallbacks.get(e);if(r)for(let i of r)try{i(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:_y(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=hn){return this.component?this.component.multipleInstances?t:hn:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function _y(n){return n===hn?void 0:n}function wy(n){return n.instantiationMode==="EAGER"}var Vs=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Ja(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var vy=[],J=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(J||{}),Ey={debug:J.DEBUG,verbose:J.VERBOSE,info:J.INFO,warn:J.WARN,error:J.ERROR,silent:J.SILENT},Iy=J.INFO,Ty={[J.DEBUG]:"log",[J.VERBOSE]:"log",[J.INFO]:"info",[J.WARN]:"warn",[J.ERROR]:"error"},by=(n,t,...e)=>{if(t<n.logLevel)return;let r=new Date().toISOString(),i=Ty[t];if(i)console[i](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},zn=class{constructor(t){this.name=t,this._logLevel=Iy,this._logHandler=by,this._userLogHandler=null,vy.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in J))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ey[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,J.DEBUG,...t),this._logHandler(this,J.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,J.VERBOSE,...t),this._logHandler(this,J.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,J.INFO,...t),this._logHandler(this,J.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,J.WARN,...t),this._logHandler(this,J.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,J.ERROR,...t),this._logHandler(this,J.ERROR,...t)}};var Ay=(n,t)=>t.some(e=>n instanceof e),Pd,Cd;function Sy(){return Pd||(Pd=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Ry(){return Cd||(Cd=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var Dd=new WeakMap,Za=new WeakMap,Vd=new WeakMap,Ya=new WeakMap,eu=new WeakMap;function Py(n){let t=new Promise((e,r)=>{let i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{e(Zt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Dd.set(e,n)}).catch(()=>{}),eu.set(t,n),t}function Cy(n){if(Za.has(n))return;let t=new Promise((e,r)=>{let i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{e(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Za.set(n,t)}var tu={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Za.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Vd.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Zt(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function xd(n){tu=n(tu)}function Dy(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let r=n.call(xs(this),t,...e);return Vd.set(r,t.sort?t.sort():[t]),Zt(r)}:Ry().includes(n)?function(...t){return n.apply(xs(this),t),Zt(Dd.get(this))}:function(...t){return Zt(n.apply(xs(this),t))}}function Vy(n){return typeof n=="function"?Dy(n):(n instanceof IDBTransaction&&Cy(n),Ay(n,Sy())?new Proxy(n,tu):n)}function Zt(n){if(n instanceof IDBRequest)return Py(n);if(Ya.has(n))return Ya.get(n);let t=Vy(n);return t!==n&&(Ya.set(n,t),eu.set(t,n)),t}var xs=n=>eu.get(n);function kd(n,t,{blocked:e,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(n,t),u=Zt(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Zt(o.result),c.oldVersion,c.newVersion,Zt(o.transaction),c)}),e&&o.addEventListener("blocked",c=>e(c.oldVersion,c.newVersion,c)),u.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",h=>i(h.oldVersion,h.newVersion,h))}).catch(()=>{}),u}var xy=["get","getKey","getAll","getAllKeys","count"],Ny=["put","add","delete","clear"],nu=new Map;function Nd(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(nu.get(t))return nu.get(t);let e=t.replace(/FromIndex$/,""),r=t!==e,i=Ny.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(i||xy.includes(e)))return;let s=function(o,...u){return P(this,null,function*(){let c=this.transaction(o,i?"readwrite":"readonly"),h=c.store;return r&&(h=h.index(u.shift())),(yield Promise.all([h[e](...u),i&&c.done]))[0]})};return nu.set(t,s),s}xd(n=>gd(pd({},n),{get:(t,e,r)=>Nd(t,e)||n.get(t,e,r),has:(t,e)=>!!Nd(t,e)||n.has(t,e)}));var iu=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(ky(e)){let r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}};function ky(n){let t=n.getComponent();return t?.type==="VERSION"}var su="@firebase/app",Od="0.13.2";var pe=new zn("@firebase/app"),Oy="@firebase/app-compat",Fy="@firebase/analytics-compat",My="@firebase/analytics",Ly="@firebase/app-check-compat",By="@firebase/app-check",Uy="@firebase/auth",qy="@firebase/auth-compat",jy="@firebase/database",zy="@firebase/data-connect",$y="@firebase/database-compat",Gy="@firebase/functions",Ky="@firebase/functions-compat",Wy="@firebase/installations",Qy="@firebase/installations-compat",Hy="@firebase/messaging",Xy="@firebase/messaging-compat",Jy="@firebase/performance",Yy="@firebase/performance-compat",Zy="@firebase/remote-config",t_="@firebase/remote-config-compat",e_="@firebase/storage",n_="@firebase/storage-compat",r_="@firebase/firestore",i_="@firebase/ai",s_="@firebase/firestore-compat",o_="firebase",a_="11.10.0";var Ns="[DEFAULT]",u_={[su]:"fire-core",[Oy]:"fire-core-compat",[My]:"fire-analytics",[Fy]:"fire-analytics-compat",[By]:"fire-app-check",[Ly]:"fire-app-check-compat",[Uy]:"fire-auth",[qy]:"fire-auth-compat",[jy]:"fire-rtdb",[zy]:"fire-data-connect",[$y]:"fire-rtdb-compat",[Gy]:"fire-fn",[Ky]:"fire-fn-compat",[Wy]:"fire-iid",[Qy]:"fire-iid-compat",[Hy]:"fire-fcm",[Xy]:"fire-fcm-compat",[Jy]:"fire-perf",[Yy]:"fire-perf-compat",[Zy]:"fire-rc",[t_]:"fire-rc-compat",[e_]:"fire-gcs",[n_]:"fire-gcs-compat",[r_]:"fire-fst",[s_]:"fire-fst-compat",[i_]:"fire-vertex","fire-js":"fire-js",[o_]:"fire-js-all"};var ai=new Map,c_=new Map,ou=new Map;function Fd(n,t){try{n.container.addComponent(t)}catch(e){pe.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function ui(n){let t=n.name;if(ou.has(t))return pe.debug(`There were multiple attempts to register component ${t}.`),!1;ou.set(t,n);for(let e of ai.values())Fd(e,n);for(let e of c_.values())Fd(e,n);return!0}function ks(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Ud(n,t,e=Ns){ks(n,t).clearInstance(e)}function qd(n){return n==null?!1:n.settings!==void 0}var l_={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Ne=new si("app","Firebase",l_);var au=class{constructor(t,e,r){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new me("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Ne.create("app-deleted",{appName:this._name})}};var jd=a_;function h_(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let r=Object.assign({name:Ns,automaticDataCollectionEnabled:!0},t),i=r.name;if(typeof i!="string"||!i)throw Ne.create("bad-app-name",{appName:String(i)});if(e||(e=Wa()),!e)throw Ne.create("no-options");let s=ai.get(i);if(s){if(Yt(e,s.options)&&Yt(r,s.config))return s;throw Ne.create("duplicate-app",{appName:i})}let o=new Vs(i);for(let c of ou.values())o.addComponent(c);let u=new au(e,r,o);return ai.set(i,u),u}function zd(n=Ns){let t=ai.get(n);if(!t&&n===Ns&&Wa())return h_();if(!t)throw Ne.create("no-app",{appName:n});return t}function dE(){return Array.from(ai.values())}function $n(n,t,e){var r;let i=(r=u_[n])!==null&&r!==void 0?r:n;e&&(i+=`-${e}`);let s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let u=[`Unable to register library "${i}" with version "${t}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&u.push("and"),o&&u.push(`version name "${t}" contains illegal characters (whitespace or "/")`),pe.warn(u.join(" "));return}ui(new me(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}var d_="firebase-heartbeat-database",f_=1,ci="firebase-heartbeat-store",ru=null;function $d(){return ru||(ru=kd(d_,f_,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(ci)}catch(e){console.warn(e)}}}}).catch(n=>{throw Ne.create("idb-open",{originalErrorMessage:n.message})})),ru}function m_(n){return P(this,null,function*(){try{let e=(yield $d()).transaction(ci),r=yield e.objectStore(ci).get(Gd(n));return yield e.done,r}catch(t){if(t instanceof fe)pe.warn(t.message);else{let e=Ne.create("idb-get",{originalErrorMessage:t?.message});pe.warn(e.message)}}})}function Md(n,t){return P(this,null,function*(){try{let r=(yield $d()).transaction(ci,"readwrite");yield r.objectStore(ci).put(t,Gd(n)),yield r.done}catch(e){if(e instanceof fe)pe.warn(e.message);else{let r=Ne.create("idb-set",{originalErrorMessage:e?.message});pe.warn(r.message)}}})}function Gd(n){return`${n.name}!${n.options.appId}`}var p_=1024,g_=30,uu=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new cu(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}triggerHeartbeat(){return P(this,null,function*(){var t,e;try{let i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=Ld();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats.length>g_){let o=__(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){pe.warn(r)}})}getHeartbeatsHeader(){return P(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=Ld(),{heartbeatsToSend:r,unsentEntries:i}=y_(this._heartbeatsCache.heartbeats),s=ii(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return pe.warn(e),""}})}};function Ld(){return new Date().toISOString().substring(0,10)}function y_(n,t=p_){let e=[],r=n.slice();for(let i of n){let s=e.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),Bd(e)>t){s.dates.pop();break}}else if(e.push({agent:i.agent,dates:[i.date]}),Bd(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}var cu=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return P(this,null,function*(){return Ds()?Rd().then(()=>!0).catch(()=>!1):!1})}read(){return P(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield m_(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return P(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Md(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return P(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let i=yield this.read();return Md(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return})}};function Bd(n){return ii(JSON.stringify({version:2,heartbeats:n})).length}function __(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function w_(n){ui(new me("platform-logger",t=>new iu(t),"PRIVATE")),ui(new me("heartbeat",t=>new uu(t),"PRIVATE")),$n(su,Od,n),$n(su,Od,"esm2017"),$n("fire-js","")}w_("");var Kd=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wd={};var ge,lu;(function(){var n;function t(v,y){function w(){}w.prototype=y.prototype,v.D=y.prototype,v.prototype=new w,v.prototype.constructor=v,v.C=function(E,I,S){for(var _=Array(arguments.length-2),le=2;le<arguments.length;le++)_[le-2]=arguments[le];return y.prototype[I].apply(E,_)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(r,e),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(v,y,w){w||(w=0);var E=Array(16);if(typeof y=="string")for(var I=0;16>I;++I)E[I]=y.charCodeAt(w++)|y.charCodeAt(w++)<<8|y.charCodeAt(w++)<<16|y.charCodeAt(w++)<<24;else for(I=0;16>I;++I)E[I]=y[w++]|y[w++]<<8|y[w++]<<16|y[w++]<<24;y=v.g[0],w=v.g[1],I=v.g[2];var S=v.g[3],_=y+(S^w&(I^S))+E[0]+3614090360&4294967295;y=w+(_<<7&4294967295|_>>>25),_=S+(I^y&(w^I))+E[1]+3905402710&4294967295,S=y+(_<<12&4294967295|_>>>20),_=I+(w^S&(y^w))+E[2]+606105819&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(y^I&(S^y))+E[3]+3250441966&4294967295,w=I+(_<<22&4294967295|_>>>10),_=y+(S^w&(I^S))+E[4]+4118548399&4294967295,y=w+(_<<7&4294967295|_>>>25),_=S+(I^y&(w^I))+E[5]+1200080426&4294967295,S=y+(_<<12&4294967295|_>>>20),_=I+(w^S&(y^w))+E[6]+2821735955&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(y^I&(S^y))+E[7]+4249261313&4294967295,w=I+(_<<22&4294967295|_>>>10),_=y+(S^w&(I^S))+E[8]+1770035416&4294967295,y=w+(_<<7&4294967295|_>>>25),_=S+(I^y&(w^I))+E[9]+2336552879&4294967295,S=y+(_<<12&4294967295|_>>>20),_=I+(w^S&(y^w))+E[10]+4294925233&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(y^I&(S^y))+E[11]+2304563134&4294967295,w=I+(_<<22&4294967295|_>>>10),_=y+(S^w&(I^S))+E[12]+1804603682&4294967295,y=w+(_<<7&4294967295|_>>>25),_=S+(I^y&(w^I))+E[13]+4254626195&4294967295,S=y+(_<<12&4294967295|_>>>20),_=I+(w^S&(y^w))+E[14]+2792965006&4294967295,I=S+(_<<17&4294967295|_>>>15),_=w+(y^I&(S^y))+E[15]+1236535329&4294967295,w=I+(_<<22&4294967295|_>>>10),_=y+(I^S&(w^I))+E[1]+4129170786&4294967295,y=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(y^w))+E[6]+3225465664&4294967295,S=y+(_<<9&4294967295|_>>>23),_=I+(y^w&(S^y))+E[11]+643717713&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^y&(I^S))+E[0]+3921069994&4294967295,w=I+(_<<20&4294967295|_>>>12),_=y+(I^S&(w^I))+E[5]+3593408605&4294967295,y=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(y^w))+E[10]+38016083&4294967295,S=y+(_<<9&4294967295|_>>>23),_=I+(y^w&(S^y))+E[15]+3634488961&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^y&(I^S))+E[4]+3889429448&4294967295,w=I+(_<<20&4294967295|_>>>12),_=y+(I^S&(w^I))+E[9]+568446438&4294967295,y=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(y^w))+E[14]+3275163606&4294967295,S=y+(_<<9&4294967295|_>>>23),_=I+(y^w&(S^y))+E[3]+4107603335&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^y&(I^S))+E[8]+1163531501&4294967295,w=I+(_<<20&4294967295|_>>>12),_=y+(I^S&(w^I))+E[13]+2850285829&4294967295,y=w+(_<<5&4294967295|_>>>27),_=S+(w^I&(y^w))+E[2]+4243563512&4294967295,S=y+(_<<9&4294967295|_>>>23),_=I+(y^w&(S^y))+E[7]+1735328473&4294967295,I=S+(_<<14&4294967295|_>>>18),_=w+(S^y&(I^S))+E[12]+2368359562&4294967295,w=I+(_<<20&4294967295|_>>>12),_=y+(w^I^S)+E[5]+4294588738&4294967295,y=w+(_<<4&4294967295|_>>>28),_=S+(y^w^I)+E[8]+2272392833&4294967295,S=y+(_<<11&4294967295|_>>>21),_=I+(S^y^w)+E[11]+1839030562&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^y)+E[14]+4259657740&4294967295,w=I+(_<<23&4294967295|_>>>9),_=y+(w^I^S)+E[1]+2763975236&4294967295,y=w+(_<<4&4294967295|_>>>28),_=S+(y^w^I)+E[4]+1272893353&4294967295,S=y+(_<<11&4294967295|_>>>21),_=I+(S^y^w)+E[7]+4139469664&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^y)+E[10]+3200236656&4294967295,w=I+(_<<23&4294967295|_>>>9),_=y+(w^I^S)+E[13]+681279174&4294967295,y=w+(_<<4&4294967295|_>>>28),_=S+(y^w^I)+E[0]+3936430074&4294967295,S=y+(_<<11&4294967295|_>>>21),_=I+(S^y^w)+E[3]+3572445317&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^y)+E[6]+76029189&4294967295,w=I+(_<<23&4294967295|_>>>9),_=y+(w^I^S)+E[9]+3654602809&4294967295,y=w+(_<<4&4294967295|_>>>28),_=S+(y^w^I)+E[12]+3873151461&4294967295,S=y+(_<<11&4294967295|_>>>21),_=I+(S^y^w)+E[15]+530742520&4294967295,I=S+(_<<16&4294967295|_>>>16),_=w+(I^S^y)+E[2]+3299628645&4294967295,w=I+(_<<23&4294967295|_>>>9),_=y+(I^(w|~S))+E[0]+4096336452&4294967295,y=w+(_<<6&4294967295|_>>>26),_=S+(w^(y|~I))+E[7]+1126891415&4294967295,S=y+(_<<10&4294967295|_>>>22),_=I+(y^(S|~w))+E[14]+2878612391&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~y))+E[5]+4237533241&4294967295,w=I+(_<<21&4294967295|_>>>11),_=y+(I^(w|~S))+E[12]+1700485571&4294967295,y=w+(_<<6&4294967295|_>>>26),_=S+(w^(y|~I))+E[3]+2399980690&4294967295,S=y+(_<<10&4294967295|_>>>22),_=I+(y^(S|~w))+E[10]+4293915773&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~y))+E[1]+2240044497&4294967295,w=I+(_<<21&4294967295|_>>>11),_=y+(I^(w|~S))+E[8]+1873313359&4294967295,y=w+(_<<6&4294967295|_>>>26),_=S+(w^(y|~I))+E[15]+4264355552&4294967295,S=y+(_<<10&4294967295|_>>>22),_=I+(y^(S|~w))+E[6]+2734768916&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~y))+E[13]+1309151649&4294967295,w=I+(_<<21&4294967295|_>>>11),_=y+(I^(w|~S))+E[4]+4149444226&4294967295,y=w+(_<<6&4294967295|_>>>26),_=S+(w^(y|~I))+E[11]+3174756917&4294967295,S=y+(_<<10&4294967295|_>>>22),_=I+(y^(S|~w))+E[2]+718787259&4294967295,I=S+(_<<15&4294967295|_>>>17),_=w+(S^(I|~y))+E[9]+3951481745&4294967295,v.g[0]=v.g[0]+y&4294967295,v.g[1]=v.g[1]+(I+(_<<21&4294967295|_>>>11))&4294967295,v.g[2]=v.g[2]+I&4294967295,v.g[3]=v.g[3]+S&4294967295}r.prototype.u=function(v,y){y===void 0&&(y=v.length);for(var w=y-this.blockSize,E=this.B,I=this.h,S=0;S<y;){if(I==0)for(;S<=w;)i(this,v,S),S+=this.blockSize;if(typeof v=="string"){for(;S<y;)if(E[I++]=v.charCodeAt(S++),I==this.blockSize){i(this,E),I=0;break}}else for(;S<y;)if(E[I++]=v[S++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=y},r.prototype.v=function(){var v=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);v[0]=128;for(var y=1;y<v.length-8;++y)v[y]=0;var w=8*this.o;for(y=v.length-8;y<v.length;++y)v[y]=w&255,w/=256;for(this.u(v),v=Array(16),y=w=0;4>y;++y)for(var E=0;32>E;E+=8)v[w++]=this.g[y]>>>E&255;return v};function s(v,y){var w=u;return Object.prototype.hasOwnProperty.call(w,v)?w[v]:w[v]=y(v)}function o(v,y){this.h=y;for(var w=[],E=!0,I=v.length-1;0<=I;I--){var S=v[I]|0;E&&S==y||(w[I]=S,E=!1)}this.g=w}var u={};function c(v){return-128<=v&&128>v?s(v,function(y){return new o([y|0],0>y?-1:0)}):new o([v|0],0>v?-1:0)}function h(v){if(isNaN(v)||!isFinite(v))return m;if(0>v)return N(h(-v));for(var y=[],w=1,E=0;v>=w;E++)y[E]=v/w|0,w*=4294967296;return new o(y,0)}function f(v,y){if(v.length==0)throw Error("number format error: empty string");if(y=y||10,2>y||36<y)throw Error("radix out of range: "+y);if(v.charAt(0)=="-")return N(f(v.substring(1),y));if(0<=v.indexOf("-"))throw Error('number format error: interior "-" character');for(var w=h(Math.pow(y,8)),E=m,I=0;I<v.length;I+=8){var S=Math.min(8,v.length-I),_=parseInt(v.substring(I,I+S),y);8>S?(S=h(Math.pow(y,S)),E=E.j(S).add(h(_))):(E=E.j(w),E=E.add(h(_)))}return E}var m=c(0),g=c(1),T=c(16777216);n=o.prototype,n.m=function(){if(x(this))return-N(this).m();for(var v=0,y=1,w=0;w<this.g.length;w++){var E=this.i(w);v+=(0<=E?E:4294967296+E)*y,y*=4294967296}return v},n.toString=function(v){if(v=v||10,2>v||36<v)throw Error("radix out of range: "+v);if(D(this))return"0";if(x(this))return"-"+N(this).toString(v);for(var y=h(Math.pow(v,6)),w=this,E="";;){var I=W(w,y).g;w=B(w,I.j(y));var S=((0<w.g.length?w.g[0]:w.h)>>>0).toString(v);if(w=I,D(w))return S+E;for(;6>S.length;)S="0"+S;E=S+E}},n.i=function(v){return 0>v?0:v<this.g.length?this.g[v]:this.h};function D(v){if(v.h!=0)return!1;for(var y=0;y<v.g.length;y++)if(v.g[y]!=0)return!1;return!0}function x(v){return v.h==-1}n.l=function(v){return v=B(this,v),x(v)?-1:D(v)?0:1};function N(v){for(var y=v.g.length,w=[],E=0;E<y;E++)w[E]=~v.g[E];return new o(w,~v.h).add(g)}n.abs=function(){return x(this)?N(this):this},n.add=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],E=0,I=0;I<=y;I++){var S=E+(this.i(I)&65535)+(v.i(I)&65535),_=(S>>>16)+(this.i(I)>>>16)+(v.i(I)>>>16);E=_>>>16,S&=65535,_&=65535,w[I]=_<<16|S}return new o(w,w[w.length-1]&-2147483648?-1:0)};function B(v,y){return v.add(N(y))}n.j=function(v){if(D(this)||D(v))return m;if(x(this))return x(v)?N(this).j(N(v)):N(N(this).j(v));if(x(v))return N(this.j(N(v)));if(0>this.l(T)&&0>v.l(T))return h(this.m()*v.m());for(var y=this.g.length+v.g.length,w=[],E=0;E<2*y;E++)w[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<v.g.length;I++){var S=this.i(E)>>>16,_=this.i(E)&65535,le=v.i(I)>>>16,Lr=v.i(I)&65535;w[2*E+2*I]+=_*Lr,j(w,2*E+2*I),w[2*E+2*I+1]+=S*Lr,j(w,2*E+2*I+1),w[2*E+2*I+1]+=_*le,j(w,2*E+2*I+1),w[2*E+2*I+2]+=S*le,j(w,2*E+2*I+2)}for(E=0;E<y;E++)w[E]=w[2*E+1]<<16|w[2*E];for(E=y;E<2*y;E++)w[E]=0;return new o(w,0)};function j(v,y){for(;(v[y]&65535)!=v[y];)v[y+1]+=v[y]>>>16,v[y]&=65535,y++}function U(v,y){this.g=v,this.h=y}function W(v,y){if(D(y))throw Error("division by zero");if(D(v))return new U(m,m);if(x(v))return y=W(N(v),y),new U(N(y.g),N(y.h));if(x(y))return y=W(v,N(y)),new U(N(y.g),y.h);if(30<v.g.length){if(x(v)||x(y))throw Error("slowDivide_ only works with positive integers.");for(var w=g,E=y;0>=E.l(v);)w=tt(w),E=tt(E);var I=K(w,1),S=K(E,1);for(E=K(E,2),w=K(w,2);!D(E);){var _=S.add(E);0>=_.l(v)&&(I=I.add(w),S=_),E=K(E,1),w=K(w,1)}return y=B(v,I.j(y)),new U(I,y)}for(I=m;0<=v.l(y);){for(w=Math.max(1,Math.floor(v.m()/y.m())),E=Math.ceil(Math.log(w)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),S=h(w),_=S.j(y);x(_)||0<_.l(v);)w-=E,S=h(w),_=S.j(y);D(S)&&(S=g),I=I.add(S),v=B(v,_)}return new U(I,v)}n.A=function(v){return W(this,v).h},n.and=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],E=0;E<y;E++)w[E]=this.i(E)&v.i(E);return new o(w,this.h&v.h)},n.or=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],E=0;E<y;E++)w[E]=this.i(E)|v.i(E);return new o(w,this.h|v.h)},n.xor=function(v){for(var y=Math.max(this.g.length,v.g.length),w=[],E=0;E<y;E++)w[E]=this.i(E)^v.i(E);return new o(w,this.h^v.h)};function tt(v){for(var y=v.g.length+1,w=[],E=0;E<y;E++)w[E]=v.i(E)<<1|v.i(E-1)>>>31;return new o(w,v.h)}function K(v,y){var w=y>>5;y%=32;for(var E=v.g.length-w,I=[],S=0;S<E;S++)I[S]=0<y?v.i(S+w)>>>y|v.i(S+w+1)<<32-y:v.i(S+w);return new o(I,v.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,lu=Wd.Md5=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.A,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=h,o.fromString=f,ge=Wd.Integer=o}).apply(typeof Kd<"u"?Kd:typeof self<"u"?self:typeof window<"u"?window:{});var Os=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ye={};var hu,v_,Gn,du,li,Fs,fu,mu,pu;(function(){var n,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(a,l,d){return a==Array.prototype||a==Object.prototype||(a[l]=d.value),a};function e(a){a=[typeof globalThis=="object"&&globalThis,a,typeof window=="object"&&window,typeof self=="object"&&self,typeof Os=="object"&&Os];for(var l=0;l<a.length;++l){var d=a[l];if(d&&d.Math==Math)return d}throw Error("Cannot find global object")}var r=e(this);function i(a,l){if(l)t:{var d=r;a=a.split(".");for(var p=0;p<a.length-1;p++){var b=a[p];if(!(b in d))break t;d=d[b]}a=a[a.length-1],p=d[a],l=l(p),l!=p&&l!=null&&t(d,a,{configurable:!0,writable:!0,value:l})}}function s(a,l){a instanceof String&&(a+="");var d=0,p=!1,b={next:function(){if(!p&&d<a.length){var C=d++;return{value:l(C,a[C]),done:!1}}return p=!0,{done:!0,value:void 0}}};return b[Symbol.iterator]=function(){return b},b}i("Array.prototype.values",function(a){return a||function(){return s(this,function(l,d){return d})}});var o=o||{},u=this||self;function c(a){var l=typeof a;return l=l!="object"?l:a?Array.isArray(a)?"array":l:"null",l=="array"||l=="object"&&typeof a.length=="number"}function h(a){var l=typeof a;return l=="object"&&a!=null||l=="function"}function f(a,l,d){return a.call.apply(a.bind,arguments)}function m(a,l,d){if(!a)throw Error();if(2<arguments.length){var p=Array.prototype.slice.call(arguments,2);return function(){var b=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(b,p),a.apply(l,b)}}return function(){return a.apply(l,arguments)}}function g(a,l,d){return g=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:m,g.apply(null,arguments)}function T(a,l){var d=Array.prototype.slice.call(arguments,1);return function(){var p=d.slice();return p.push.apply(p,arguments),a.apply(this,p)}}function D(a,l){function d(){}d.prototype=l.prototype,a.aa=l.prototype,a.prototype=new d,a.prototype.constructor=a,a.Qb=function(p,b,C){for(var F=Array(arguments.length-2),it=2;it<arguments.length;it++)F[it-2]=arguments[it];return l.prototype[b].apply(p,F)}}function x(a){let l=a.length;if(0<l){let d=Array(l);for(let p=0;p<l;p++)d[p]=a[p];return d}return[]}function N(a,l){for(let d=1;d<arguments.length;d++){let p=arguments[d];if(c(p)){let b=a.length||0,C=p.length||0;a.length=b+C;for(let F=0;F<C;F++)a[b+F]=p[F]}else a.push(p)}}class B{constructor(l,d){this.i=l,this.j=d,this.h=0,this.g=null}get(){let l;return 0<this.h?(this.h--,l=this.g,this.g=l.next,l.next=null):l=this.i(),l}}function j(a){return/^[\s\xa0]*$/.test(a)}function U(){var a=u.navigator;return a&&(a=a.userAgent)?a:""}function W(a){return W[" "](a),a}W[" "]=function(){};var tt=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function K(a,l,d){for(let p in a)l.call(d,a[p],p,a)}function v(a,l){for(let d in a)l.call(void 0,a[d],d,a)}function y(a){let l={};for(let d in a)l[d]=a[d];return l}let w="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(a,l){let d,p;for(let b=1;b<arguments.length;b++){p=arguments[b];for(d in p)a[d]=p[d];for(let C=0;C<w.length;C++)d=w[C],Object.prototype.hasOwnProperty.call(p,d)&&(a[d]=p[d])}}function I(a){var l=1;a=a.split(":");let d=[];for(;0<l&&a.length;)d.push(a.shift()),l--;return a.length&&d.push(a.join(":")),d}function S(a){u.setTimeout(()=>{throw a},0)}function _(){var a=ya;let l=null;return a.g&&(l=a.g,a.g=a.g.next,a.g||(a.h=null),l.next=null),l}class le{constructor(){this.h=this.g=null}add(l,d){let p=Lr.get();p.set(l,d),this.h?this.h.next=p:this.g=p,this.h=p}}var Lr=new B(()=>new Sg,a=>a.reset());class Sg{constructor(){this.next=this.g=this.h=null}set(l,d){this.h=l,this.g=d,this.next=null}reset(){this.next=this.g=this.h=null}}let Br,Ur=!1,ya=new le,mh=()=>{let a=u.Promise.resolve(void 0);Br=()=>{a.then(Rg)}};var Rg=()=>{for(var a;a=_();){try{a.h.call(a.g)}catch(d){S(d)}var l=Lr;l.j(a),100>l.h&&(l.h++,a.next=l.g,l.g=a)}Ur=!1};function Ce(){this.s=this.s,this.C=this.C}Ce.prototype.s=!1,Ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},Ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Rt(a,l){this.type=a,this.g=this.target=l,this.defaultPrevented=!1}Rt.prototype.h=function(){this.defaultPrevented=!0};var Pg=(function(){if(!u.addEventListener||!Object.defineProperty)return!1;var a=!1,l=Object.defineProperty({},"passive",{get:function(){a=!0}});try{let d=()=>{};u.addEventListener("test",d,l),u.removeEventListener("test",d,l)}catch{}return a})();function qr(a,l){if(Rt.call(this,a?a.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,a){var d=this.type=a.type,p=a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null;if(this.target=a.target||a.srcElement,this.g=l,l=a.relatedTarget){if(tt){t:{try{W(l.nodeName);var b=!0;break t}catch{}b=!1}b||(l=null)}}else d=="mouseover"?l=a.fromElement:d=="mouseout"&&(l=a.toElement);this.relatedTarget=l,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=a.clientX!==void 0?a.clientX:a.pageX,this.clientY=a.clientY!==void 0?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0),this.button=a.button,this.key=a.key||"",this.ctrlKey=a.ctrlKey,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.metaKey=a.metaKey,this.pointerId=a.pointerId||0,this.pointerType=typeof a.pointerType=="string"?a.pointerType:Cg[a.pointerType]||"",this.state=a.state,this.i=a,a.defaultPrevented&&qr.aa.h.call(this)}}D(qr,Rt);var Cg={2:"touch",3:"pen",4:"mouse"};qr.prototype.h=function(){qr.aa.h.call(this);var a=this.i;a.preventDefault?a.preventDefault():a.returnValue=!1};var jr="closure_listenable_"+(1e6*Math.random()|0),Dg=0;function Vg(a,l,d,p,b){this.listener=a,this.proxy=null,this.src=l,this.type=d,this.capture=!!p,this.ha=b,this.key=++Dg,this.da=this.fa=!1}function hs(a){a.da=!0,a.listener=null,a.proxy=null,a.src=null,a.ha=null}function ds(a){this.src=a,this.g={},this.h=0}ds.prototype.add=function(a,l,d,p,b){var C=a.toString();a=this.g[C],a||(a=this.g[C]=[],this.h++);var F=wa(a,l,p,b);return-1<F?(l=a[F],d||(l.fa=!1)):(l=new Vg(l,this.src,C,!!p,b),l.fa=d,a.push(l)),l};function _a(a,l){var d=l.type;if(d in a.g){var p=a.g[d],b=Array.prototype.indexOf.call(p,l,void 0),C;(C=0<=b)&&Array.prototype.splice.call(p,b,1),C&&(hs(l),a.g[d].length==0&&(delete a.g[d],a.h--))}}function wa(a,l,d,p){for(var b=0;b<a.length;++b){var C=a[b];if(!C.da&&C.listener==l&&C.capture==!!d&&C.ha==p)return b}return-1}var va="closure_lm_"+(1e6*Math.random()|0),Ea={};function ph(a,l,d,p,b){if(p&&p.once)return yh(a,l,d,p,b);if(Array.isArray(l)){for(var C=0;C<l.length;C++)ph(a,l[C],d,p,b);return null}return d=Aa(d),a&&a[jr]?a.K(l,d,h(p)?!!p.capture:!!p,b):gh(a,l,d,!1,p,b)}function gh(a,l,d,p,b,C){if(!l)throw Error("Invalid event type");var F=h(b)?!!b.capture:!!b,it=Ta(a);if(it||(a[va]=it=new ds(a)),d=it.add(l,d,p,F,C),d.proxy)return d;if(p=xg(),d.proxy=p,p.src=a,p.listener=d,a.addEventListener)Pg||(b=F),b===void 0&&(b=!1),a.addEventListener(l.toString(),p,b);else if(a.attachEvent)a.attachEvent(wh(l.toString()),p);else if(a.addListener&&a.removeListener)a.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return d}function xg(){function a(d){return l.call(a.src,a.listener,d)}let l=Ng;return a}function yh(a,l,d,p,b){if(Array.isArray(l)){for(var C=0;C<l.length;C++)yh(a,l[C],d,p,b);return null}return d=Aa(d),a&&a[jr]?a.L(l,d,h(p)?!!p.capture:!!p,b):gh(a,l,d,!0,p,b)}function _h(a,l,d,p,b){if(Array.isArray(l))for(var C=0;C<l.length;C++)_h(a,l[C],d,p,b);else p=h(p)?!!p.capture:!!p,d=Aa(d),a&&a[jr]?(a=a.i,l=String(l).toString(),l in a.g&&(C=a.g[l],d=wa(C,d,p,b),-1<d&&(hs(C[d]),Array.prototype.splice.call(C,d,1),C.length==0&&(delete a.g[l],a.h--)))):a&&(a=Ta(a))&&(l=a.g[l.toString()],a=-1,l&&(a=wa(l,d,p,b)),(d=-1<a?l[a]:null)&&Ia(d))}function Ia(a){if(typeof a!="number"&&a&&!a.da){var l=a.src;if(l&&l[jr])_a(l.i,a);else{var d=a.type,p=a.proxy;l.removeEventListener?l.removeEventListener(d,p,a.capture):l.detachEvent?l.detachEvent(wh(d),p):l.addListener&&l.removeListener&&l.removeListener(p),(d=Ta(l))?(_a(d,a),d.h==0&&(d.src=null,l[va]=null)):hs(a)}}}function wh(a){return a in Ea?Ea[a]:Ea[a]="on"+a}function Ng(a,l){if(a.da)a=!0;else{l=new qr(l,this);var d=a.listener,p=a.ha||a.src;a.fa&&Ia(a),a=d.call(p,l)}return a}function Ta(a){return a=a[va],a instanceof ds?a:null}var ba="__closure_events_fn_"+(1e9*Math.random()>>>0);function Aa(a){return typeof a=="function"?a:(a[ba]||(a[ba]=function(l){return a.handleEvent(l)}),a[ba])}function Pt(){Ce.call(this),this.i=new ds(this),this.M=this,this.F=null}D(Pt,Ce),Pt.prototype[jr]=!0,Pt.prototype.removeEventListener=function(a,l,d,p){_h(this,a,l,d,p)};function Ot(a,l){var d,p=a.F;if(p)for(d=[];p;p=p.F)d.push(p);if(a=a.M,p=l.type||l,typeof l=="string")l=new Rt(l,a);else if(l instanceof Rt)l.target=l.target||a;else{var b=l;l=new Rt(p,a),E(l,b)}if(b=!0,d)for(var C=d.length-1;0<=C;C--){var F=l.g=d[C];b=fs(F,p,!0,l)&&b}if(F=l.g=a,b=fs(F,p,!0,l)&&b,b=fs(F,p,!1,l)&&b,d)for(C=0;C<d.length;C++)F=l.g=d[C],b=fs(F,p,!1,l)&&b}Pt.prototype.N=function(){if(Pt.aa.N.call(this),this.i){var a=this.i,l;for(l in a.g){for(var d=a.g[l],p=0;p<d.length;p++)hs(d[p]);delete a.g[l],a.h--}}this.F=null},Pt.prototype.K=function(a,l,d,p){return this.i.add(String(a),l,!1,d,p)},Pt.prototype.L=function(a,l,d,p){return this.i.add(String(a),l,!0,d,p)};function fs(a,l,d,p){if(l=a.i.g[String(l)],!l)return!0;l=l.concat();for(var b=!0,C=0;C<l.length;++C){var F=l[C];if(F&&!F.da&&F.capture==d){var it=F.listener,St=F.ha||F.src;F.fa&&_a(a.i,F),b=it.call(St,p)!==!1&&b}}return b&&!p.defaultPrevented}function vh(a,l,d){if(typeof a=="function")d&&(a=g(a,d));else if(a&&typeof a.handleEvent=="function")a=g(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(l)?-1:u.setTimeout(a,l||0)}function Eh(a){a.g=vh(()=>{a.g=null,a.i&&(a.i=!1,Eh(a))},a.l);let l=a.h;a.h=null,a.m.apply(null,l)}class kg extends Ce{constructor(l,d){super(),this.m=l,this.l=d,this.h=null,this.i=!1,this.g=null}j(l){this.h=arguments,this.g?this.i=!0:Eh(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function zr(a){Ce.call(this),this.h=a,this.g={}}D(zr,Ce);var Ih=[];function Th(a){K(a.g,function(l,d){this.g.hasOwnProperty(d)&&Ia(l)},a),a.g={}}zr.prototype.N=function(){zr.aa.N.call(this),Th(this)},zr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Sa=u.JSON.stringify,Og=u.JSON.parse,Fg=class{stringify(a){return u.JSON.stringify(a,void 0)}parse(a){return u.JSON.parse(a,void 0)}};function Ra(){}Ra.prototype.h=null;function bh(a){return a.h||(a.h=a.i())}function Ah(){}var $r={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Pa(){Rt.call(this,"d")}D(Pa,Rt);function Ca(){Rt.call(this,"c")}D(Ca,Rt);var on={},Sh=null;function ms(){return Sh=Sh||new Pt}on.La="serverreachability";function Rh(a){Rt.call(this,on.La,a)}D(Rh,Rt);function Gr(a){let l=ms();Ot(l,new Rh(l))}on.STAT_EVENT="statevent";function Ph(a,l){Rt.call(this,on.STAT_EVENT,a),this.stat=l}D(Ph,Rt);function Ft(a){let l=ms();Ot(l,new Ph(l,a))}on.Ma="timingevent";function Ch(a,l){Rt.call(this,on.Ma,a),this.size=l}D(Ch,Rt);function Kr(a,l){if(typeof a!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){a()},l)}function Wr(){this.g=!0}Wr.prototype.xa=function(){this.g=!1};function Mg(a,l,d,p,b,C){a.info(function(){if(a.g)if(C)for(var F="",it=C.split("&"),St=0;St<it.length;St++){var Z=it[St].split("=");if(1<Z.length){var Ct=Z[0];Z=Z[1];var Dt=Ct.split("_");F=2<=Dt.length&&Dt[1]=="type"?F+(Ct+"="+Z+"&"):F+(Ct+"=redacted&")}}else F=null;else F=C;return"XMLHTTP REQ ("+p+") [attempt "+b+"]: "+l+`
`+d+`
`+F})}function Lg(a,l,d,p,b,C,F){a.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+b+"]: "+l+`
`+d+`
`+C+" "+F})}function Bn(a,l,d,p){a.info(function(){return"XMLHTTP TEXT ("+l+"): "+Ug(a,d)+(p?" "+p:"")})}function Bg(a,l){a.info(function(){return"TIMEOUT: "+l})}Wr.prototype.info=function(){};function Ug(a,l){if(!a.g)return l;if(!l)return null;try{var d=JSON.parse(l);if(d){for(a=0;a<d.length;a++)if(Array.isArray(d[a])){var p=d[a];if(!(2>p.length)){var b=p[1];if(Array.isArray(b)&&!(1>b.length)){var C=b[0];if(C!="noop"&&C!="stop"&&C!="close")for(var F=1;F<b.length;F++)b[F]=""}}}}return Sa(d)}catch{return l}}var ps={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Dh={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Da;function gs(){}D(gs,Ra),gs.prototype.g=function(){return new XMLHttpRequest},gs.prototype.i=function(){return{}},Da=new gs;function De(a,l,d,p){this.j=a,this.i=l,this.l=d,this.R=p||1,this.U=new zr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Vh}function Vh(){this.i=null,this.g="",this.h=!1}var xh={},Va={};function xa(a,l,d){a.L=1,a.v=vs(he(l)),a.m=d,a.P=!0,Nh(a,null)}function Nh(a,l){a.F=Date.now(),ys(a),a.A=he(a.v);var d=a.A,p=a.R;Array.isArray(p)||(p=[String(p)]),Wh(d.i,"t",p),a.C=0,d=a.j.J,a.h=new Vh,a.g=hd(a.j,d?l:null,!a.m),0<a.O&&(a.M=new kg(g(a.Y,a,a.g),a.O)),l=a.U,d=a.g,p=a.ca;var b="readystatechange";Array.isArray(b)||(b&&(Ih[0]=b.toString()),b=Ih);for(var C=0;C<b.length;C++){var F=ph(d,b[C],p||l.handleEvent,!1,l.h||l);if(!F)break;l.g[F.key]=F}l=a.H?y(a.H):{},a.m?(a.u||(a.u="POST"),l["Content-Type"]="application/x-www-form-urlencoded",a.g.ea(a.A,a.u,a.m,l)):(a.u="GET",a.g.ea(a.A,a.u,null,l)),Gr(),Mg(a.i,a.u,a.A,a.l,a.R,a.m)}De.prototype.ca=function(a){a=a.target;let l=this.M;l&&de(a)==3?l.j():this.Y(a)},De.prototype.Y=function(a){try{if(a==this.g)t:{let Dt=de(this.g);var l=this.g.Ba();let jn=this.g.Z();if(!(3>Dt)&&(Dt!=3||this.g&&(this.h.h||this.g.oa()||td(this.g)))){this.J||Dt!=4||l==7||(l==8||0>=jn?Gr(3):Gr(2)),Na(this);var d=this.g.Z();this.X=d;e:if(kh(this)){var p=td(this.g);a="";var b=p.length,C=de(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){an(this),Qr(this);var F="";break e}this.h.i=new u.TextDecoder}for(l=0;l<b;l++)this.h.h=!0,a+=this.h.i.decode(p[l],{stream:!(C&&l==b-1)});p.length=0,this.h.g+=a,this.C=0,F=this.h.g}else F=this.g.oa();if(this.o=d==200,Lg(this.i,this.u,this.A,this.l,this.R,Dt,d),this.o){if(this.T&&!this.K){e:{if(this.g){var it,St=this.g;if((it=St.g?St.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(it)){var Z=it;break e}}Z=null}if(d=Z)Bn(this.i,this.l,d,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ka(this,d);else{this.o=!1,this.s=3,Ft(12),an(this),Qr(this);break t}}if(this.P){d=!0;let Wt;for(;!this.J&&this.C<F.length;)if(Wt=qg(this,F),Wt==Va){Dt==4&&(this.s=4,Ft(14),d=!1),Bn(this.i,this.l,null,"[Incomplete Response]");break}else if(Wt==xh){this.s=4,Ft(15),Bn(this.i,this.l,F,"[Invalid Chunk]"),d=!1;break}else Bn(this.i,this.l,Wt,null),ka(this,Wt);if(kh(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Dt!=4||F.length!=0||this.h.h||(this.s=1,Ft(16),d=!1),this.o=this.o&&d,!d)Bn(this.i,this.l,F,"[Invalid Chunked Response]"),an(this),Qr(this);else if(0<F.length&&!this.W){this.W=!0;var Ct=this.j;Ct.g==this&&Ct.ba&&!Ct.M&&(Ct.j.info("Great, no buffering proxy detected. Bytes received: "+F.length),Ua(Ct),Ct.M=!0,Ft(11))}}else Bn(this.i,this.l,F,null),ka(this,F);Dt==4&&an(this),this.o&&!this.J&&(Dt==4?ad(this.j,this):(this.o=!1,ys(this)))}else iy(this.g),d==400&&0<F.indexOf("Unknown SID")?(this.s=3,Ft(12)):(this.s=0,Ft(13)),an(this),Qr(this)}}}catch{}finally{}};function kh(a){return a.g?a.u=="GET"&&a.L!=2&&a.j.Ca:!1}function qg(a,l){var d=a.C,p=l.indexOf(`
`,d);return p==-1?Va:(d=Number(l.substring(d,p)),isNaN(d)?xh:(p+=1,p+d>l.length?Va:(l=l.slice(p,p+d),a.C=p+d,l)))}De.prototype.cancel=function(){this.J=!0,an(this)};function ys(a){a.S=Date.now()+a.I,Oh(a,a.I)}function Oh(a,l){if(a.B!=null)throw Error("WatchDog timer not null");a.B=Kr(g(a.ba,a),l)}function Na(a){a.B&&(u.clearTimeout(a.B),a.B=null)}De.prototype.ba=function(){this.B=null;let a=Date.now();0<=a-this.S?(Bg(this.i,this.A),this.L!=2&&(Gr(),Ft(17)),an(this),this.s=2,Qr(this)):Oh(this,this.S-a)};function Qr(a){a.j.G==0||a.J||ad(a.j,a)}function an(a){Na(a);var l=a.M;l&&typeof l.ma=="function"&&l.ma(),a.M=null,Th(a.U),a.g&&(l=a.g,a.g=null,l.abort(),l.ma())}function ka(a,l){try{var d=a.j;if(d.G!=0&&(d.g==a||Oa(d.h,a))){if(!a.K&&Oa(d.h,a)&&d.G==3){try{var p=d.Da.g.parse(l)}catch{p=null}if(Array.isArray(p)&&p.length==3){var b=p;if(b[0]==0){t:if(!d.u){if(d.g)if(d.g.F+3e3<a.F)As(d),Ts(d);else break t;Ba(d),Ft(18)}}else d.za=b[1],0<d.za-d.T&&37500>b[2]&&d.F&&d.v==0&&!d.C&&(d.C=Kr(g(d.Za,d),6e3));if(1>=Lh(d.h)&&d.ca){try{d.ca()}catch{}d.ca=void 0}}else cn(d,11)}else if((a.K||d.g==a)&&As(d),!j(l))for(b=d.Da.g.parse(l),l=0;l<b.length;l++){let Z=b[l];if(d.T=Z[0],Z=Z[1],d.G==2)if(Z[0]=="c"){d.K=Z[1],d.ia=Z[2];let Ct=Z[3];Ct!=null&&(d.la=Ct,d.j.info("VER="+d.la));let Dt=Z[4];Dt!=null&&(d.Aa=Dt,d.j.info("SVER="+d.Aa));let jn=Z[5];jn!=null&&typeof jn=="number"&&0<jn&&(p=1.5*jn,d.L=p,d.j.info("backChannelRequestTimeoutMs_="+p)),p=d;let Wt=a.g;if(Wt){let Rs=Wt.g?Wt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Rs){var C=p.h;C.g||Rs.indexOf("spdy")==-1&&Rs.indexOf("quic")==-1&&Rs.indexOf("h2")==-1||(C.j=C.l,C.g=new Set,C.h&&(Fa(C,C.h),C.h=null))}if(p.D){let qa=Wt.g?Wt.g.getResponseHeader("X-HTTP-Session-Id"):null;qa&&(p.ya=qa,st(p.I,p.D,qa))}}d.G=3,d.l&&d.l.ua(),d.ba&&(d.R=Date.now()-a.F,d.j.info("Handshake RTT: "+d.R+"ms")),p=d;var F=a;if(p.qa=ld(p,p.J?p.ia:null,p.W),F.K){Bh(p.h,F);var it=F,St=p.L;St&&(it.I=St),it.B&&(Na(it),ys(it)),p.g=F}else sd(p);0<d.i.length&&bs(d)}else Z[0]!="stop"&&Z[0]!="close"||cn(d,7);else d.G==3&&(Z[0]=="stop"||Z[0]=="close"?Z[0]=="stop"?cn(d,7):La(d):Z[0]!="noop"&&d.l&&d.l.ta(Z),d.v=0)}}Gr(4)}catch{}}var jg=class{constructor(a,l){this.g=a,this.map=l}};function Fh(a){this.l=a||10,u.PerformanceNavigationTiming?(a=u.performance.getEntriesByType("navigation"),a=0<a.length&&(a[0].nextHopProtocol=="hq"||a[0].nextHopProtocol=="h2")):a=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=a?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Mh(a){return a.h?!0:a.g?a.g.size>=a.j:!1}function Lh(a){return a.h?1:a.g?a.g.size:0}function Oa(a,l){return a.h?a.h==l:a.g?a.g.has(l):!1}function Fa(a,l){a.g?a.g.add(l):a.h=l}function Bh(a,l){a.h&&a.h==l?a.h=null:a.g&&a.g.has(l)&&a.g.delete(l)}Fh.prototype.cancel=function(){if(this.i=Uh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let a of this.g.values())a.cancel();this.g.clear()}};function Uh(a){if(a.h!=null)return a.i.concat(a.h.D);if(a.g!=null&&a.g.size!==0){let l=a.i;for(let d of a.g.values())l=l.concat(d.D);return l}return x(a.i)}function zg(a){if(a.V&&typeof a.V=="function")return a.V();if(typeof Map<"u"&&a instanceof Map||typeof Set<"u"&&a instanceof Set)return Array.from(a.values());if(typeof a=="string")return a.split("");if(c(a)){for(var l=[],d=a.length,p=0;p<d;p++)l.push(a[p]);return l}l=[],d=0;for(p in a)l[d++]=a[p];return l}function $g(a){if(a.na&&typeof a.na=="function")return a.na();if(!a.V||typeof a.V!="function"){if(typeof Map<"u"&&a instanceof Map)return Array.from(a.keys());if(!(typeof Set<"u"&&a instanceof Set)){if(c(a)||typeof a=="string"){var l=[];a=a.length;for(var d=0;d<a;d++)l.push(d);return l}l=[],d=0;for(let p in a)l[d++]=p;return l}}}function qh(a,l){if(a.forEach&&typeof a.forEach=="function")a.forEach(l,void 0);else if(c(a)||typeof a=="string")Array.prototype.forEach.call(a,l,void 0);else for(var d=$g(a),p=zg(a),b=p.length,C=0;C<b;C++)l.call(void 0,p[C],d&&d[C],a)}var jh=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gg(a,l){if(a){a=a.split("&");for(var d=0;d<a.length;d++){var p=a[d].indexOf("="),b=null;if(0<=p){var C=a[d].substring(0,p);b=a[d].substring(p+1)}else C=a[d];l(C,b?decodeURIComponent(b.replace(/\+/g," ")):"")}}}function un(a){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,a instanceof un){this.h=a.h,_s(this,a.j),this.o=a.o,this.g=a.g,ws(this,a.s),this.l=a.l;var l=a.i,d=new Jr;d.i=l.i,l.g&&(d.g=new Map(l.g),d.h=l.h),zh(this,d),this.m=a.m}else a&&(l=String(a).match(jh))?(this.h=!1,_s(this,l[1]||"",!0),this.o=Hr(l[2]||""),this.g=Hr(l[3]||"",!0),ws(this,l[4]),this.l=Hr(l[5]||"",!0),zh(this,l[6]||"",!0),this.m=Hr(l[7]||"")):(this.h=!1,this.i=new Jr(null,this.h))}un.prototype.toString=function(){var a=[],l=this.j;l&&a.push(Xr(l,$h,!0),":");var d=this.g;return(d||l=="file")&&(a.push("//"),(l=this.o)&&a.push(Xr(l,$h,!0),"@"),a.push(encodeURIComponent(String(d)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d=this.s,d!=null&&a.push(":",String(d))),(d=this.l)&&(this.g&&d.charAt(0)!="/"&&a.push("/"),a.push(Xr(d,d.charAt(0)=="/"?Qg:Wg,!0))),(d=this.i.toString())&&a.push("?",d),(d=this.m)&&a.push("#",Xr(d,Xg)),a.join("")};function he(a){return new un(a)}function _s(a,l,d){a.j=d?Hr(l,!0):l,a.j&&(a.j=a.j.replace(/:$/,""))}function ws(a,l){if(l){if(l=Number(l),isNaN(l)||0>l)throw Error("Bad port number "+l);a.s=l}else a.s=null}function zh(a,l,d){l instanceof Jr?(a.i=l,Jg(a.i,a.h)):(d||(l=Xr(l,Hg)),a.i=new Jr(l,a.h))}function st(a,l,d){a.i.set(l,d)}function vs(a){return st(a,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),a}function Hr(a,l){return a?l?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function Xr(a,l,d){return typeof a=="string"?(a=encodeURI(a).replace(l,Kg),d&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Kg(a){return a=a.charCodeAt(0),"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var $h=/[#\/\?@]/g,Wg=/[#\?:]/g,Qg=/[#\?]/g,Hg=/[#\?@]/g,Xg=/#/g;function Jr(a,l){this.h=this.g=null,this.i=a||null,this.j=!!l}function Ve(a){a.g||(a.g=new Map,a.h=0,a.i&&Gg(a.i,function(l,d){a.add(decodeURIComponent(l.replace(/\+/g," ")),d)}))}n=Jr.prototype,n.add=function(a,l){Ve(this),this.i=null,a=Un(this,a);var d=this.g.get(a);return d||this.g.set(a,d=[]),d.push(l),this.h+=1,this};function Gh(a,l){Ve(a),l=Un(a,l),a.g.has(l)&&(a.i=null,a.h-=a.g.get(l).length,a.g.delete(l))}function Kh(a,l){return Ve(a),l=Un(a,l),a.g.has(l)}n.forEach=function(a,l){Ve(this),this.g.forEach(function(d,p){d.forEach(function(b){a.call(l,b,p,this)},this)},this)},n.na=function(){Ve(this);let a=Array.from(this.g.values()),l=Array.from(this.g.keys()),d=[];for(let p=0;p<l.length;p++){let b=a[p];for(let C=0;C<b.length;C++)d.push(l[p])}return d},n.V=function(a){Ve(this);let l=[];if(typeof a=="string")Kh(this,a)&&(l=l.concat(this.g.get(Un(this,a))));else{a=Array.from(this.g.values());for(let d=0;d<a.length;d++)l=l.concat(a[d])}return l},n.set=function(a,l){return Ve(this),this.i=null,a=Un(this,a),Kh(this,a)&&(this.h-=this.g.get(a).length),this.g.set(a,[l]),this.h+=1,this},n.get=function(a,l){return a?(a=this.V(a),0<a.length?String(a[0]):l):l};function Wh(a,l,d){Gh(a,l),0<d.length&&(a.i=null,a.g.set(Un(a,l),x(d)),a.h+=d.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";let a=[],l=Array.from(this.g.keys());for(var d=0;d<l.length;d++){var p=l[d];let C=encodeURIComponent(String(p)),F=this.V(p);for(p=0;p<F.length;p++){var b=C;F[p]!==""&&(b+="="+encodeURIComponent(String(F[p]))),a.push(b)}}return this.i=a.join("&")};function Un(a,l){return l=String(l),a.j&&(l=l.toLowerCase()),l}function Jg(a,l){l&&!a.j&&(Ve(a),a.i=null,a.g.forEach(function(d,p){var b=p.toLowerCase();p!=b&&(Gh(this,p),Wh(this,b,d))},a)),a.j=l}function Yg(a,l){let d=new Wr;if(u.Image){let p=new Image;p.onload=T(xe,d,"TestLoadImage: loaded",!0,l,p),p.onerror=T(xe,d,"TestLoadImage: error",!1,l,p),p.onabort=T(xe,d,"TestLoadImage: abort",!1,l,p),p.ontimeout=T(xe,d,"TestLoadImage: timeout",!1,l,p),u.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=a}else l(!1)}function Zg(a,l){let d=new Wr,p=new AbortController,b=setTimeout(()=>{p.abort(),xe(d,"TestPingServer: timeout",!1,l)},1e4);fetch(a,{signal:p.signal}).then(C=>{clearTimeout(b),C.ok?xe(d,"TestPingServer: ok",!0,l):xe(d,"TestPingServer: server error",!1,l)}).catch(()=>{clearTimeout(b),xe(d,"TestPingServer: error",!1,l)})}function xe(a,l,d,p,b){try{b&&(b.onload=null,b.onerror=null,b.onabort=null,b.ontimeout=null),p(d)}catch{}}function ty(){this.g=new Fg}function ey(a,l,d){let p=d||"";try{qh(a,function(b,C){let F=b;h(b)&&(F=Sa(b)),l.push(p+C+"="+encodeURIComponent(F))})}catch(b){throw l.push(p+"type="+encodeURIComponent("_badmap")),b}}function Yr(a){this.l=a.Ub||null,this.j=a.eb||!1}D(Yr,Ra),Yr.prototype.g=function(){return new Es(this.l,this.j)},Yr.prototype.i=(function(a){return function(){return a}})({});function Es(a,l){Pt.call(this),this.D=a,this.o=l,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(Es,Pt),n=Es.prototype,n.open=function(a,l){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=a,this.A=l,this.readyState=1,ti(this)},n.send=function(a){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let l={headers:this.u,method:this.B,credentials:this.m,cache:void 0};a&&(l.body=a),(this.D||u).fetch(new Request(this.A,l)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Zr(this)),this.readyState=0},n.Sa=function(a){if(this.g&&(this.l=a,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=a.headers,this.readyState=2,ti(this)),this.g&&(this.readyState=3,ti(this),this.g)))if(this.responseType==="arraybuffer")a.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in a){if(this.j=a.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Qh(this)}else a.text().then(this.Ra.bind(this),this.ga.bind(this))};function Qh(a){a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a))}n.Pa=function(a){if(this.g){if(this.o&&a.value)this.response.push(a.value);else if(!this.o){var l=a.value?a.value:new Uint8Array(0);(l=this.v.decode(l,{stream:!a.done}))&&(this.response=this.responseText+=l)}a.done?Zr(this):ti(this),this.readyState==3&&Qh(this)}},n.Ra=function(a){this.g&&(this.response=this.responseText=a,Zr(this))},n.Qa=function(a){this.g&&(this.response=a,Zr(this))},n.ga=function(){this.g&&Zr(this)};function Zr(a){a.readyState=4,a.l=null,a.j=null,a.v=null,ti(a)}n.setRequestHeader=function(a,l){this.u.append(a,l)},n.getResponseHeader=function(a){return this.h&&this.h.get(a.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";let a=[],l=this.h.entries();for(var d=l.next();!d.done;)d=d.value,a.push(d[0]+": "+d[1]),d=l.next();return a.join(`\r
`)};function ti(a){a.onreadystatechange&&a.onreadystatechange.call(a)}Object.defineProperty(Es.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(a){this.m=a?"include":"same-origin"}});function Hh(a){let l="";return K(a,function(d,p){l+=p,l+=":",l+=d,l+=`\r
`}),l}function Ma(a,l,d){t:{for(p in d){var p=!1;break t}p=!0}p||(d=Hh(d),typeof a=="string"?d!=null&&encodeURIComponent(String(d)):st(a,l,d))}function ht(a){Pt.call(this),this.headers=new Map,this.o=a||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(ht,Pt);var ny=/^https?$/i,ry=["POST","PUT"];n=ht.prototype,n.Ha=function(a){this.J=a},n.ea=function(a,l,d,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+a);l=l?l.toUpperCase():"GET",this.D=a,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Da.g(),this.v=this.o?bh(this.o):bh(Da),this.g.onreadystatechange=g(this.Ea,this);try{this.B=!0,this.g.open(l,String(a),!0),this.B=!1}catch(C){Xh(this,C);return}if(a=d||"",d=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var b in p)d.set(b,p[b]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(let C of p.keys())d.set(C,p.get(C));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(d.keys()).find(C=>C.toLowerCase()=="content-type"),b=u.FormData&&a instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ry,l,void 0))||p||b||d.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[C,F]of d)this.g.setRequestHeader(C,F);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Zh(this),this.u=!0,this.g.send(a),this.u=!1}catch(C){Xh(this,C)}};function Xh(a,l){a.h=!1,a.g&&(a.j=!0,a.g.abort(),a.j=!1),a.l=l,a.m=5,Jh(a),Is(a)}function Jh(a){a.A||(a.A=!0,Ot(a,"complete"),Ot(a,"error"))}n.abort=function(a){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=a||7,Ot(this,"complete"),Ot(this,"abort"),Is(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Is(this,!0)),ht.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Yh(this):this.bb())},n.bb=function(){Yh(this)};function Yh(a){if(a.h&&typeof o<"u"&&(!a.v[1]||de(a)!=4||a.Z()!=2)){if(a.u&&de(a)==4)vh(a.Ea,0,a);else if(Ot(a,"readystatechange"),de(a)==4){a.h=!1;try{let F=a.Z();t:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var l=!0;break t;default:l=!1}var d;if(!(d=l)){var p;if(p=F===0){var b=String(a.D).match(jh)[1]||null;!b&&u.self&&u.self.location&&(b=u.self.location.protocol.slice(0,-1)),p=!ny.test(b?b.toLowerCase():"")}d=p}if(d)Ot(a,"complete"),Ot(a,"success");else{a.m=6;try{var C=2<de(a)?a.g.statusText:""}catch{C=""}a.l=C+" ["+a.Z()+"]",Jh(a)}}finally{Is(a)}}}}function Is(a,l){if(a.g){Zh(a);let d=a.g,p=a.v[0]?()=>{}:null;a.g=null,a.v=null,l||Ot(a,"ready");try{d.onreadystatechange=p}catch{}}}function Zh(a){a.I&&(u.clearTimeout(a.I),a.I=null)}n.isActive=function(){return!!this.g};function de(a){return a.g?a.g.readyState:0}n.Z=function(){try{return 2<de(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(a){if(this.g){var l=this.g.responseText;return a&&l.indexOf(a)==0&&(l=l.substring(a.length)),Og(l)}};function td(a){try{if(!a.g)return null;if("response"in a.g)return a.g.response;switch(a.H){case"":case"text":return a.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in a.g)return a.g.mozResponseArrayBuffer}return null}catch{return null}}function iy(a){let l={};a=(a.g&&2<=de(a)&&a.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<a.length;p++){if(j(a[p]))continue;var d=I(a[p]);let b=d[0];if(d=d[1],typeof d!="string")continue;d=d.trim();let C=l[b]||[];l[b]=C,C.push(d)}v(l,function(p){return p.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function ei(a,l,d){return d&&d.internalChannelParams&&d.internalChannelParams[a]||l}function ed(a){this.Aa=0,this.i=[],this.j=new Wr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=ei("failFast",!1,a),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=ei("baseRetryDelayMs",5e3,a),this.cb=ei("retryDelaySeedMs",1e4,a),this.Wa=ei("forwardChannelMaxRetries",2,a),this.wa=ei("forwardChannelRequestTimeoutMs",2e4,a),this.pa=a&&a.xmlHttpFactory||void 0,this.Xa=a&&a.Tb||void 0,this.Ca=a&&a.useFetchStreams||!1,this.L=void 0,this.J=a&&a.supportsCrossDomainXhr||!1,this.K="",this.h=new Fh(a&&a.concurrentRequestLimit),this.Da=new ty,this.P=a&&a.fastHandshake||!1,this.O=a&&a.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=a&&a.Rb||!1,a&&a.xa&&this.j.xa(),a&&a.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&a&&a.detectBufferingProxy||!1,this.ja=void 0,a&&a.longPollingTimeout&&0<a.longPollingTimeout&&(this.ja=a.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=ed.prototype,n.la=8,n.G=1,n.connect=function(a,l,d,p){Ft(0),this.W=a,this.H=l||{},d&&p!==void 0&&(this.H.OSID=d,this.H.OAID=p),this.F=this.X,this.I=ld(this,null,this.W),bs(this)};function La(a){if(nd(a),a.G==3){var l=a.U++,d=he(a.I);if(st(d,"SID",a.K),st(d,"RID",l),st(d,"TYPE","terminate"),ni(a,d),l=new De(a,a.j,l),l.L=2,l.v=vs(he(d)),d=!1,u.navigator&&u.navigator.sendBeacon)try{d=u.navigator.sendBeacon(l.v.toString(),"")}catch{}!d&&u.Image&&(new Image().src=l.v,d=!0),d||(l.g=hd(l.j,null),l.g.ea(l.v)),l.F=Date.now(),ys(l)}cd(a)}function Ts(a){a.g&&(Ua(a),a.g.cancel(),a.g=null)}function nd(a){Ts(a),a.u&&(u.clearTimeout(a.u),a.u=null),As(a),a.h.cancel(),a.s&&(typeof a.s=="number"&&u.clearTimeout(a.s),a.s=null)}function bs(a){if(!Mh(a.h)&&!a.s){a.s=!0;var l=a.Ga;Br||mh(),Ur||(Br(),Ur=!0),ya.add(l,a),a.B=0}}function sy(a,l){return Lh(a.h)>=a.h.j-(a.s?1:0)?!1:a.s?(a.i=l.D.concat(a.i),!0):a.G==1||a.G==2||a.B>=(a.Va?0:a.Wa)?!1:(a.s=Kr(g(a.Ga,a,l),ud(a,a.B)),a.B++,!0)}n.Ga=function(a){if(this.s)if(this.s=null,this.G==1){if(!a){this.U=Math.floor(1e5*Math.random()),a=this.U++;let b=new De(this,this.j,a),C=this.o;if(this.S&&(C?(C=y(C),E(C,this.S)):C=this.S),this.m!==null||this.O||(b.H=C,C=null),this.P)t:{for(var l=0,d=0;d<this.i.length;d++){e:{var p=this.i[d];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break e}p=void 0}if(p===void 0)break;if(l+=p,4096<l){l=d;break t}if(l===4096||d===this.i.length-1){l=d+1;break t}}l=1e3}else l=1e3;l=id(this,b,l),d=he(this.I),st(d,"RID",a),st(d,"CVER",22),this.D&&st(d,"X-HTTP-Session-Id",this.D),ni(this,d),C&&(this.O?l="headers="+encodeURIComponent(String(Hh(C)))+"&"+l:this.m&&Ma(d,this.m,C)),Fa(this.h,b),this.Ua&&st(d,"TYPE","init"),this.P?(st(d,"$req",l),st(d,"SID","null"),b.T=!0,xa(b,d,null)):xa(b,d,l),this.G=2}}else this.G==3&&(a?rd(this,a):this.i.length==0||Mh(this.h)||rd(this))};function rd(a,l){var d;l?d=l.l:d=a.U++;let p=he(a.I);st(p,"SID",a.K),st(p,"RID",d),st(p,"AID",a.T),ni(a,p),a.m&&a.o&&Ma(p,a.m,a.o),d=new De(a,a.j,d,a.B+1),a.m===null&&(d.H=a.o),l&&(a.i=l.D.concat(a.i)),l=id(a,d,1e3),d.I=Math.round(.5*a.wa)+Math.round(.5*a.wa*Math.random()),Fa(a.h,d),xa(d,p,l)}function ni(a,l){a.H&&K(a.H,function(d,p){st(l,p,d)}),a.l&&qh({},function(d,p){st(l,p,d)})}function id(a,l,d){d=Math.min(a.i.length,d);var p=a.l?g(a.l.Na,a.l,a):null;t:{var b=a.i;let C=-1;for(;;){let F=["count="+d];C==-1?0<d?(C=b[0].g,F.push("ofs="+C)):C=0:F.push("ofs="+C);let it=!0;for(let St=0;St<d;St++){let Z=b[St].g,Ct=b[St].map;if(Z-=C,0>Z)C=Math.max(0,b[St].g-100),it=!1;else try{ey(Ct,F,"req"+Z+"_")}catch{p&&p(Ct)}}if(it){p=F.join("&");break t}}}return a=a.i.splice(0,d),l.D=a,p}function sd(a){if(!a.g&&!a.u){a.Y=1;var l=a.Fa;Br||mh(),Ur||(Br(),Ur=!0),ya.add(l,a),a.v=0}}function Ba(a){return a.g||a.u||3<=a.v?!1:(a.Y++,a.u=Kr(g(a.Fa,a),ud(a,a.v)),a.v++,!0)}n.Fa=function(){if(this.u=null,od(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var a=2*this.R;this.j.info("BP detection timer enabled: "+a),this.A=Kr(g(this.ab,this),a)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Ft(10),Ts(this),od(this))};function Ua(a){a.A!=null&&(u.clearTimeout(a.A),a.A=null)}function od(a){a.g=new De(a,a.j,"rpc",a.Y),a.m===null&&(a.g.H=a.o),a.g.O=0;var l=he(a.qa);st(l,"RID","rpc"),st(l,"SID",a.K),st(l,"AID",a.T),st(l,"CI",a.F?"0":"1"),!a.F&&a.ja&&st(l,"TO",a.ja),st(l,"TYPE","xmlhttp"),ni(a,l),a.m&&a.o&&Ma(l,a.m,a.o),a.L&&(a.g.I=a.L);var d=a.g;a=a.ia,d.L=1,d.v=vs(he(l)),d.m=null,d.P=!0,Nh(d,a)}n.Za=function(){this.C!=null&&(this.C=null,Ts(this),Ba(this),Ft(19))};function As(a){a.C!=null&&(u.clearTimeout(a.C),a.C=null)}function ad(a,l){var d=null;if(a.g==l){As(a),Ua(a),a.g=null;var p=2}else if(Oa(a.h,l))d=l.D,Bh(a.h,l),p=1;else return;if(a.G!=0){if(l.o)if(p==1){d=l.m?l.m.length:0,l=Date.now()-l.F;var b=a.B;p=ms(),Ot(p,new Ch(p,d)),bs(a)}else sd(a);else if(b=l.s,b==3||b==0&&0<l.X||!(p==1&&sy(a,l)||p==2&&Ba(a)))switch(d&&0<d.length&&(l=a.h,l.i=l.i.concat(d)),b){case 1:cn(a,5);break;case 4:cn(a,10);break;case 3:cn(a,6);break;default:cn(a,2)}}}function ud(a,l){let d=a.Ta+Math.floor(Math.random()*a.cb);return a.isActive()||(d*=2),d*l}function cn(a,l){if(a.j.info("Error code "+l),l==2){var d=g(a.fb,a),p=a.Xa;let b=!p;p=new un(p||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||_s(p,"https"),vs(p),b?Yg(p.toString(),d):Zg(p.toString(),d)}else Ft(2);a.G=0,a.l&&a.l.sa(l),cd(a),nd(a)}n.fb=function(a){a?(this.j.info("Successfully pinged google.com"),Ft(2)):(this.j.info("Failed to ping google.com"),Ft(1))};function cd(a){if(a.G=0,a.ka=[],a.l){let l=Uh(a.h);(l.length!=0||a.i.length!=0)&&(N(a.ka,l),N(a.ka,a.i),a.h.i.length=0,x(a.i),a.i.length=0),a.l.ra()}}function ld(a,l,d){var p=d instanceof un?he(d):new un(d);if(p.g!="")l&&(p.g=l+"."+p.g),ws(p,p.s);else{var b=u.location;p=b.protocol,l=l?l+"."+b.hostname:b.hostname,b=+b.port;var C=new un(null);p&&_s(C,p),l&&(C.g=l),b&&ws(C,b),d&&(C.l=d),p=C}return d=a.D,l=a.ya,d&&l&&st(p,d,l),st(p,"VER",a.la),ni(a,p),p}function hd(a,l,d){if(l&&!a.J)throw Error("Can't create secondary domain capable XhrIo object.");return l=a.Ca&&!a.pa?new ht(new Yr({eb:d})):new ht(a.pa),l.Ha(a.J),l}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function dd(){}n=dd.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function Ss(){}Ss.prototype.g=function(a,l){return new Ut(a,l)};function Ut(a,l){Pt.call(this),this.g=new ed(l),this.l=a,this.h=l&&l.messageUrlParams||null,a=l&&l.messageHeaders||null,l&&l.clientProtocolHeaderRequired&&(a?a["X-Client-Protocol"]="webchannel":a={"X-Client-Protocol":"webchannel"}),this.g.o=a,a=l&&l.initMessageHeaders||null,l&&l.messageContentType&&(a?a["X-WebChannel-Content-Type"]=l.messageContentType:a={"X-WebChannel-Content-Type":l.messageContentType}),l&&l.va&&(a?a["X-WebChannel-Client-Profile"]=l.va:a={"X-WebChannel-Client-Profile":l.va}),this.g.S=a,(a=l&&l.Sb)&&!j(a)&&(this.g.m=a),this.v=l&&l.supportsCrossDomainXhr||!1,this.u=l&&l.sendRawJson||!1,(l=l&&l.httpSessionIdParam)&&!j(l)&&(this.g.D=l,a=this.h,a!==null&&l in a&&(a=this.h,l in a&&delete a[l])),this.j=new qn(this)}D(Ut,Pt),Ut.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Ut.prototype.close=function(){La(this.g)},Ut.prototype.o=function(a){var l=this.g;if(typeof a=="string"){var d={};d.__data__=a,a=d}else this.u&&(d={},d.__data__=Sa(a),a=d);l.i.push(new jg(l.Ya++,a)),l.G==3&&bs(l)},Ut.prototype.N=function(){this.g.l=null,delete this.j,La(this.g),delete this.g,Ut.aa.N.call(this)};function fd(a){Pa.call(this),a.__headers__&&(this.headers=a.__headers__,this.statusCode=a.__status__,delete a.__headers__,delete a.__status__);var l=a.__sm__;if(l){t:{for(let d in l){a=d;break t}a=void 0}(this.i=a)&&(a=this.i,l=l!==null&&a in l?l[a]:void 0),this.data=l}else this.data=a}D(fd,Pa);function md(){Ca.call(this),this.status=1}D(md,Ca);function qn(a){this.g=a}D(qn,dd),qn.prototype.ua=function(){Ot(this.g,"a")},qn.prototype.ta=function(a){Ot(this.g,new fd(a))},qn.prototype.sa=function(a){Ot(this.g,new md)},qn.prototype.ra=function(){Ot(this.g,"b")},Ss.prototype.createWebChannel=Ss.prototype.g,Ut.prototype.send=Ut.prototype.o,Ut.prototype.open=Ut.prototype.m,Ut.prototype.close=Ut.prototype.close,pu=ye.createWebChannelTransport=function(){return new Ss},mu=ye.getStatEventTarget=function(){return ms()},fu=ye.Event=on,Fs=ye.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ps.NO_ERROR=0,ps.TIMEOUT=8,ps.HTTP_ERROR=6,li=ye.ErrorCode=ps,Dh.COMPLETE="complete",du=ye.EventType=Dh,Ah.EventType=$r,$r.OPEN="a",$r.CLOSE="b",$r.ERROR="c",$r.MESSAGE="d",Pt.prototype.listen=Pt.prototype.K,Gn=ye.WebChannel=Ah,v_=ye.FetchXmlHttpFactory=Yr,ht.prototype.listenOnce=ht.prototype.L,ht.prototype.getLastError=ht.prototype.Ka,ht.prototype.getLastErrorCode=ht.prototype.Ba,ht.prototype.getStatus=ht.prototype.Z,ht.prototype.getResponseJson=ht.prototype.Oa,ht.prototype.getResponseText=ht.prototype.oa,ht.prototype.send=ht.prototype.ea,ht.prototype.setWithCredentials=ht.prototype.Ha,hu=ye.XhrIo=ht}).apply(typeof Os<"u"?Os:typeof self<"u"?self:typeof window<"u"?window:{});var Qd="@firebase/firestore",Hd="4.8.0";var wt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};wt.UNAUTHENTICATED=new wt(null),wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid"),wt.FIRST_PARTY=new wt("first-party-uid"),wt.MOCK_USER=new wt("mock-user");var Dr="11.10.0";var ze=new zn("@firebase/firestore");function Yn(){return ze.logLevel}function SE(n){ze.setLogLevel(n)}function k(n,...t){if(ze.logLevel<=J.DEBUG){let e=t.map(xl);ze.debug(`Firestore (${Dr}): ${n}`,...e)}}function ft(n,...t){if(ze.logLevel<=J.ERROR){let e=t.map(xl);ze.error(`Firestore (${Dr}): ${n}`,...e)}}function Mt(n,...t){if(ze.logLevel<=J.WARN){let e=t.map(xl);ze.warn(`Firestore (${Dr}): ${n}`,...e)}}function xl(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function L(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,pm(n,r,e)}function pm(n,t,e){let r=`FIRESTORE (${Dr}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw ft(r),new Error(r)}function q(n,t,e,r){let i="Unexpected state";typeof e=="string"?i=e:r=e,n||pm(t,i,r)}function RE(n,t){n||L(57014,t)}function O(n,t){return n}var A={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=class extends fe{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Et=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var Js=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},Tu=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(wt.UNAUTHENTICATED))}shutdown(){}},bu=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},Au=class{constructor(t){this.t=t,this.currentUser=wt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){q(this.o===void 0,42304);let r=this.i,i=c=>this.i!==r?(r=this.i,e(c)):Promise.resolve(),s=new Et;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Et,t.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let c=s;t.enqueueRetryable(()=>P(this,null,function*(){yield c.promise,yield i(this.currentUser)}))},u=c=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(c=>u(c)),setTimeout(()=>{if(!this.auth){let c=this.t.getImmediate({optional:!0});c?u(c):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Et)}},0),o()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(r=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string",31837,{l:r}),new Js(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let t=this.auth&&this.auth.getUid();return q(t===null||typeof t=="string",2055,{h:t}),new wt(t)}},Su=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=wt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}},Ru=class{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new Su(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(wt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Ai=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},Pu=class{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qd(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){q(this.o===void 0,3512);let r=s=>{s.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.m;return this.m=s.token,k("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>r(s))};let i=s=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.V.getImmediate({optional:!0});s?i(s):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ai(this.p));let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Ai(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}},Xd=class{getToken(){return Promise.resolve(new Ai(""))}invalidateToken(){}start(t,e){}shutdown(){}};function E_(n){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}function Nl(){return new TextEncoder}var Si=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516),r="";for(;r.length<20;){let i=E_(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<e&&(r+=t.charAt(i[s]%62))}return r}};function $(n,t){return n<t?-1:n>t?1:0}function Cu(n,t){let e=0;for(;e<n.length&&e<t.length;){let r=n.codePointAt(e),i=t.codePointAt(e);if(r!==i){if(r<128&&i<128)return $(r,i);{let s=Nl(),o=I_(s.encode(Jd(n,e)),s.encode(Jd(t,e)));return o!==0?o:$(r,i)}}e+=r>65535?2:1}return $(n.length,t.length)}function Jd(n,t){return n.codePointAt(t)>65535?n.substring(t,t+2):n.substring(t,t+1)}function I_(n,t){for(let e=0;e<n.length&&e<t.length;++e)if(n[e]!==t[e])return $(n[e],t[e]);return $(n.length,t.length)}function ar(n,t,e){return n.length===t.length&&n.every((r,i)=>e(r,t[i]))}function gm(n){return n+"\0"}var Du="__name__",Ys=class n{constructor(t,e,r){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&L(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return n.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof n?t.forEach(r=>{e.push(r)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let r=Math.min(t.length,e.length);for(let i=0;i<r;i++){let s=n.compareSegments(t.get(i),e.get(i));if(s!==0)return s}return $(t.length,e.length)}static compareSegments(t,e){let r=n.isNumericId(t),i=n.isNumericId(e);return r&&!i?-1:!r&&i?1:r&&i?n.extractNumericId(t).compare(n.extractNumericId(e)):Cu(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return ge.fromString(t.substring(4,t.length-2))}},H=class n extends Ys{construct(t,e,r){return new n(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let r of t){if(r.indexOf("//")>=0)throw new V(A.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter(i=>i.length>0))}return new n(e)}static emptyPath(){return new n([])}},T_=/^[_a-zA-Z][_a-zA-Z0-9]*$/,It=class n extends Ys{construct(t,e,r){return new n(t,e,r)}static isValidIdentifier(t){return T_.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Du}static keyField(){return new n([Du])}static fromServerFormat(t){let e=[],r="",i=0,s=()=>{if(r.length===0)throw new V(A.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""},o=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new V(A.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let c=t[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new V(A.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else u==="`"?(o=!o,i++):u!=="."||o?(r+=u,i++):(s(),i++)}if(s(),o)throw new V(A.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new n(e)}static emptyPath(){return new n([])}};var M=class n{constructor(t){this.path=t}static fromPath(t){return new n(H.fromString(t))}static fromName(t){return new n(H.fromString(t).popFirst(5))}static empty(){return new n(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&H.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return H.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new n(new H(t.slice()))}};function kl(n,t,e){if(!e)throw new V(A.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function b_(n,t,e,r){if(t===!0&&r===!0)throw new V(A.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Yd(n){if(!M.isDocumentKey(n))throw new V(A.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Zd(n){if(M.isDocumentKey(n))throw new V(A.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ym(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Zo(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Q(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new V(A.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=Zo(n);throw new V(A.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function _m(n,t){if(t<=0)throw new V(A.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${t}.`)}function vt(n,t){let e={typeString:n};return t&&(e.value=t),e}function On(n,t){if(!ym(n))throw new V(A.INVALID_ARGUMENT,"JSON must be an object");let e;for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}let o=n[r];if(i&&typeof o!==i){e=`JSON field '${r}' must be a ${i}.`;break}if(s!==void 0&&o!==s.value){e=`Expected '${r}' field to equal '${s.value}'`;break}}if(e)throw new V(A.INVALID_ARGUMENT,e);return!0}var tf=-62135596800,ef=1e6,ct=class n{static now(){return n.fromMillis(Date.now())}static fromDate(t){return n.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*ef);return new n(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new V(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new V(A.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<tf)throw new V(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(A.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ef}_compareTo(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:n._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(On(t,n._jsonSchema))return new n(t.seconds,t.nanoseconds)}valueOf(){let t=this.seconds-tf;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};ct._jsonSchemaVersion="firestore/timestamp/1.0",ct._jsonSchema={type:vt("string",ct._jsonSchemaVersion),seconds:vt("number"),nanoseconds:vt("number")};var z=class n{static fromTimestamp(t){return new n(t)}static min(){return new n(new ct(0,0))}static max(){return new n(new ct(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var ur=-1,$e=class{constructor(t,e,r,i){this.indexId=t,this.collectionGroup=e,this.fields=r,this.indexState=i}};function Vu(n){return n.fields.find(t=>t.kind===2)}function fn(n){return n.fields.filter(t=>t.kind!==2)}function A_(n,t){let e=$(n.collectionGroup,t.collectionGroup);if(e!==0)return e;for(let r=0;r<Math.min(n.fields.length,t.fields.length);++r)if(e=S_(n.fields[r],t.fields[r]),e!==0)return e;return $(n.fields.length,t.fields.length)}$e.UNKNOWN_ID=-1;var we=class{constructor(t,e){this.fieldPath=t,this.kind=e}};function S_(n,t){let e=It.comparator(n.fieldPath,t.fieldPath);return e!==0?e:$(n.kind,t.kind)}var cr=class n{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new n(0,Kt.min())}};function wm(n,t){let e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=z.fromTimestamp(r===1e9?new ct(e+1,0):new ct(e,r));return new Kt(i,M.empty(),t)}function vm(n){return new Kt(n.readTime,n.key,ur)}var Kt=class n{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new n(z.min(),M.empty(),ur)}static max(){return new n(z.max(),M.empty(),ur)}};function Ol(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:$(n.largestBatchId,t.largestBatchId))}var Em="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Zs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function tn(n){return P(this,null,function*(){if(n.code!==A.FAILED_PRECONDITION||n.message!==Em)throw n;k("LocalStore","Unexpectedly lost primary lease")})}var R=class n{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(r,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof n?e:n.resolve(e)}catch(e){return n.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):n.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):n.reject(e)}static resolve(t){return new n((e,r)=>{e(t)})}static reject(t){return new n((e,r)=>{r(t)})}static waitFor(t){return new n((e,r)=>{let i=0,s=0,o=!1;t.forEach(u=>{++i,u.next(()=>{++s,o&&s===i&&e()},c=>r(c))}),o=!0,s===i&&e()})}static or(t){let e=n.resolve(!1);for(let r of t)e=e.next(i=>i?n.resolve(i):r());return e}static forEach(t,e){let r=[];return t.forEach((i,s)=>{r.push(e.call(this,i,s))}),this.waitFor(r)}static mapArray(t,e){return new n((r,i)=>{let s=t.length,o=new Array(s),u=0;for(let c=0;c<s;c++){let h=c;e(t[h]).next(f=>{o[h]=f,++u,u===s&&r(o)},f=>i(f))}})}static doWhile(t,e){return new n((r,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):r()};s()})}};var qt="SimpleDb",to=class n{static open(t,e,r,i){try{return new n(e,t.transaction(i,r))}catch(s){throw new En(e,s)}}constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.S=new Et,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{e.error?this.S.reject(new En(t,e.error)):this.S.resolve()},this.transaction.onerror=r=>{let i=Fl(r.target.error);this.S.reject(new En(t,i))}}get D(){return this.S.promise}abort(t){t&&this.S.reject(t),this.aborted||(k(qt,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}v(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new Nu(e)}},Ge=class n{static delete(t){return k(qt,"Removing database:",t),pn(Ka().indexedDB.deleteDatabase(t)).toPromise()}static C(){if(!Ds())return!1;if(n.F())return!0;let t=ln(),e=n.M(t),r=0<e&&e<10,i=Im(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||s)}static F(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.O)==="YES"}static N(t,e){return t.store(e)}static M(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(t,e,r){this.name=t,this.version=e,this.B=r,this.L=null,n.M(ln())===12.2&&ft("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}k(t){return P(this,null,function*(){return this.db||(k(qt,"Opening database:",this.name),this.db=yield new Promise((e,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;e(o)},i.onblocked=()=>{r(new En(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new V(A.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new V(A.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new En(t,o))},i.onupgradeneeded=s=>{k(qt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;if(this.L!==null&&this.L!==s.oldVersion)throw new Error(`refusing to open IndexedDB database due to potential corruption of the IndexedDB database data; this corruption could be caused by clicking the "clear site data" button in a web browser; try reloading the web page to re-initialize the IndexedDB database: lastClosedDbVersion=${this.L}, event.oldVersion=${s.oldVersion}, event.newVersion=${s.newVersion}, db.version=${o.version}`);this.B.q(o,i.transaction,s.oldVersion,this.version).next(()=>{k(qt,"Database upgrade to version "+this.version+" complete")})}}),this.db.addEventListener("close",e=>{let r=e.target;this.L=r.version},{passive:!0})),this.db.addEventListener("versionchange",e=>{var r;e.newVersion===null&&(Mt('Received "versionchange" event with newVersion===null; notifying the registered DatabaseDeletedListener, if any'),(r=this.databaseDeletedListener)===null||r===void 0||r.call(this))},{passive:!0}),this.db})}setDatabaseDeletedListener(t){if(this.databaseDeletedListener)throw new Error("setDatabaseDeletedListener() may only be called once, and it has already been called");this.databaseDeletedListener=t}runTransaction(t,e,r,i){return P(this,null,function*(){let s=e==="readonly",o=0;for(;;){++o;try{this.db=yield this.k(t);let u=to.open(this.db,t,s?"readonly":"readwrite",r),c=i(u).next(h=>(u.v(),h)).catch(h=>(u.abort(h),R.reject(h))).toPromise();return c.catch(()=>{}),yield u.D,c}catch(u){let c=u,h=c.name!=="FirebaseError"&&o<3;if(k(qt,"Transaction failed with error:",c.message,"Retrying:",h),this.close(),!h)return Promise.reject(c)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function Im(n){let t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var xu=class{constructor(t){this.$=t,this.U=!1,this.K=null}get isDone(){return this.U}get W(){return this.K}set cursor(t){this.$=t}done(){this.U=!0}G(t){this.K=t}delete(){return pn(this.$.delete())}},En=class extends V{constructor(t,e){super(A.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function en(n){return n.name==="IndexedDbTransactionError"}var Nu=class{constructor(t){this.store=t}put(t,e){let r;return e!==void 0?(k(qt,"PUT",this.store.name,t,e),r=this.store.put(e,t)):(k(qt,"PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),pn(r)}add(t){return k(qt,"ADD",this.store.name,t,t),pn(this.store.add(t))}get(t){return pn(this.store.get(t)).next(e=>(e===void 0&&(e=null),k(qt,"GET",this.store.name,t,e),e))}delete(t){return k(qt,"DELETE",this.store.name,t),pn(this.store.delete(t))}count(){return k(qt,"COUNT",this.store.name),pn(this.store.count())}j(t,e){let r=this.options(t,e),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new R((o,u)=>{s.onerror=c=>{u(c.target.error)},s.onsuccess=c=>{o(c.target.result)}})}{let s=this.cursor(r),o=[];return this.J(s,(u,c)=>{o.push(c)}).next(()=>o)}}H(t,e){let r=this.store.getAll(t,e===null?void 0:e);return new R((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}Y(t,e){k(qt,"DELETE ALL",this.store.name);let r=this.options(t,e);r.Z=!1;let i=this.cursor(r);return this.J(i,(s,o,u)=>u.delete())}X(t,e){let r;e?r=t:(r={},e=t);let i=this.cursor(r);return this.J(i,e)}ee(t){let e=this.cursor({});return new R((r,i)=>{e.onerror=s=>{let o=Fl(s.target.error);i(o)},e.onsuccess=s=>{let o=s.target.result;o?t(o.primaryKey,o.value).next(u=>{u?o.continue():r()}):r()}})}J(t,e){let r=[];return new R((i,s)=>{t.onerror=o=>{s(o.target.error)},t.onsuccess=o=>{let u=o.target.result;if(!u)return void i();let c=new xu(u),h=e(u.primaryKey,u.value,c);if(h instanceof R){let f=h.catch(m=>(c.done(),R.reject(m)));r.push(f)}c.isDone?i():c.W===null?u.continue():u.continue(c.W)}}).next(()=>R.waitFor(r))}options(t,e){let r;return t!==void 0&&(typeof t=="string"?r=t:e=t),{index:r,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let r=this.store.index(t.index);return t.Z?r.openKeyCursor(t.range,e):r.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function pn(n){return new R((t,e)=>{n.onsuccess=r=>{let i=r.target.result;t(i)},n.onerror=r=>{let i=Fl(r.target.error);e(i)}})}var nf=!1;function Fl(n){let t=Ge.M(ln());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(e)>=0){let r=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return nf||(nf=!0,setTimeout(()=>{throw r},0)),r}}return n}var yi="IndexBackfiller",ku=class{constructor(t,e){this.asyncQueue=t,this.te=e,this.task=null}start(){this.ne(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ne(t){k(yi,`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>P(this,null,function*(){this.task=null;try{let e=yield this.te.re();k(yi,`Documents written: ${e}`)}catch(e){en(e)?k(yi,"Ignoring IndexedDB error during index backfill: ",e):yield tn(e)}yield this.ne(6e4)}))}},Ou=class{constructor(t,e){this.localStore=t,this.persistence=e}re(t=50){return P(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.ie(e,t))})}ie(t,e){let r=new Set,i=e,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(o=>{if(o!==null&&!r.has(o))return k(yi,`Processing collection: ${o}`),this.se(t,o,i).next(u=>{i-=u,r.add(o)});s=!1})).next(()=>e-i)}se(t,e,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(t,o).next(()=>this.oe(i,s)).next(u=>(k(yi,`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>o.size)}))}oe(t,e){let r=t;return e.changes.forEach((i,s)=>{let o=vm(s);Ol(o,r)>0&&(r=o)}),new Kt(r.readTime,r.documentKey,Math.max(e.batchId,t.largestBatchId))}};var jt=(()=>{class n{constructor(e,r){this.previousValue=e,r&&(r.sequenceNumberHandler=i=>this._e(i),this.ae=i=>r.writeSequenceNumber(i))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ae&&this.ae(e),e}}n.ue=-1;return n})(),qe=-1;function is(n){return n==null}function Ri(n){return n===0&&1/n==-1/0}function Tm(n){return typeof n=="number"&&Number.isInteger(n)&&!Ri(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var eo="";function Nt(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=rf(t)),t=R_(n.get(e),t);return rf(t)}function R_(n,t){let e=t,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":e+="";break;case eo:e+="";break;default:e+=s}}return e}function rf(n){return n+eo+""}function ee(n){let t=n.length;if(q(t>=2,64408,{path:n}),t===2)return q(n.charAt(0)===eo&&n.charAt(1)==="",56145,{path:n}),H.emptyPath();let e=t-2,r=[],i="";for(let s=0;s<t;){let o=n.indexOf(eo,s);switch((o<0||o>e)&&L(50515,{path:n}),n.charAt(o+1)){case"":let u=n.substring(s,o),c;i.length===0?c=u:(i+=u,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:L(61167,{path:n})}s=o+2}return new H(r)}var mn="remoteDocuments",ss="owner",Kn="owner",Pi="mutationQueues",P_="userId",Qt="mutations",sf="batchId",wn="userMutationsIndex",of=["userId","batchId"];function zs(n,t){return[n,Nt(t)]}function bm(n,t,e){return[n,Nt(t),e]}var C_={},lr="documentMutations",no="remoteDocumentsV14",D_=["prefixPath","collectionGroup","readTime","documentId"],$s="documentKeyIndex",V_=["prefixPath","collectionGroup","documentId"],Am="collectionGroupIndex",x_=["collectionGroup","readTime","prefixPath","documentId"],Ci="remoteDocumentGlobal",Fu="remoteDocumentGlobalKey",hr="targets",Sm="queryTargetsIndex",N_=["canonicalId","targetId"],dr="targetDocuments",k_=["targetId","path"],Ml="documentTargetsIndex",O_=["path","targetId"],ro="targetGlobalKey",In="targetGlobal",Di="collectionParents",F_=["collectionId","parent"],fr="clientMetadata",M_="clientId",ta="bundles",L_="bundleId",ea="namedQueries",B_="name",Ll="indexConfiguration",U_="indexId",Mu="collectionGroupIndex",q_="collectionGroup",_i="indexState",j_=["indexId","uid"],Rm="sequenceNumberIndex",z_=["uid","sequenceNumber"],wi="indexEntries",$_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Pm="documentKeyIndex",G_=["indexId","uid","orderedDocumentKey"],na="documentOverlays",K_=["userId","collectionPath","documentId"],Lu="collectionPathOverlayIndex",W_=["userId","collectionPath","largestBatchId"],Cm="collectionGroupOverlayIndex",Q_=["userId","collectionGroup","largestBatchId"],Bl="globals",H_="name",Dm=[Pi,Qt,lr,mn,hr,ss,In,dr,fr,Ci,Di,ta,ea],X_=[...Dm,na],Vm=[Pi,Qt,lr,no,hr,ss,In,dr,fr,Ci,Di,ta,ea,na],xm=Vm,Ul=[...xm,Ll,_i,wi],J_=Ul,Nm=[...Ul,Bl],Y_=Nm;var Vi=class extends Zs{constructor(t,e){super(),this.ce=t,this.currentSequenceNumber=e}};function bt(n,t){let e=O(n);return Ge.N(e.ce,t)}function af(n){let t=0;for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function nn(n,t){for(let e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function km(n,t){let e=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.push(t(n[r],r,n));return e}function Om(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}var at=class n{constructor(t,e){this.comparator=t,this.root=e||ie.EMPTY}insert(t,e){return new n(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ie.BLACK,null,null))}remove(t){return new n(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ie.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(t,r.key);if(i===0)return e+r.left.size;i<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,r)=>(t(e,r),!1))}toString(){let t=[];return this.inorderTraversal((e,r)=>(t.push(`${e}:${r}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new nr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new nr(this.root,t,this.comparator,!1)}getReverseIterator(){return new nr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new nr(this.root,t,this.comparator,!0)}},nr=class{constructor(t,e,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?r(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},ie=class n{constructor(t,e,r,i,s){this.key=t,this.value=e,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,i,s){return new n(t??this.key,e??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let i=this,s=r(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,r),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});let t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}};ie.EMPTY=null,ie.RED=!0,ie.BLACK=!1;ie.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,r,i,s){return this}insert(t,e,r){return new ie(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var rt=class n{constructor(t){this.comparator=t,this.data=new at(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,r)=>(t(e),!1))}forEachInRange(t,e){let r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new io(this.data.getIterator())}getIteratorFrom(t){return new io(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(r=>{e=e.add(r)}),e}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new n(this.comparator);return e.data=t,e}},io=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Wn(n){return n.hasNext()?n.getNext():void 0}var zt=class n{constructor(t){this.fields=t,t.sort(It.comparator)}static empty(){return new n([])}unionWith(t){let e=new rt(It.comparator);for(let r of this.fields)e=e.add(r);for(let r of t)e=e.add(r);return new n(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ar(this.fields,t.fields,(e,r)=>e.isEqual(r))}};var so=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function CE(){return typeof atob<"u"}var pt=class n{constructor(t){this.binaryString=t}static fromBase64String(t){let e=(function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new so("Invalid base64 string: "+s):s}})(t);return new n(e)}static fromUint8Array(t){let e=(function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s})(t);return new n(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return $(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};pt.EMPTY_BYTE_STRING=new pt("");var Z_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ie(n){if(q(!!n,39018),typeof n=="string"){let t=0,e=Z_.exec(n);if(q(!!e,46558,{timestamp:n}),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:ut(n.seconds),nanos:ut(n.nanos)}}function ut(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Te(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}var Fm="server_timestamp",Mm="__type__",Lm="__previous_value__",Bm="__local_write_time__";function ra(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[Mm])===null||e===void 0?void 0:e.stringValue)===Fm}function ia(n){let t=n.mapValue.fields[Lm];return ra(t)?ia(t):t}function xi(n){let t=Ie(n.mapValue.fields[Bm].timestampValue);return new ct(t.seconds,t.nanos)}var Bu=class{constructor(t,e,r,i,s,o,u,c,h,f){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=u,this.longPollingOptions=c,this.useFetchStreams=h,this.isUsingEmulator=f}},Ni="(default)",mr=class n{constructor(t,e){this.projectId=t,this.database=e||Ni}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===Ni}isEqual(t){return t instanceof n&&t.projectId===this.projectId&&t.database===this.database}};var ql="__type__",Um="__max__",Be={mapValue:{fields:{__type__:{stringValue:Um}}}},jl="__vector__",pr="value",Gs={nullValue:"NULL_VALUE"};function Ke(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ra(n)?4:qm(n)?9007199254740991:sa(n)?10:11:L(28295,{value:n})}function ae(n,t){if(n===t)return!0;let e=Ke(n);if(e!==Ke(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return xi(n).isEqual(xi(t));case 3:return(function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Ie(i.timestampValue),u=Ie(s.timestampValue);return o.seconds===u.seconds&&o.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(i,s){return Te(i.bytesValue).isEqual(Te(s.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(i,s){return ut(i.geoPointValue.latitude)===ut(s.geoPointValue.latitude)&&ut(i.geoPointValue.longitude)===ut(s.geoPointValue.longitude)})(n,t);case 2:return(function(i,s){if("integerValue"in i&&"integerValue"in s)return ut(i.integerValue)===ut(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=ut(i.doubleValue),u=ut(s.doubleValue);return o===u?Ri(o)===Ri(u):isNaN(o)&&isNaN(u)}return!1})(n,t);case 9:return ar(n.arrayValue.values||[],t.arrayValue.values||[],ae);case 10:case 11:return(function(i,s){let o=i.mapValue.fields||{},u=s.mapValue.fields||{};if(af(o)!==af(u))return!1;for(let c in o)if(o.hasOwnProperty(c)&&(u[c]===void 0||!ae(o[c],u[c])))return!1;return!0})(n,t);default:return L(52216,{left:n})}}function ki(n,t){return(n.values||[]).find(e=>ae(e,t))!==void 0}function We(n,t){if(n===t)return 0;let e=Ke(n),r=Ke(t);if(e!==r)return $(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,t.booleanValue);case 2:return(function(s,o){let u=ut(s.integerValue||s.doubleValue),c=ut(o.integerValue||o.doubleValue);return u<c?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1})(n,t);case 3:return uf(n.timestampValue,t.timestampValue);case 4:return uf(xi(n),xi(t));case 5:return Cu(n.stringValue,t.stringValue);case 6:return(function(s,o){let u=Te(s),c=Te(o);return u.compareTo(c)})(n.bytesValue,t.bytesValue);case 7:return(function(s,o){let u=s.split("/"),c=o.split("/");for(let h=0;h<u.length&&h<c.length;h++){let f=$(u[h],c[h]);if(f!==0)return f}return $(u.length,c.length)})(n.referenceValue,t.referenceValue);case 8:return(function(s,o){let u=$(ut(s.latitude),ut(o.latitude));return u!==0?u:$(ut(s.longitude),ut(o.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return cf(n.arrayValue,t.arrayValue);case 10:return(function(s,o){var u,c,h,f;let m=s.fields||{},g=o.fields||{},T=(u=m[pr])===null||u===void 0?void 0:u.arrayValue,D=(c=g[pr])===null||c===void 0?void 0:c.arrayValue,x=$(((h=T?.values)===null||h===void 0?void 0:h.length)||0,((f=D?.values)===null||f===void 0?void 0:f.length)||0);return x!==0?x:cf(T,D)})(n.mapValue,t.mapValue);case 11:return(function(s,o){if(s===Be.mapValue&&o===Be.mapValue)return 0;if(s===Be.mapValue)return 1;if(o===Be.mapValue)return-1;let u=s.fields||{},c=Object.keys(u),h=o.fields||{},f=Object.keys(h);c.sort(),f.sort();for(let m=0;m<c.length&&m<f.length;++m){let g=Cu(c[m],f[m]);if(g!==0)return g;let T=We(u[c[m]],h[f[m]]);if(T!==0)return T}return $(c.length,f.length)})(n.mapValue,t.mapValue);default:throw L(23264,{le:e})}}function uf(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return $(n,t);let e=Ie(n),r=Ie(t),i=$(e.seconds,r.seconds);return i!==0?i:$(e.nanos,r.nanos)}function cf(n,t){let e=n.values||[],r=t.values||[];for(let i=0;i<e.length&&i<r.length;++i){let s=We(e[i],r[i]);if(s)return s}return $(e.length,r.length)}function gr(n){return Uu(n)}function Uu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){let r=Ie(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return Te(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return M.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",i=!0;for(let s of e.values||[])i?i=!1:r+=",",r+=Uu(s);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){let r=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${Uu(e.fields[o])}`;return i+"}"})(n.mapValue):L(61005,{value:n})}function Ks(n){switch(Ke(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=ia(n);return t?16+Ks(t):16;case 5:return 2*n.stringValue.length;case 6:return Te(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce((i,s)=>i+Ks(s),0)})(n.arrayValue);case 10:case 11:return(function(r){let i=0;return nn(r.fields,(s,o)=>{i+=s.length+Ks(o)}),i})(n.mapValue);default:throw L(13486,{value:n})}}function Tn(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function qu(n){return!!n&&"integerValue"in n}function Oi(n){return!!n&&"arrayValue"in n}function lf(n){return!!n&&"nullValue"in n}function hf(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ws(n){return!!n&&"mapValue"in n}function sa(n){var t,e;return((e=(((t=n?.mapValue)===null||t===void 0?void 0:t.fields)||{})[ql])===null||e===void 0?void 0:e.stringValue)===jl}function vi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let t={mapValue:{fields:{}}};return nn(n.mapValue.fields,(e,r)=>t.mapValue.fields[e]=vi(r)),t}if(n.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=vi(n.arrayValue.values[e]);return t}return Object.assign({},n)}function qm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Um}var jm={mapValue:{fields:{[ql]:{stringValue:jl},[pr]:{arrayValue:{}}}}};function tw(n){return"nullValue"in n?Gs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Tn(mr.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?sa(n)?jm:{mapValue:{}}:L(35942,{value:n})}function ew(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Tn(mr.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?jm:"mapValue"in n?sa(n)?{mapValue:{}}:Be:L(61959,{value:n})}function df(n,t){let e=We(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?-1:!n.inclusive&&t.inclusive?1:0}function ff(n,t){let e=We(n.value,t.value);return e!==0?e:n.inclusive&&!t.inclusive?1:!n.inclusive&&t.inclusive?-1:0}var xt=class n{constructor(t){this.value=t}static empty(){return new n({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ws(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=vi(e)}setAll(t){let e=It.emptyPath(),r={},i=[];t.forEach((o,u)=>{if(!e.isImmediateParentOf(u)){let c=this.getFieldsMap(e);this.applyChanges(c,r,i),r={},i=[],e=u.popLast()}o?r[u.lastSegment()]=vi(o):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,r,i)}delete(t){let e=this.field(t.popLast());Ws(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ae(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let i=e.mapValue.fields[t.get(r)];Ws(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,r){nn(e,(i,s)=>t[i]=s);for(let i of r)delete t[i]}clone(){return new n(vi(this.value))}};function zm(n){let t=[];return nn(n.fields,(e,r)=>{let i=new It([e]);if(Ws(r)){let s=zm(r.mapValue).fields;if(s.length===0)t.push(i);else for(let o of s)t.push(i.child(o))}else t.push(i)}),new zt(t)}var Tt=class n{constructor(t,e,r,i,s,o,u){this.key=t,this.documentType=e,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=u}static newInvalidDocument(t){return new n(t,0,z.min(),z.min(),z.min(),xt.empty(),0)}static newFoundDocument(t,e,r,i){return new n(t,1,e,z.min(),r,i,0)}static newNoDocument(t,e){return new n(t,2,e,z.min(),z.min(),xt.empty(),0)}static newUnknownDocument(t,e){return new n(t,3,e,z.min(),z.min(),xt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(z.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=xt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=xt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=z.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof n&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var ue=class{constructor(t,e){this.position=t,this.inclusive=e}};function mf(n,t,e){let r=0;for(let i=0;i<n.position.length;i++){let s=t[i],o=n.position[i];if(s.field.isKeyField()?r=M.comparator(M.fromName(o.referenceValue),e.key):r=We(o,e.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function pf(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!ae(n.position[e],t.position[e]))return!1;return!0}var bn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function nw(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}var oo=class{},X=class n extends oo{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new $u(t,e,r):e==="array-contains"?new Wu(t,r):e==="in"?new ao(t,r):e==="not-in"?new Qu(t,r):e==="array-contains-any"?new Hu(t,r):new n(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Gu(t,r):new Ku(t,r)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(We(e,this.value)):e!==null&&Ke(this.value)===Ke(e)&&this.matchesComparison(We(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},et=class n extends oo{constructor(t,e){super(),this.filters=t,this.op=e,this.he=null}static create(t,e){return new n(t,e)}matches(t){return yr(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.he!==null||(this.he=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.he}getFilters(){return Object.assign([],this.filters)}};function yr(n){return n.op==="and"}function ju(n){return n.op==="or"}function zl(n){return $m(n)&&yr(n)}function $m(n){for(let t of n.filters)if(t instanceof et)return!1;return!0}function zu(n){if(n instanceof X)return n.field.canonicalString()+n.op.toString()+gr(n.value);if(zl(n))return n.filters.map(t=>zu(t)).join(",");{let t=n.filters.map(e=>zu(e)).join(",");return`${n.op}(${t})`}}function Gm(n,t){return n instanceof X?(function(r,i){return i instanceof X&&r.op===i.op&&r.field.isEqual(i.field)&&ae(r.value,i.value)})(n,t):n instanceof et?(function(r,i){return i instanceof et&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,u)=>s&&Gm(o,i.filters[u]),!0):!1})(n,t):void L(19439)}function Km(n,t){let e=n.filters.concat(t);return et.create(e,n.op)}function Wm(n){return n instanceof X?(function(e){return`${e.field.canonicalString()} ${e.op} ${gr(e.value)}`})(n):n instanceof et?(function(e){return e.op.toString()+" {"+e.getFilters().map(Wm).join(" ,")+"}"})(n):"Filter"}var $u=class extends X{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){let e=M.comparator(t.key,this.key);return this.matchesComparison(e)}},Gu=class extends X{constructor(t,e){super(t,"in",e),this.keys=Qm("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Ku=class extends X{constructor(t,e){super(t,"not-in",e),this.keys=Qm("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Qm(n,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(r=>M.fromName(r.referenceValue))}var Wu=class extends X{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Oi(e)&&ki(e.arrayValue,this.value)}},ao=class extends X{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&ki(this.value.arrayValue,e)}},Qu=class extends X{constructor(t,e){super(t,"not-in",e)}matches(t){if(ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!ki(this.value.arrayValue,e)}},Hu=class extends X{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Oi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(r=>ki(this.value.arrayValue,r))}};var Xu=class{constructor(t,e=null,r=[],i=[],s=null,o=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=u,this.Pe=null}};function Ju(n,t=null,e=[],r=[],i=null,s=null,o=null){return new Xu(n,t,e,r,i,s,o)}function An(n){let t=O(n);if(t.Pe===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(r=>zu(r)).join(","),e+="|ob:",e+=t.orderBy.map(r=>(function(s){return s.field.canonicalString()+s.dir})(r)).join(","),is(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(r=>gr(r)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(r=>gr(r)).join(",")),t.Pe=e}return t.Pe}function os(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!nw(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!Gm(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!pf(n.startAt,t.startAt)&&pf(n.endAt,t.endAt)}function uo(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function co(n,t){return n.filters.filter(e=>e instanceof X&&e.field.isEqual(t))}function gf(n,t,e){let r=Gs,i=!0;for(let s of co(n,t)){let o=Gs,u=!0;switch(s.op){case"<":case"<=":o=tw(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,u=!1;break;case"!=":case"not-in":o=Gs}df({value:r,inclusive:i},{value:o,inclusive:u})<0&&(r=o,i=u)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];df({value:r,inclusive:i},{value:o,inclusive:e.inclusive})<0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}function yf(n,t,e){let r=Be,i=!0;for(let s of co(n,t)){let o=Be,u=!0;switch(s.op){case">=":case">":o=ew(s.value),u=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,u=!1;break;case"!=":case"not-in":o=Be}ff({value:r,inclusive:i},{value:o,inclusive:u})>0&&(r=o,i=u)}if(e!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(t)){let o=e.position[s];ff({value:r,inclusive:i},{value:o,inclusive:e.inclusive})>0&&(r=o,i=e.inclusive);break}}return{value:r,inclusive:i}}var Ht=class{constructor(t,e=null,r=[],i=[],s=null,o="F",u=null,c=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=u,this.endAt=c,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}};function Hm(n,t,e,r,i,s,o,u){return new Ht(n,t,e,r,i,s,o,u)}function Vr(n){return new Ht(n)}function _f(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function $l(n){return n.collectionGroup!==null}function rr(n){let t=O(n);if(t.Te===null){t.Te=[];let e=new Set;for(let s of t.explicitOrderBy)t.Te.push(s),e.add(s.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let u=new rt(It.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(h=>{h.isInequality()&&(u=u.add(h.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.Te.push(new bn(s,r))}),e.has(It.keyField().canonicalString())||t.Te.push(new bn(It.keyField(),r))}return t.Te}function kt(n){let t=O(n);return t.Ie||(t.Ie=Jm(t,rr(n))),t.Ie}function Xm(n){let t=O(n);return t.de||(t.de=Jm(t,n.explicitOrderBy)),t.de}function Jm(n,t){if(n.limitType==="F")return Ju(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new bn(i.field,s)});let e=n.endAt?new ue(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ue(n.startAt.position,n.startAt.inclusive):null;return Ju(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function Yu(n,t){let e=n.filters.concat([t]);return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function lo(n,t,e){return new Ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function as(n,t){return os(kt(n),kt(t))&&n.limitType===t.limitType}function Ym(n){return`${An(kt(n))}|lt:${n.limitType}`}function Zn(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map(i=>Wm(i)).join(", ")}]`),is(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map(i=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(i)).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map(i=>gr(i)).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map(i=>gr(i)).join(",")),`Target(${r})`})(kt(n))}; limitType=${n.limitType})`}function us(n,t){return t.isFoundDocument()&&(function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):M.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)})(n,t)&&(function(r,i){for(let s of rr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0})(n,t)&&(function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0})(n,t)&&(function(r,i){return!(r.startAt&&!(function(o,u,c){let h=mf(o,u,c);return o.inclusive?h<=0:h<0})(r.startAt,rr(r),i)||r.endAt&&!(function(o,u,c){let h=mf(o,u,c);return o.inclusive?h>=0:h>0})(r.endAt,rr(r),i))})(n,t)}function Zm(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function tp(n){return(t,e)=>{let r=!1;for(let i of rr(n)){let s=rw(i,t,e);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function rw(n,t,e){let r=n.field.isKeyField()?M.comparator(t.key,e.key):(function(s,o,u){let c=o.data.field(s),h=u.data.field(s);return c!==null&&h!==null?We(c,h):L(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}var Xt=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let r=this.mapKeyFn(t),i=this.inner[r];if(i===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[e]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(t){nn(this.inner,(e,r)=>{for(let[i,s]of r)t(i,s)})}isEmpty(){return Om(this.inner)}size(){return this.innerSize}};var iw=new at(M.comparator);function Bt(){return iw}var ep=new at(M.comparator);function pi(...n){let t=ep;for(let e of n)t=t.insert(e.key,e);return t}function np(n){let t=ep;return n.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function ne(){return Ei()}function rp(){return Ei()}function Ei(){return new Xt(n=>n.toString(),(n,t)=>n.isEqual(t))}var sw=new at(M.comparator),ow=new rt(M.comparator);function G(...n){let t=ow;for(let e of n)t=t.add(e);return t}var aw=new rt($);function Gl(){return aw}function Kl(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ri(t)?"-0":t}}function ip(n){return{integerValue:""+n}}function sp(n,t){return Tm(t)?ip(t):Kl(n,t)}var _r=class{constructor(){this._=void 0}};function uw(n,t,e){return n instanceof Qe?(function(i,s){let o={fields:{[Mm]:{stringValue:Fm},[Bm]:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ra(s)&&(s=ia(s)),s&&(o.fields[Lm]=s),{mapValue:o}})(e,t):n instanceof be?ap(n,t):n instanceof Ae?up(n,t):(function(i,s){let o=op(i,s),u=wf(o)+wf(i.Ee);return qu(o)&&qu(i.Ee)?ip(u):Kl(i.serializer,u)})(n,t)}function cw(n,t,e){return n instanceof be?ap(n,t):n instanceof Ae?up(n,t):e}function op(n,t){return n instanceof He?(function(r){return qu(r)||(function(s){return!!s&&"doubleValue"in s})(r)})(t)?t:{integerValue:0}:null}var Qe=class extends _r{},be=class extends _r{constructor(t){super(),this.elements=t}};function ap(n,t){let e=cp(t);for(let r of n.elements)e.some(i=>ae(i,r))||e.push(r);return{arrayValue:{values:e}}}var Ae=class extends _r{constructor(t){super(),this.elements=t}};function up(n,t){let e=cp(t);for(let r of n.elements)e=e.filter(i=>!ae(i,r));return{arrayValue:{values:e}}}var He=class extends _r{constructor(t,e){super(),this.serializer=t,this.Ee=e}};function wf(n){return ut(n.integerValue||n.doubleValue)}function cp(n){return Oi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var Sn=class{constructor(t,e){this.field=t,this.transform=e}};function lw(n,t){return n.field.isEqual(t.field)&&(function(r,i){return r instanceof be&&i instanceof be||r instanceof Ae&&i instanceof Ae?ar(r.elements,i.elements,ae):r instanceof He&&i instanceof He?ae(r.Ee,i.Ee):r instanceof Qe&&i instanceof Qe})(n.transform,t.transform)}var Zu=class{constructor(t,e){this.version=t,this.transformResults=e}},dt=class n{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new n}static exists(t){return new n(void 0,t)}static updateTime(t){return new n(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function Qs(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}var wr=class{};function lp(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Je(n.key,dt.none()):new Xe(n.key,n.data,dt.none());{let e=n.data,r=xt.empty(),i=new rt(It.comparator);for(let s of t.fields)if(!i.has(s)){let o=e.field(s);o===null&&s.length>1&&(s=s.popLast(),o=e.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Jt(n.key,r,new zt(i.toArray()),dt.none())}}function hw(n,t,e){n instanceof Xe?(function(i,s,o){let u=i.value.clone(),c=Ef(i.fieldTransforms,s,o.transformResults);u.setAll(c),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()})(n,t,e):n instanceof Jt?(function(i,s,o){if(!Qs(i.precondition,s))return void s.convertToUnknownDocument(o.version);let u=Ef(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(hp(i)),c.setAll(u),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()})(n,t,e):(function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()})(0,t,e)}function Ii(n,t,e,r){return n instanceof Xe?(function(s,o,u,c){if(!Qs(s.precondition,o))return u;let h=s.value.clone(),f=If(s.fieldTransforms,c,o);return h.setAll(f),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),null})(n,t,e,r):n instanceof Jt?(function(s,o,u,c){if(!Qs(s.precondition,o))return u;let h=If(s.fieldTransforms,c,o),f=o.data;return f.setAll(hp(s)),f.setAll(h),o.convertToFoundDocument(o.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))})(n,t,e,r):(function(s,o,u){return Qs(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):u})(n,t,e)}function dw(n,t){let e=null;for(let r of n.fieldTransforms){let i=t.data.field(r.field),s=op(r.transform,i||null);s!=null&&(e===null&&(e=xt.empty()),e.set(r.field,s))}return e||null}function vf(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&ar(r,i,(s,o)=>lw(s,o))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}var Xe=class extends wr{constructor(t,e,r,i=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},Jt=class extends wr{constructor(t,e,r,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function hp(n){let t=new Map;return n.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let r=n.data.field(e);t.set(e,r)}}),t}function Ef(n,t,e){let r=new Map;q(n.length===e.length,32656,{Ae:e.length,Re:n.length});for(let i=0;i<e.length;i++){let s=n[i],o=s.transform,u=t.data.field(s.field);r.set(s.field,cw(o,u,e[i]))}return r}function If(n,t,e){let r=new Map;for(let i of n){let s=i.transform,o=e.data.field(i.field);r.set(i.field,uw(s,o,t))}return r}var Je=class extends wr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},Fi=class extends wr{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Mi=class{constructor(t,e,r,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(t,e){let r=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&hw(s,t,r[i])}}applyToLocalView(t,e){for(let r of this.baseMutations)r.key.isEqual(t.key)&&(e=Ii(r,t,e,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(t.key)&&(e=Ii(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let r=rp();return this.mutations.forEach(i=>{let s=t.get(i.key),o=s.overlayedDocument,u=this.applyToLocalView(o,s.mutatedFields);u=e.has(i.key)?null:u;let c=lp(o,u);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(z.min())}),r}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),G())}isEqual(t){return this.batchId===t.batchId&&ar(this.mutations,t.mutations,(e,r)=>vf(e,r))&&ar(this.baseMutations,t.baseMutations,(e,r)=>vf(e,r))}},tc=class n{constructor(t,e,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=i}static from(t,e,r){q(t.mutations.length===r.length,58842,{Ve:t.mutations.length,me:r.length});let i=(function(){return sw})(),s=t.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(t,e,r,i)}};var Li=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var ho=class{constructor(t,e,r){this.alias=t,this.aggregateType=e,this.fieldPath=r}};var ec=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var yt,Y;function dp(n){switch(n){case A.OK:return L(64938);case A.CANCELLED:case A.UNKNOWN:case A.DEADLINE_EXCEEDED:case A.RESOURCE_EXHAUSTED:case A.INTERNAL:case A.UNAVAILABLE:case A.UNAUTHENTICATED:return!1;case A.INVALID_ARGUMENT:case A.NOT_FOUND:case A.ALREADY_EXISTS:case A.PERMISSION_DENIED:case A.FAILED_PRECONDITION:case A.ABORTED:case A.OUT_OF_RANGE:case A.UNIMPLEMENTED:case A.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function fp(n){if(n===void 0)return ft("GRPC error has no .code"),A.UNKNOWN;switch(n){case yt.OK:return A.OK;case yt.CANCELLED:return A.CANCELLED;case yt.UNKNOWN:return A.UNKNOWN;case yt.DEADLINE_EXCEEDED:return A.DEADLINE_EXCEEDED;case yt.RESOURCE_EXHAUSTED:return A.RESOURCE_EXHAUSTED;case yt.INTERNAL:return A.INTERNAL;case yt.UNAVAILABLE:return A.UNAVAILABLE;case yt.UNAUTHENTICATED:return A.UNAUTHENTICATED;case yt.INVALID_ARGUMENT:return A.INVALID_ARGUMENT;case yt.NOT_FOUND:return A.NOT_FOUND;case yt.ALREADY_EXISTS:return A.ALREADY_EXISTS;case yt.PERMISSION_DENIED:return A.PERMISSION_DENIED;case yt.FAILED_PRECONDITION:return A.FAILED_PRECONDITION;case yt.ABORTED:return A.ABORTED;case yt.OUT_OF_RANGE:return A.OUT_OF_RANGE;case yt.UNIMPLEMENTED:return A.UNIMPLEMENTED;case yt.DATA_LOSS:return A.DATA_LOSS;default:return L(39323,{code:n})}}(Y=yt||(yt={}))[Y.OK=0]="OK",Y[Y.CANCELLED=1]="CANCELLED",Y[Y.UNKNOWN=2]="UNKNOWN",Y[Y.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Y[Y.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Y[Y.NOT_FOUND=5]="NOT_FOUND",Y[Y.ALREADY_EXISTS=6]="ALREADY_EXISTS",Y[Y.PERMISSION_DENIED=7]="PERMISSION_DENIED",Y[Y.UNAUTHENTICATED=16]="UNAUTHENTICATED",Y[Y.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Y[Y.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Y[Y.ABORTED=10]="ABORTED",Y[Y.OUT_OF_RANGE=11]="OUT_OF_RANGE",Y[Y.UNIMPLEMENTED=12]="UNIMPLEMENTED",Y[Y.INTERNAL=13]="INTERNAL",Y[Y.UNAVAILABLE=14]="UNAVAILABLE",Y[Y.DATA_LOSS=15]="DATA_LOSS";var fo=null;var fw=new ge([4294967295,4294967295],0);function Tf(n){let t=Nl().encode(n),e=new lu;return e.update(t),new Uint8Array(e.digest())}function bf(n){let t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new ge([e,r],0),new ge([i,s],0)]}var nc=class n{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new vn(`Invalid padding: ${e}`);if(r<0)throw new vn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new vn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new vn(`Invalid padding when bitmap length is 0: ${e}`);this.fe=8*t.length-e,this.ge=ge.fromNumber(this.fe)}pe(t,e,r){let i=t.add(e.multiply(ge.fromNumber(r)));return i.compare(fw)===1&&(i=new ge([i.getBits(0),i.getBits(1)],0)),i.modulo(this.ge).toNumber()}ye(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.fe===0)return!1;let e=Tf(t),[r,i]=bf(e);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);if(!this.ye(o))return!1}return!0}static create(t,e,r){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),o=new n(s,i,e);return r.forEach(u=>o.insert(u)),o}insert(t){if(this.fe===0)return;let e=Tf(t),[r,i]=bf(e);for(let s=0;s<this.hashCount;s++){let o=this.pe(r,i,s);this.we(o)}}we(t){let e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}},vn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var Bi=class n{constructor(t,e,r,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,r){let i=new Map;return i.set(t,Ui.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new n(z.min(),i,new at($),Bt(),G())}},Ui=class n{constructor(t,e,r,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new n(r,e,G(),G(),G())}};var ir=class{constructor(t,e,r,i){this.Se=t,this.removedTargetIds=e,this.key=r,this.be=i}},mo=class{constructor(t,e){this.targetId=t,this.De=e}},po=class{constructor(t,e,r=pt.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=i}},go=class{constructor(){this.ve=0,this.Ce=Af(),this.Fe=pt.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return this.ve!==0}get Ne(){return this.xe}Be(t){t.approximateByteSize()>0&&(this.xe=!0,this.Fe=t)}Le(){let t=G(),e=G(),r=G();return this.Ce.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:r=r.add(i);break;default:L(38017,{changeType:s})}}),new Ui(this.Fe,this.Me,t,e,r)}ke(){this.xe=!1,this.Ce=Af()}qe(t,e){this.xe=!0,this.Ce=this.Ce.insert(t,e)}Qe(t){this.xe=!0,this.Ce=this.Ce.remove(t)}$e(){this.ve+=1}Ue(){this.ve-=1,q(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}},rc=class{constructor(t){this.We=t,this.Ge=new Map,this.ze=Bt(),this.je=Ms(),this.Je=Ms(),this.He=new at($)}Ye(t){for(let e of t.Se)t.be&&t.be.isFoundDocument()?this.Ze(e,t.be):this.Xe(e,t.key,t.be);for(let e of t.removedTargetIds)this.Xe(e,t.key,t.be)}et(t){this.forEachTarget(t,e=>{let r=this.tt(e);switch(t.state){case 0:this.nt(e)&&r.Be(t.resumeToken);break;case 1:r.Ue(),r.Oe||r.ke(),r.Be(t.resumeToken);break;case 2:r.Ue(),r.Oe||this.removeTarget(e);break;case 3:this.nt(e)&&(r.Ke(),r.Be(t.resumeToken));break;case 4:this.nt(e)&&(this.rt(e),r.Be(t.resumeToken));break;default:L(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Ge.forEach((r,i)=>{this.nt(i)&&e(i)})}it(t){let e=t.targetId,r=t.De.count,i=this.st(e);if(i){let s=i.target;if(uo(s))if(r===0){let o=new M(s.path);this.Xe(e,o,Tt.newNoDocument(o,z.min()))}else q(r===1,20013,{expectedCount:r});else{let o=this.ot(e);if(o!==r){let u=this._t(t),c=u?this.ut(u,t,o):1;if(c!==0){this.rt(e);let h=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(e,h)}fo?.ct((function(f,m,g,T,D){var x,N,B,j,U,W;let tt={localCacheCount:f,existenceFilterCount:m.count,databaseId:g.database,projectId:g.projectId},K=m.unchangedNames;return K&&(tt.bloomFilter={applied:D===0,hashCount:(x=K?.hashCount)!==null&&x!==void 0?x:0,bitmapLength:(j=(B=(N=K?.bits)===null||N===void 0?void 0:N.bitmap)===null||B===void 0?void 0:B.length)!==null&&j!==void 0?j:0,padding:(W=(U=K?.bits)===null||U===void 0?void 0:U.padding)!==null&&W!==void 0?W:0,mightContain:v=>{var y;return(y=T?.mightContain(v))!==null&&y!==void 0&&y}}),tt})(o,t.De,this.We.lt(),u,c))}}}}_t(t){let e=t.De.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=e,o,u;try{o=Te(r).toUint8Array()}catch(c){if(c instanceof so)return Mt("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{u=new nc(o,i,s)}catch(c){return Mt(c instanceof vn?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return u.fe===0?null:u}ut(t,e,r){return e.De.count===r-this.ht(t,e.targetId)?0:2}ht(t,e){let r=this.We.getRemoteKeysForTarget(e),i=0;return r.forEach(s=>{let o=this.We.lt(),u=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Xe(e,s,null),i++)}),i}Pt(t){let e=new Map;this.Ge.forEach((s,o)=>{let u=this.st(o);if(u){if(s.current&&uo(u.target)){let c=new M(u.target.path);this.Tt(c).has(o)||this.It(o,c)||this.Xe(o,c,Tt.newNoDocument(c,t))}s.Ne&&(e.set(o,s.Le()),s.ke())}});let r=G();this.Je.forEach((s,o)=>{let u=!0;o.forEachWhile(c=>{let h=this.st(c);return!h||h.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ze.forEach((s,o)=>o.setReadTime(t));let i=new Bi(t,e,this.He,this.ze,r);return this.ze=Bt(),this.je=Ms(),this.Je=Ms(),this.He=new at($),i}Ze(t,e){if(!this.nt(t))return;let r=this.It(t,e.key)?2:0;this.tt(t).qe(e.key,r),this.ze=this.ze.insert(e.key,e),this.je=this.je.insert(e.key,this.Tt(e.key).add(t)),this.Je=this.Je.insert(e.key,this.dt(e.key).add(t))}Xe(t,e,r){if(!this.nt(t))return;let i=this.tt(t);this.It(t,e)?i.qe(e,1):i.Qe(e),this.Je=this.Je.insert(e,this.dt(e).delete(t)),this.Je=this.Je.insert(e,this.dt(e).add(t)),r&&(this.ze=this.ze.insert(e,r))}removeTarget(t){this.Ge.delete(t)}ot(t){let e=this.tt(t).Le();return this.We.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}$e(t){this.tt(t).$e()}tt(t){let e=this.Ge.get(t);return e||(e=new go,this.Ge.set(t,e)),e}dt(t){let e=this.Je.get(t);return e||(e=new rt($),this.Je=this.Je.insert(t,e)),e}Tt(t){let e=this.je.get(t);return e||(e=new rt($),this.je=this.je.insert(t,e)),e}nt(t){let e=this.st(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}st(t){let e=this.Ge.get(t);return e&&e.Oe?null:this.We.Et(t)}rt(t){this.Ge.set(t,new go),this.We.getRemoteKeysForTarget(t).forEach(e=>{this.Xe(t,e,null)})}It(t,e){return this.We.getRemoteKeysForTarget(t).has(e)}};function Ms(){return new at(M.comparator)}function Af(){return new at(M.comparator)}var mw={asc:"ASCENDING",desc:"DESCENDING"},pw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},gw={and:"AND",or:"OR"},ic=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function sc(n,t){return n.useProto3Json||is(t)?t:{value:t}}function vr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function mp(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function yw(n,t){return vr(n,t.toTimestamp())}function mt(n){return q(!!n,49232),z.fromTimestamp((function(e){let r=Ie(e);return new ct(r.seconds,r.nanos)})(n))}function Wl(n,t){return oc(n,t).canonicalString()}function oc(n,t){let e=(function(i){return new H(["projects",i.projectId,"databases",i.database])})(n).child("documents");return t===void 0?e:e.child(t)}function pp(n){let t=H.fromString(n);return q(bp(t),10190,{key:t.toString()}),t}function qi(n,t){return Wl(n.databaseId,t.path)}function se(n,t){let e=pp(t);if(e.get(1)!==n.databaseId.projectId)throw new V(A.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new V(A.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(_p(e))}function gp(n,t){return Wl(n.databaseId,t)}function yp(n){let t=pp(n);return t.length===4?H.emptyPath():_p(t)}function ac(n){return new H(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function _p(n){return q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Sf(n,t,e){return{name:qi(n,t),fields:e.value.mapValue.fields}}function oa(n,t,e){let r=se(n,t.name),i=mt(t.updateTime),s=t.createTime?mt(t.createTime):z.min(),o=new xt({mapValue:{fields:t.fields}}),u=Tt.newFoundDocument(r,i,s,o);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function _w(n,t){return"found"in t?(function(r,i){q(!!i.found,43571),i.found.name,i.found.updateTime;let s=se(r,i.found.name),o=mt(i.found.updateTime),u=i.found.createTime?mt(i.found.createTime):z.min(),c=new xt({mapValue:{fields:i.found.fields}});return Tt.newFoundDocument(s,o,u,c)})(n,t):"missing"in t?(function(r,i){q(!!i.missing,3894),q(!!i.readTime,22933);let s=se(r,i.missing),o=mt(i.readTime);return Tt.newNoDocument(s,o)})(n,t):L(7234,{result:t})}function ww(n,t){let e;if("targetChange"in t){t.targetChange;let r=(function(h){return h==="NO_CHANGE"?0:h==="ADD"?1:h==="REMOVE"?2:h==="CURRENT"?3:h==="RESET"?4:L(39313,{state:h})})(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=(function(h,f){return h.useProto3Json?(q(f===void 0||typeof f=="string",58123),pt.fromBase64String(f||"")):(q(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),pt.fromUint8Array(f||new Uint8Array))})(n,t.targetChange.resumeToken),o=t.targetChange.cause,u=o&&(function(h){let f=h.code===void 0?A.UNKNOWN:fp(h.code);return new V(f,h.message||"")})(o);e=new po(r,i,s,u||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=se(n,r.document.name),s=mt(r.document.updateTime),o=r.document.createTime?mt(r.document.createTime):z.min(),u=new xt({mapValue:{fields:r.document.fields}}),c=Tt.newFoundDocument(i,s,o,u),h=r.targetIds||[],f=r.removedTargetIds||[];e=new ir(h,f,c.key,c)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=se(n,r.document),s=r.readTime?mt(r.readTime):z.min(),o=Tt.newNoDocument(i,s),u=r.removedTargetIds||[];e=new ir([],u,o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=se(n,r.document),s=r.removedTargetIds||[];e=new ir([],s,i,null)}else{if(!("filter"in t))return L(11601,{At:t});{t.filter;let r=t.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new ec(i,s),u=r.targetId;e=new mo(u,o)}}return e}function ji(n,t){let e;if(t instanceof Xe)e={update:Sf(n,t.key,t.value)};else if(t instanceof Je)e={delete:qi(n,t.key)};else if(t instanceof Jt)e={update:Sf(n,t.key,t.data),updateMask:Aw(t.fieldMask)};else{if(!(t instanceof Fi))return L(16599,{Rt:t.type});e={verify:qi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(r=>(function(s,o){let u=o.transform;if(u instanceof Qe)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof be)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Ae)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof He)return{fieldPath:o.field.canonicalString(),increment:u.Ee};throw L(20930,{transform:o.transform})})(0,r))),t.precondition.isNone||(e.currentDocument=(function(i,s){return s.updateTime!==void 0?{updateTime:yw(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L(27497)})(n,t.precondition)),e}function uc(n,t){let e=t.currentDocument?(function(s){return s.updateTime!==void 0?dt.updateTime(mt(s.updateTime)):s.exists!==void 0?dt.exists(s.exists):dt.none()})(t.currentDocument):dt.none(),r=t.updateTransforms?t.updateTransforms.map(i=>(function(o,u){let c=null;if("setToServerValue"in u)q(u.setToServerValue==="REQUEST_TIME",16630,{proto:u}),c=new Qe;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];c=new be(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];c=new Ae(f)}else"increment"in u?c=new He(o,u.increment):L(16584,{proto:u});let h=It.fromServerFormat(u.fieldPath);return new Sn(h,c)})(n,i)):[];if(t.update){t.update.name;let i=se(n,t.update.name),s=new xt({mapValue:{fields:t.update.fields}});if(t.updateMask){let o=(function(c){let h=c.fieldPaths||[];return new zt(h.map(f=>It.fromServerFormat(f)))})(t.updateMask);return new Jt(i,s,o,e,r)}return new Xe(i,s,e,r)}if(t.delete){let i=se(n,t.delete);return new Je(i,e)}if(t.verify){let i=se(n,t.verify);return new Fi(i,e)}return L(1463,{proto:t})}function vw(n,t){return n&&n.length>0?(q(t!==void 0,14353),n.map(e=>(function(i,s){let o=i.updateTime?mt(i.updateTime):mt(s);return o.isEqual(z.min())&&(o=mt(s)),new Zu(o,i.transformResults||[])})(e,t))):[]}function wp(n,t){return{documents:[gp(n,t.path)]}}function aa(n,t){let e={structuredQuery:{}},r=t.path,i;t.collectionGroup!==null?(i=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=gp(n,i);let s=(function(h){if(h.length!==0)return Tp(et.create(h,"and"))})(t.filters);s&&(e.structuredQuery.where=s);let o=(function(h){if(h.length!==0)return h.map(f=>(function(g){return{field:Me(g.field),direction:Iw(g.dir)}})(f))})(t.orderBy);o&&(e.structuredQuery.orderBy=o);let u=sc(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(h){return{before:h.inclusive,values:h.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(h){return{before:!h.inclusive,values:h.position}})(t.endAt)),{Vt:e,parent:i}}function vp(n,t,e,r){let{Vt:i,parent:s}=aa(n,t),o={},u=[],c=0;return e.forEach(h=>{let f=r?h.alias:"aggregate_"+c++;o[f]=h.alias,h.aggregateType==="count"?u.push({alias:f,count:{}}):h.aggregateType==="avg"?u.push({alias:f,avg:{field:Me(h.fieldPath)}}):h.aggregateType==="sum"&&u.push({alias:f,sum:{field:Me(h.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:i.structuredQuery},parent:i.parent},ft:o,parent:s}}function Ep(n){let t=yp(n.parent),e=n.structuredQuery,r=e.from?e.from.length:0,i=null;if(r>0){q(r===1,65062);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=(function(m){let g=Ip(m);return g instanceof et&&zl(g)?g.getFilters():[g]})(e.where));let o=[];e.orderBy&&(o=(function(m){return m.map(g=>(function(D){return new bn(tr(D.field),(function(N){switch(N){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(D.direction))})(g))})(e.orderBy));let u=null;e.limit&&(u=(function(m){let g;return g=typeof m=="object"?m.value:m,is(g)?null:g})(e.limit));let c=null;e.startAt&&(c=(function(m){let g=!!m.before,T=m.values||[];return new ue(T,g)})(e.startAt));let h=null;return e.endAt&&(h=(function(m){let g=!m.before,T=m.values||[];return new ue(T,g)})(e.endAt)),Hm(t,i,o,s,u,"F",c,h)}function Ew(n,t){let e=(function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:i})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ip(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":let r=tr(e.unaryFilter.field);return X.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=tr(e.unaryFilter.field);return X.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=tr(e.unaryFilter.field);return X.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=tr(e.unaryFilter.field);return X.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(e){return X.create(tr(e.fieldFilter.field),(function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return et.create(e.compositeFilter.filters.map(r=>Ip(r)),(function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(e.compositeFilter.op))})(n):L(30097,{filter:n})}function Iw(n){return mw[n]}function Tw(n){return pw[n]}function bw(n){return gw[n]}function Me(n){return{fieldPath:n.canonicalString()}}function tr(n){return It.fromServerFormat(n.fieldPath)}function Tp(n){return n instanceof X?(function(e){if(e.op==="=="){if(hf(e.value))return{unaryFilter:{field:Me(e.field),op:"IS_NAN"}};if(lf(e.value))return{unaryFilter:{field:Me(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(hf(e.value))return{unaryFilter:{field:Me(e.field),op:"IS_NOT_NAN"}};if(lf(e.value))return{unaryFilter:{field:Me(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Me(e.field),op:Tw(e.op),value:e.value}}})(n):n instanceof et?(function(e){let r=e.getFilters().map(i=>Tp(i));return r.length===1?r[0]:{compositeFilter:{op:bw(e.op),filters:r}}})(n):L(54877,{filter:n})}function Aw(n){let t=[];return n.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function bp(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Er=class n{constructor(t,e,r,i,s=z.min(),o=z.min(),u=pt.EMPTY_BYTE_STRING,c=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=u,this.expectedCount=c}withSequenceNumber(t){return new n(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var yo=class{constructor(t){this.gt=t}};function Sw(n,t){let e;if(t.document)e=oa(n.gt,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let r=M.fromSegments(t.noDocument.path),i=Pn(t.noDocument.readTime);e=Tt.newNoDocument(r,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L(56709);{let r=M.fromSegments(t.unknownDocument.path),i=Pn(t.unknownDocument.version);e=Tt.newUnknownDocument(r,i)}}return t.readTime&&e.setReadTime((function(i){let s=new ct(i[0],i[1]);return z.fromTimestamp(s)})(t.readTime)),e}function Rf(n,t){let e=t.key,r={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:_o(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=(function(s,o){return{name:qi(s,o.key),fields:o.data.value.mapValue.fields,updateTime:vr(s,o.version.toTimestamp()),createTime:vr(s,o.createTime.toTimestamp())}})(n.gt,t);else if(t.isNoDocument())r.noDocument={path:e.path.toArray(),readTime:Rn(t.version)};else{if(!t.isUnknownDocument())return L(57904,{document:t});r.unknownDocument={path:e.path.toArray(),version:Rn(t.version)}}return r}function _o(n){let t=n.toTimestamp();return[t.seconds,t.nanoseconds]}function Rn(n){let t=n.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Pn(n){let t=new ct(n.seconds,n.nanoseconds);return z.fromTimestamp(t)}function gn(n,t){let e=(t.baseMutations||[]).map(s=>uc(n.gt,s));for(let s=0;s<t.mutations.length-1;++s){let o=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];o.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let r=t.mutations.map(s=>uc(n.gt,s)),i=ct.fromMillis(t.localWriteTimeMs);return new Mi(t.batchId,i,e,r)}function gi(n){let t=Pn(n.readTime),e=n.lastLimboFreeSnapshotVersion!==void 0?Pn(n.lastLimboFreeSnapshotVersion):z.min(),r;return r=(function(s){return s.documents!==void 0})(n.query)?(function(s){let o=s.documents.length;return q(o===1,1966,{count:o}),kt(Vr(yp(s.documents[0])))})(n.query):(function(s){return kt(Ep(s))})(n.query),new Er(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,t,e,pt.fromBase64String(n.resumeToken))}function Ap(n,t){let e=Rn(t.snapshotVersion),r=Rn(t.lastLimboFreeSnapshotVersion),i;i=uo(t.target)?wp(n.gt,t.target):aa(n.gt,t.target).Vt;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:An(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ua(n){let t=Ep({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?lo(t,t.limit,"L"):t}function gu(n,t){return new Li(t.largestBatchId,uc(n.gt,t.overlayMutation))}function Pf(n,t){let e=t.path.lastSegment();return[n,Nt(t.path.popLast()),e]}function Cf(n,t,e,r){return{indexId:n,uid:t,sequenceNumber:e,readTime:Rn(r.readTime),documentKey:Nt(r.documentKey.path),largestBatchId:r.largestBatchId}}var cc=class{getBundleMetadata(t,e){return Df(t).get(e).next(r=>{if(r)return(function(s){return{id:s.bundleId,createTime:Pn(s.createTime),version:s.version}})(r)})}saveBundleMetadata(t,e){return Df(t).put((function(i){return{bundleId:i.id,createTime:Rn(mt(i.createTime)),version:i.version}})(e))}getNamedQuery(t,e){return Vf(t).get(e).next(r=>{if(r)return(function(s){return{name:s.name,query:ua(s.bundledQuery),readTime:Pn(s.readTime)}})(r)})}saveNamedQuery(t,e){return Vf(t).put((function(i){return{name:i.name,readTime:Rn(mt(i.readTime)),bundledQuery:i.bundledQuery}})(e))}};function Df(n){return bt(n,ta)}function Vf(n){return bt(n,ea)}var wo=class n{constructor(t,e){this.serializer=t,this.userId=e}static yt(t,e){let r=e.uid||"";return new n(t,r)}getOverlay(t,e){return hi(t).get(Pf(this.userId,e)).next(r=>r?gu(this.serializer,r):null)}getOverlays(t,e){let r=ne();return R.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){let i=[];return r.forEach((s,o)=>{let u=new Li(e,o);i.push(this.wt(t,u))}),R.waitFor(i)}removeOverlaysForBatchId(t,e,r){let i=new Set;e.forEach(o=>i.add(Nt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let u=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(hi(t).Y(Lu,u))}),R.waitFor(s)}getOverlaysForCollection(t,e,r){let i=ne(),s=Nt(e),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return hi(t).j(Lu,o).next(u=>{for(let c of u){let h=gu(this.serializer,c);i.set(h.getKey(),h)}return i})}getOverlaysForCollectionGroup(t,e,r,i){let s=ne(),o,u=IDBKeyRange.bound([this.userId,e,r],[this.userId,e,Number.POSITIVE_INFINITY],!0);return hi(t).X({index:Cm,range:u},(c,h,f)=>{let m=gu(this.serializer,h);s.size()<i||m.largestBatchId===o?(s.set(m.getKey(),m),o=m.largestBatchId):f.done()}).next(()=>s)}wt(t,e){return hi(t).put((function(i,s,o){let[u,c,h]=Pf(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:h,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:ji(i.gt,o.mutation)}})(this.serializer,this.userId,e))}};function hi(n){return bt(n,na)}var lc=class{St(t){return bt(t,Bl)}getSessionToken(t){return this.St(t).get("sessionToken").next(e=>{let r=e?.value;return r?pt.fromUint8Array(r):pt.EMPTY_BYTE_STRING})}setSessionToken(t,e){return this.St(t).put({name:"sessionToken",value:e.toUint8Array()})}};var _e=class{constructor(){}bt(t,e){this.Dt(t,e),e.vt()}Dt(t,e){if("nullValue"in t)this.Ct(e,5);else if("booleanValue"in t)this.Ct(e,10),e.Ft(t.booleanValue?1:0);else if("integerValue"in t)this.Ct(e,15),e.Ft(ut(t.integerValue));else if("doubleValue"in t){let r=ut(t.doubleValue);isNaN(r)?this.Ct(e,13):(this.Ct(e,15),Ri(r)?e.Ft(0):e.Ft(r))}else if("timestampValue"in t){let r=t.timestampValue;this.Ct(e,20),typeof r=="string"&&(r=Ie(r)),e.Mt(`${r.seconds||""}`),e.Ft(r.nanos||0)}else if("stringValue"in t)this.xt(t.stringValue,e),this.Ot(e);else if("bytesValue"in t)this.Ct(e,30),e.Nt(Te(t.bytesValue)),this.Ot(e);else if("referenceValue"in t)this.Bt(t.referenceValue,e);else if("geoPointValue"in t){let r=t.geoPointValue;this.Ct(e,45),e.Ft(r.latitude||0),e.Ft(r.longitude||0)}else"mapValue"in t?qm(t)?this.Ct(e,Number.MAX_SAFE_INTEGER):sa(t)?this.Lt(t.mapValue,e):(this.kt(t.mapValue,e),this.Ot(e)):"arrayValue"in t?(this.qt(t.arrayValue,e),this.Ot(e)):L(19022,{Qt:t})}xt(t,e){this.Ct(e,25),this.$t(t,e)}$t(t,e){e.Mt(t)}kt(t,e){let r=t.fields||{};this.Ct(e,55);for(let i of Object.keys(r))this.xt(i,e),this.Dt(r[i],e)}Lt(t,e){var r,i;let s=t.fields||{};this.Ct(e,53);let o=pr,u=((i=(r=s[o].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.Ct(e,15),e.Ft(ut(u)),this.xt(o,e),this.Dt(s[o],e)}qt(t,e){let r=t.values||[];this.Ct(e,50);for(let i of r)this.Dt(i,e)}Bt(t,e){this.Ct(e,37),M.fromName(t).path.forEach(r=>{this.Ct(e,60),this.$t(r,e)})}Ct(t,e){t.Ft(e)}Ot(t){t.Ft(2)}};_e.Ut=new _e;var Qn=255;function Rw(n){if(n===0)return 8;let t=0;return n>>4||(t+=4,n<<=4),n>>6||(t+=2,n<<=2),n>>7||(t+=1),t}function xf(n){let t=64-(function(r){let i=0;for(let s=0;s<8;++s){let o=Rw(255&r[s]);if(i+=o,o!==8)break}return i})(n);return Math.ceil(t/8)}var hc=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Kt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.Wt(r.value),r=e.next();this.Gt()}zt(t){let e=t[Symbol.iterator](),r=e.next();for(;!r.done;)this.jt(r.value),r=e.next();this.Jt()}Ht(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.Wt(r);else if(r<2048)this.Wt(960|r>>>6),this.Wt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.Wt(480|r>>>12),this.Wt(128|63&r>>>6),this.Wt(128|63&r);else{let i=e.codePointAt(0);this.Wt(240|i>>>18),this.Wt(128|63&i>>>12),this.Wt(128|63&i>>>6),this.Wt(128|63&i)}}this.Gt()}Yt(t){for(let e of t){let r=e.charCodeAt(0);if(r<128)this.jt(r);else if(r<2048)this.jt(960|r>>>6),this.jt(128|63&r);else if(e<"\uD800"||"\uDBFF"<e)this.jt(480|r>>>12),this.jt(128|63&r>>>6),this.jt(128|63&r);else{let i=e.codePointAt(0);this.jt(240|i>>>18),this.jt(128|63&i>>>12),this.jt(128|63&i>>>6),this.jt(128|63&i)}}this.Jt()}Zt(t){let e=this.Xt(t),r=xf(e);this.en(1+r),this.buffer[this.position++]=255&r;for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=255&e[i]}tn(t){let e=this.Xt(t),r=xf(e);this.en(1+r),this.buffer[this.position++]=~(255&r);for(let i=e.length-r;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}nn(){this.rn(Qn),this.rn(255)}sn(){this._n(Qn),this._n(255)}reset(){this.position=0}seed(t){this.en(t.length),this.buffer.set(t,this.position),this.position+=t.length}an(){return this.buffer.slice(0,this.position)}Xt(t){let e=(function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)})(t),r=!!(128&e[0]);e[0]^=r?255:128;for(let i=1;i<e.length;++i)e[i]^=r?255:0;return e}Wt(t){let e=255&t;e===0?(this.rn(0),this.rn(255)):e===Qn?(this.rn(Qn),this.rn(0)):this.rn(e)}jt(t){let e=255&t;e===0?(this._n(0),this._n(255)):e===Qn?(this._n(Qn),this._n(0)):this._n(t)}Gt(){this.rn(0),this.rn(1)}Jt(){this._n(0),this._n(1)}rn(t){this.en(1),this.buffer[this.position++]=t}_n(t){this.en(1),this.buffer[this.position++]=~t}en(t){let e=t+this.position;if(e<=this.buffer.length)return;let r=2*this.buffer.length;r<e&&(r=e);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},dc=class{constructor(t){this.un=t}Nt(t){this.un.Kt(t)}Mt(t){this.un.Ht(t)}Ft(t){this.un.Zt(t)}vt(){this.un.nn()}},fc=class{constructor(t){this.un=t}Nt(t){this.un.zt(t)}Mt(t){this.un.Yt(t)}Ft(t){this.un.tn(t)}vt(){this.un.sn()}},yn=class{constructor(){this.un=new hc,this.cn=new dc(this.un),this.ln=new fc(this.un)}seed(t){this.un.seed(t)}hn(t){return t===0?this.cn:this.ln}an(){return this.un.an()}reset(){this.un.reset()}};var _n=class n{constructor(t,e,r,i){this.Pn=t,this.Tn=e,this.In=r,this.dn=i}En(){let t=this.dn.length,e=t===0||this.dn[t-1]===255?t+1:t,r=new Uint8Array(e);return r.set(this.dn,0),e!==t?r.set([0],this.dn.length):++r[r.length-1],new n(this.Pn,this.Tn,this.In,r)}An(t,e,r){return{indexId:this.Pn,uid:t,arrayValue:Hs(this.In),directionalValue:Hs(this.dn),orderedDocumentKey:Hs(e),documentKey:r.path.toArray()}}Rn(t,e,r){let i=this.An(t,e,r);return[i.indexId,i.uid,i.arrayValue,i.directionalValue,i.orderedDocumentKey,i.documentKey]}};function ke(n,t){let e=n.Pn-t.Pn;return e!==0?e:(e=Nf(n.In,t.In),e!==0?e:(e=Nf(n.dn,t.dn),e!==0?e:M.comparator(n.Tn,t.Tn)))}function Nf(n,t){for(let e=0;e<n.length&&e<t.length;++e){let r=n[e]-t[e];if(r!==0)return r}return n.length-t.length}function Hs(n){return Xa()?(function(e){let r="";for(let i=0;i<e.length;i++)r+=String.fromCharCode(e[i]);return r})(n):n}function kf(n){return typeof n!="string"?n:(function(e){let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r})(n)}var vo=class{constructor(t){this.Vn=new rt((e,r)=>It.comparator(e.field,r.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.mn=t.orderBy,this.fn=[];for(let e of t.filters){let r=e;r.isInequality()?this.Vn=this.Vn.add(r):this.fn.push(r)}}get gn(){return this.Vn.size>1}pn(t){if(q(t.collectionGroup===this.collectionId,49279),this.gn)return!1;let e=Vu(t);if(e!==void 0&&!this.yn(e))return!1;let r=fn(t),i=new Set,s=0,o=0;for(;s<r.length&&this.yn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Vn.size>0){let u=this.Vn.getIterator().getNext();if(!i.has(u.field.canonicalString())){let c=r[s];if(!this.wn(u,c)||!this.Sn(this.mn[o++],c))return!1}++s}for(;s<r.length;++s){let u=r[s];if(o>=this.mn.length||!this.Sn(this.mn[o++],u))return!1}return!0}bn(){if(this.gn)return null;let t=new rt(It.comparator),e=[];for(let r of this.fn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")e.push(new we(r.field,2));else{if(t.has(r.field))continue;t=t.add(r.field),e.push(new we(r.field,0))}for(let r of this.mn)r.field.isKeyField()||t.has(r.field)||(t=t.add(r.field),e.push(new we(r.field,r.dir==="asc"?0:1)));return new $e($e.UNKNOWN_ID,this.collectionId,e,cr.empty())}yn(t){for(let e of this.fn)if(this.wn(e,t))return!0;return!1}wn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let r=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===r}Sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function Sp(n){var t,e;if(q(n instanceof X||n instanceof et,20012),n instanceof X){if(n instanceof ao){let i=((e=(t=n.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>X.create(n.field,"==",s)))||[];return et.create(i,"or")}return n}let r=n.filters.map(i=>Sp(i));return et.create(r,n.op)}function Pw(n){if(n.getFilters().length===0)return[];let t=gc(Sp(n));return q(Rp(t),7391),mc(t)||pc(t)?[t]:t.getFilters()}function mc(n){return n instanceof X}function pc(n){return n instanceof et&&zl(n)}function Rp(n){return mc(n)||pc(n)||(function(e){if(e instanceof et&&ju(e)){for(let r of e.getFilters())if(!mc(r)&&!pc(r))return!1;return!0}return!1})(n)}function gc(n){if(q(n instanceof X||n instanceof et,34018),n instanceof X)return n;if(n.filters.length===1)return gc(n.filters[0]);let t=n.filters.map(r=>gc(r)),e=et.create(t,n.op);return e=Eo(e),Rp(e)?e:(q(e instanceof et,64498),q(yr(e),40251),q(e.filters.length>1,57927),e.filters.reduce((r,i)=>Ql(r,i)))}function Ql(n,t){let e;return q(n instanceof X||n instanceof et,38388),q(t instanceof X||t instanceof et,25473),e=n instanceof X?t instanceof X?(function(i,s){return et.create([i,s],"and")})(n,t):Of(n,t):t instanceof X?Of(t,n):(function(i,s){if(q(i.filters.length>0&&s.filters.length>0,48005),yr(i)&&yr(s))return Km(i,s.getFilters());let o=ju(i)?i:s,u=ju(i)?s:i,c=o.filters.map(h=>Ql(h,u));return et.create(c,"or")})(n,t),Eo(e)}function Of(n,t){if(yr(t))return Km(t,n.getFilters());{let e=t.filters.map(r=>Ql(n,r));return et.create(e,"or")}}function Eo(n){if(q(n instanceof X||n instanceof et,11850),n instanceof X)return n;let t=n.getFilters();if(t.length===1)return Eo(t[0]);if($m(n))return n;let e=t.map(i=>Eo(i)),r=[];return e.forEach(i=>{i instanceof X?r.push(i):i instanceof et&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:et.create(r,n.op)}var yc=class{constructor(){this.Dn=new zi}addToCollectionParentIndex(t,e){return this.Dn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Dn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(Kt.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(Kt.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}},zi=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e]||new rt(H.comparator),s=!i.has(r);return this.index[e]=i.add(r),s}has(t){let e=t.lastSegment(),r=t.popLast(),i=this.index[e];return i&&i.has(r)}getEntries(t){return(this.index[t]||new rt(H.comparator)).toArray()}};var Ff="IndexedDbIndexManager",Ls=new Uint8Array(0),_c=class{constructor(t,e){this.databaseId=e,this.vn=new zi,this.Cn=new Xt(r=>An(r),(r,i)=>os(r,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.vn.has(e)){let r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.vn.add(e)});let s={collectionId:r,parent:Nt(i)};return Mf(t).put(s)}return R.resolve()}getCollectionParents(t,e){let r=[],i=IDBKeyRange.bound([e,""],[gm(e),""],!1,!0);return Mf(t).j(i).next(s=>{for(let o of s){if(o.collectionId!==e)break;r.push(ee(o.parent))}return r})}addFieldIndex(t,e){let r=di(t),i=(function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}})(e);delete i.indexId;let s=r.add(i);if(e.indexState){let o=Xn(t);return s.next(u=>{o.put(Cf(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let r=di(t),i=Xn(t),s=Hn(t);return r.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=di(t),r=Hn(t),i=Xn(t);return e.Y().next(()=>r.Y()).next(()=>i.Y())}createTargetIndexes(t,e){return R.forEach(this.Fn(e),r=>this.getIndexType(t,r).next(i=>{if(i===0||i===1){let s=new vo(r).bn();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let r=Hn(t),i=!0,s=new Map;return R.forEach(this.Fn(e),o=>this.Mn(t,o).next(u=>{i&&(i=!!u),s.set(o,u)})).next(()=>{if(i){let o=G(),u=[];return R.forEach(s,(c,h)=>{k(Ff,`Using index ${(function(U){return`id=${U.indexId}|cg=${U.collectionGroup}|f=${U.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`})(c)} to execute ${An(e)}`);let f=(function(U,W){let tt=Vu(W);if(tt===void 0)return null;for(let K of co(U,tt.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null})(h,c),m=(function(U,W){let tt=new Map;for(let K of fn(W))for(let v of co(U,K.fieldPath))switch(v.op){case"==":case"in":tt.set(K.fieldPath.canonicalString(),v.value);break;case"not-in":case"!=":return tt.set(K.fieldPath.canonicalString(),v.value),Array.from(tt.values())}return null})(h,c),g=(function(U,W){let tt=[],K=!0;for(let v of fn(W)){let y=v.kind===0?gf(U,v.fieldPath,U.startAt):yf(U,v.fieldPath,U.startAt);tt.push(y.value),K&&(K=y.inclusive)}return new ue(tt,K)})(h,c),T=(function(U,W){let tt=[],K=!0;for(let v of fn(W)){let y=v.kind===0?yf(U,v.fieldPath,U.endAt):gf(U,v.fieldPath,U.endAt);tt.push(y.value),K&&(K=y.inclusive)}return new ue(tt,K)})(h,c),D=this.xn(c,h,g),x=this.xn(c,h,T),N=this.On(c,h,m),B=this.Nn(c.indexId,f,D,g.inclusive,x,T.inclusive,N);return R.forEach(B,j=>r.H(j,e.limit).next(U=>{U.forEach(W=>{let tt=M.fromSegments(W.documentKey);o.has(tt)||(o=o.add(tt),u.push(tt))})}))}).next(()=>u)}return R.resolve(null)})}Fn(t){let e=this.Cn.get(t);return e||(t.filters.length===0?e=[t]:e=Pw(et.create(t.filters,"and")).map(r=>Ju(t.path,t.collectionGroup,t.orderBy,r.getFilters(),t.limit,t.startAt,t.endAt)),this.Cn.set(t,e),e)}Nn(t,e,r,i,s,o,u){let c=(e!=null?e.length:1)*Math.max(r.length,s.length),h=c/(e!=null?e.length:1),f=[];for(let m=0;m<c;++m){let g=e?this.Bn(e[m/h]):Ls,T=this.Ln(t,g,r[m%h],i),D=this.kn(t,g,s[m%h],o),x=u.map(N=>this.Ln(t,g,N,!0));f.push(...this.createRange(T,D,x))}return f}Ln(t,e,r,i){let s=new _n(t,M.empty(),e,r);return i?s:s.En()}kn(t,e,r,i){let s=new _n(t,M.empty(),e,r);return i?s.En():s}Mn(t,e){let r=new vo(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let o=null;for(let u of s)r.pn(u)&&(!o||u.fields.length>o.fields.length)&&(o=u);return o})}getIndexType(t,e){let r=2,i=this.Fn(e);return R.forEach(i,s=>this.Mn(t,s).next(o=>{o?r!==0&&o.fields.length<(function(c){let h=new rt(It.comparator),f=!1;for(let m of c.filters)for(let g of m.getFlattenedFilters())g.field.isKeyField()||(g.op==="array-contains"||g.op==="array-contains-any"?f=!0:h=h.add(g.field));for(let m of c.orderBy)m.field.isKeyField()||(h=h.add(m.field));return h.size+(f?1:0)})(s)&&(r=1):r=0})).next(()=>(function(o){return o.limit!==null})(e)&&i.length>1&&r===2?1:r)}qn(t,e){let r=new yn;for(let i of fn(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let o=r.hn(i.kind);_e.Ut.bt(s,o)}return r.an()}Bn(t){let e=new yn;return _e.Ut.bt(t,e.hn(0)),e.an()}Qn(t,e){let r=new yn;return _e.Ut.bt(Tn(this.databaseId,e),r.hn((function(s){let o=fn(s);return o.length===0?0:o[o.length-1].kind})(t))),r.an()}On(t,e,r){if(r===null)return[];let i=[];i.push(new yn);let s=0;for(let o of fn(t)){let u=r[s++];for(let c of i)if(this.$n(e,o.fieldPath)&&Oi(u))i=this.Un(i,o,u);else{let h=c.hn(o.kind);_e.Ut.bt(u,h)}}return this.Kn(i)}xn(t,e,r){return this.On(t,e,r.position)}Kn(t){let e=[];for(let r=0;r<t.length;++r)e[r]=t[r].an();return e}Un(t,e,r){let i=[...t],s=[];for(let o of r.arrayValue.values||[])for(let u of i){let c=new yn;c.seed(u.an()),_e.Ut.bt(o,c.hn(e.kind)),s.push(c)}return s}$n(t,e){return!!t.filters.find(r=>r instanceof X&&r.field.isEqual(e)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(t,e){let r=di(t),i=Xn(t);return(e?r.j(Mu,IDBKeyRange.bound(e,e)):r.j()).next(s=>{let o=[];return R.forEach(s,u=>i.get([u.indexId,this.uid]).next(c=>{o.push((function(f,m){let g=m?new cr(m.sequenceNumber,new Kt(Pn(m.readTime),new M(ee(m.documentKey)),m.largestBatchId)):cr.empty(),T=f.fields.map(([D,x])=>new we(It.fromServerFormat(D),x));return new $e(f.indexId,f.collectionGroup,T,g)})(u,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:$(r.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,r){let i=di(t),s=Xn(t);return this.Wn(t).next(o=>i.j(Mu,IDBKeyRange.bound(e,e)).next(u=>R.forEach(u,c=>s.put(Cf(c.indexId,this.uid,o,r)))))}updateIndexEntries(t,e){let r=new Map;return R.forEach(e,(i,s)=>{let o=r.get(i.collectionGroup);return(o?R.resolve(o):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(r.set(i.collectionGroup,u),R.forEach(u,c=>this.Gn(t,i,c).next(h=>{let f=this.zn(s,c);return h.isEqual(f)?R.resolve():this.jn(t,s,c,h,f)}))))})}Jn(t,e,r,i){return Hn(t).put(i.An(this.uid,this.Qn(r,e.key),e.key))}Hn(t,e,r,i){return Hn(t).delete(i.Rn(this.uid,this.Qn(r,e.key),e.key))}Gn(t,e,r){let i=Hn(t),s=new rt(ke);return i.X({index:Pm,range:IDBKeyRange.only([r.indexId,this.uid,Hs(this.Qn(r,e))])},(o,u)=>{s=s.add(new _n(r.indexId,e,kf(u.arrayValue),kf(u.directionalValue)))}).next(()=>s)}zn(t,e){let r=new rt(ke),i=this.qn(e,t);if(i==null)return r;let s=Vu(e);if(s!=null){let o=t.data.field(s.fieldPath);if(Oi(o))for(let u of o.arrayValue.values||[])r=r.add(new _n(e.indexId,t.key,this.Bn(u),i))}else r=r.add(new _n(e.indexId,t.key,Ls,i));return r}jn(t,e,r,i,s){k(Ff,"Updating index entries for document '%s'",e.key);let o=[];return(function(c,h,f,m,g){let T=c.getIterator(),D=h.getIterator(),x=Wn(T),N=Wn(D);for(;x||N;){let B=!1,j=!1;if(x&&N){let U=f(x,N);U<0?j=!0:U>0&&(B=!0)}else x!=null?j=!0:B=!0;B?(m(N),N=Wn(D)):j?(g(x),x=Wn(T)):(x=Wn(T),N=Wn(D))}})(i,s,ke,u=>{o.push(this.Jn(t,e,r,u))},u=>{o.push(this.Hn(t,e,r,u))}),R.waitFor(o)}Wn(t){let e=1;return Xn(t).X({index:Rm,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,r){r=r.sort((o,u)=>ke(o,u)).filter((o,u,c)=>!u||ke(o,c[u-1])!==0);let i=[];i.push(t);for(let o of r){let u=ke(o,t),c=ke(o,e);if(u===0)i[0]=t.En();else if(u>0&&c<0)i.push(o),i.push(o.En());else if(c>0)break}i.push(e);let s=[];for(let o=0;o<i.length;o+=2){if(this.Yn(i[o],i[o+1]))return[];let u=i[o].Rn(this.uid,Ls,M.empty()),c=i[o+1].Rn(this.uid,Ls,M.empty());s.push(IDBKeyRange.bound(u,c))}return s}Yn(t,e){return ke(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next(Lf)}getMinOffset(t,e){return R.mapArray(this.Fn(e),r=>this.Mn(t,r).next(i=>i||L(44426))).next(Lf)}};function Mf(n){return bt(n,Di)}function Hn(n){return bt(n,wi)}function di(n){return bt(n,Ll)}function Xn(n){return bt(n,_i)}function Lf(n){q(n.length!==0,28825);let t=n[0].indexState.offset,e=t.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Ol(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new Kt(t.readTime,t.documentKey,e)}var Bf={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pp=41943040,Lt=class n{static withCacheSize(t){return new n(t,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}};function Cp(n,t,e){let r=n.store(Qt),i=n.store(lr),s=[],o=IDBKeyRange.only(e.batchId),u=0,c=r.X({range:o},(f,m,g)=>(u++,g.delete()));s.push(c.next(()=>{q(u===1,47070,{batchId:e.batchId})}));let h=[];for(let f of e.mutations){let m=bm(t,f.key.path,e.batchId);s.push(i.delete(m)),h.push(f.key)}return R.waitFor(s).next(()=>h)}function Io(n){if(!n)return 0;let t;if(n.document)t=n.document;else if(n.unknownDocument)t=n.unknownDocument;else{if(!n.noDocument)throw L(14731);t=n.noDocument}return JSON.stringify(t).length}Lt.DEFAULT_COLLECTION_PERCENTILE=10,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lt.DEFAULT=new Lt(Pp,Lt.DEFAULT_COLLECTION_PERCENTILE,Lt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lt.DISABLED=new Lt(-1,0,0);var To=class n{constructor(t,e,r,i){this.userId=t,this.serializer=e,this.indexManager=r,this.referenceDelegate=i,this.Zn={}}static yt(t,e,r,i){q(t.uid!=="",64387);let s=t.isAuthenticated()?t.uid:"";return new n(s,e,r,i)}checkEmpty(t){let e=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Oe(t).X({index:wn,range:r},(i,s,o)=>{e=!1,o.done()}).next(()=>e)}addMutationBatch(t,e,r,i){let s=er(t),o=Oe(t);return o.add({}).next(u=>{q(typeof u=="number",49019);let c=new Mi(u,e,r,i),h=(function(T,D,x){let N=x.baseMutations.map(j=>ji(T.gt,j)),B=x.mutations.map(j=>ji(T.gt,j));return{userId:D,batchId:x.batchId,localWriteTimeMs:x.localWriteTime.toMillis(),baseMutations:N,mutations:B}})(this.serializer,this.userId,c),f=[],m=new rt((g,T)=>$(g.canonicalString(),T.canonicalString()));for(let g of i){let T=bm(this.userId,g.key.path,u);m=m.add(g.key.path.popLast()),f.push(o.put(h)),f.push(s.put(T,C_))}return m.forEach(g=>{f.push(this.indexManager.addToCollectionParentIndex(t,g))}),t.addOnCommittedListener(()=>{this.Zn[u]=c.keys()}),R.waitFor(f).next(()=>c)})}lookupMutationBatch(t,e){return Oe(t).get(e).next(r=>r?(q(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:e}),gn(this.serializer,r)):null)}Xn(t,e){return this.Zn[e]?R.resolve(this.Zn[e]):this.lookupMutationBatch(t,e).next(r=>{if(r){let i=r.keys();return this.Zn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return Oe(t).X({index:wn,range:i},(o,u,c)=>{u.userId===this.userId&&(q(u.batchId>=r,47524,{er:r}),s=gn(this.serializer,u)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=qe;return Oe(t).X({index:wn,range:e,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,qe],[this.userId,Number.POSITIVE_INFINITY]);return Oe(t).j(wn,e).next(r=>r.map(i=>gn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let r=zs(this.userId,e.path),i=IDBKeyRange.lowerBound(r),s=[];return er(t).X({range:i},(o,u,c)=>{let[h,f,m]=o,g=ee(f);if(h===this.userId&&e.path.isEqual(g))return Oe(t).get(m).next(T=>{if(!T)throw L(61480,{tr:o,batchId:m});q(T.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:T.userId,batchId:m}),s.push(gn(this.serializer,T))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new rt($),i=[];return e.forEach(s=>{let o=zs(this.userId,s.path),u=IDBKeyRange.lowerBound(o),c=er(t).X({range:u},(h,f,m)=>{let[g,T,D]=h,x=ee(T);g===this.userId&&s.path.isEqual(x)?r=r.add(D):m.done()});i.push(c)}),R.waitFor(i).next(()=>this.nr(t,r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=zs(this.userId,r),o=IDBKeyRange.lowerBound(s),u=new rt($);return er(t).X({range:o},(c,h,f)=>{let[m,g,T]=c,D=ee(g);m===this.userId&&r.isPrefixOf(D)?D.length===i&&(u=u.add(T)):f.done()}).next(()=>this.nr(t,u))}nr(t,e){let r=[],i=[];return e.forEach(s=>{i.push(Oe(t).get(s).next(o=>{if(o===null)throw L(35274,{batchId:s});q(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:s}),r.push(gn(this.serializer,o))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(t,e){return Cp(t.ce,this.userId,e).next(r=>(t.addOnCommittedListener(()=>{this.rr(e.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}rr(t){delete this.Zn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return R.resolve();let r=IDBKeyRange.lowerBound((function(o){return[o]})(this.userId)),i=[];return er(t).X({range:r},(s,o,u)=>{if(s[0]===this.userId){let c=ee(s[1]);i.push(c)}else u.done()}).next(()=>{q(i.length===0,56720,{ir:i.map(s=>s.canonicalString())})})})}containsKey(t,e){return Dp(t,this.userId,e)}sr(t){return Vp(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:qe,lastStreamToken:""})}};function Dp(n,t,e){let r=zs(t,e.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return er(n).X({range:s,Z:!0},(u,c,h)=>{let[f,m,g]=u;f===t&&m===i&&(o=!0),h.done()}).next(()=>o)}function Oe(n){return bt(n,Qt)}function er(n){return bt(n,lr)}function Vp(n){return bt(n,Pi)}var Ir=class n{constructor(t){this._r=t}next(){return this._r+=2,this._r}static ar(){return new n(0)}static ur(){return new n(-1)}};var wc=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.cr(t).next(e=>{let r=new Ir(e.highestTargetId);return e.highestTargetId=r.next(),this.lr(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.cr(t).next(e=>z.fromTimestamp(new ct(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.cr(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,r){return this.cr(t).next(i=>(i.highestListenSequenceNumber=e,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.lr(t,i)))}addTargetData(t,e){return this.hr(t,e).next(()=>this.cr(t).next(r=>(r.targetCount+=1,this.Pr(e,r),this.lr(t,r))))}updateTargetData(t,e){return this.hr(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Jn(t).delete(e.targetId)).next(()=>this.cr(t)).next(r=>(q(r.targetCount>0,8065),r.targetCount-=1,this.lr(t,r)))}removeTargets(t,e,r){let i=0,s=[];return Jn(t).X((o,u)=>{let c=gi(u);c.sequenceNumber<=e&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(t,c)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Jn(t).X((r,i)=>{let s=gi(i);e(s)})}cr(t){return Uf(t).get(ro).next(e=>(q(e!==null,2888),e))}lr(t,e){return Uf(t).put(ro,e)}hr(t,e){return Jn(t).put(Ap(this.serializer,e))}Pr(t,e){let r=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,r=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,r=!0),r}getTargetCount(t){return this.cr(t).next(e=>e.targetCount)}getTargetData(t,e){let r=An(e),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Jn(t).X({range:i,index:Sm},(o,u,c)=>{let h=gi(u);os(e,h.target)&&(s=h,c.done())}).next(()=>s)}addMatchingKeys(t,e,r){let i=[],s=Le(t);return e.forEach(o=>{let u=Nt(o.path);i.push(s.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(t,r,o))}),R.waitFor(i)}removeMatchingKeys(t,e,r){let i=Le(t);return R.forEach(e,s=>{let o=Nt(s.path);return R.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(t,r,s)])})}removeMatchingKeysForTargetId(t,e){let r=Le(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(t,e){let r=IDBKeyRange.bound([e],[e+1],!1,!0),i=Le(t),s=G();return i.X({range:r,Z:!0},(o,u,c)=>{let h=ee(o[1]),f=new M(h);s=s.add(f)}).next(()=>s)}containsKey(t,e){let r=Nt(e.path),i=IDBKeyRange.bound([r],[gm(r)],!1,!0),s=0;return Le(t).X({index:Ml,Z:!0,range:i},([o,u],c,h)=>{o!==0&&(s++,h.done())}).next(()=>s>0)}Et(t,e){return Jn(t).get(e).next(r=>r?gi(r):null)}};function Jn(n){return bt(n,hr)}function Uf(n){return bt(n,In)}function Le(n){return bt(n,dr)}var qf="LruGarbageCollector",xp=1048576;function jf([n,t],[e,r]){let i=$(n,e);return i===0?$(t,r):i}var vc=class{constructor(t){this.Tr=t,this.buffer=new rt(jf),this.Ir=0}dr(){return++this.Ir}Er(t){let e=[t,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(e);else{let r=this.buffer.last();jf(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}},bo=class{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Ar=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return this.Ar!==null}Rr(t){k(qf,`Garbage collection scheduled in ${t}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>P(this,null,function*(){this.Ar=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){en(e)?k(qf,"Ignoring IndexedDB error during garbage collection: ",e):yield tn(e)}yield this.Rr(3e5)}))}},Ec=class{constructor(t,e){this.Vr=t,this.params=e}calculateTargetCount(t,e){return this.Vr.mr(t).next(r=>Math.floor(e/100*r))}nthSequenceNumber(t,e){if(e===0)return R.resolve(jt.ue);let r=new vc(e);return this.Vr.forEachTarget(t,i=>r.Er(i.sequenceNumber)).next(()=>this.Vr.gr(t,i=>r.Er(i))).next(()=>r.maxValue)}removeTargets(t,e,r){return this.Vr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.Vr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(Bf)):this.getCacheSize(t).next(r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Bf):this.pr(t,e))}getCacheSize(t){return this.Vr.getCacheSize(t)}pr(t,e){let r,i,s,o,u,c,h,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,o=Date.now(),this.nthSequenceNumber(t,i))).next(m=>(r=m,u=Date.now(),this.removeTargets(t,r,e))).next(m=>(s=m,c=Date.now(),this.removeOrphanedDocuments(t,r))).next(m=>(h=Date.now(),Yn()<=J.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-f}ms
	Determined least recently used ${i} in `+(u-o)+`ms
	Removed ${s} targets in `+(c-u)+`ms
	Removed ${m} documents in `+(h-c)+`ms
Total Duration: ${h-f}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}};function Np(n,t){return new Ec(n,t)}var Ic=class{constructor(t,e){this.db=t,this.garbageCollector=Np(this,e)}mr(t){let e=this.yr(t);return this.db.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}yr(t){let e=0;return this.gr(t,r=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}gr(t,e){return this.wr(t,(r,i)=>e(i))}addReference(t,e,r){return Bs(t,r)}removeReference(t,e,r){return Bs(t,r)}removeTargets(t,e,r){return this.db.getTargetCache().removeTargets(t,e,r)}markPotentiallyOrphaned(t,e){return Bs(t,e)}Sr(t,e){return(function(i,s){let o=!1;return Vp(i).ee(u=>Dp(i,u,s).next(c=>(c&&(o=!0),R.resolve(!c)))).next(()=>o)})(t,e)}removeOrphanedDocuments(t,e){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.wr(t,(o,u)=>{if(u<=e){let c=this.Sr(t,o).next(h=>{if(!h)return s++,r.getEntry(t,o).next(()=>(r.removeEntry(o,z.min()),Le(t).delete((function(m){return[0,Nt(m.path)]})(o))))});i.push(c)}}).next(()=>R.waitFor(i)).next(()=>r.apply(t)).next(()=>s)}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)}updateLimboDocument(t,e){return Bs(t,e)}wr(t,e){let r=Le(t),i,s=jt.ue;return r.X({index:Ml},([o,u],{path:c,sequenceNumber:h})=>{o===0?(s!==jt.ue&&e(new M(ee(i)),s),s=h,i=c):s=jt.ue}).next(()=>{s!==jt.ue&&e(new M(ee(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Bs(n,t){return Le(n).put((function(r,i){return{targetId:0,path:Nt(r.path),sequenceNumber:i}})(t,n.currentSequenceNumber))}var Ao=class{constructor(){this.changes=new Xt(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Tt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var Tc=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,r){return dn(t).put(r)}removeEntry(t,e,r){return dn(t).delete((function(s,o){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],_o(o),u[u.length-1]]})(e,r))}updateMetadata(t,e){return this.getMetadata(t).next(r=>(r.byteSize+=e,this.br(t,r)))}getEntry(t,e){let r=Tt.newInvalidDocument(e);return dn(t).X({index:$s,range:IDBKeyRange.only(fi(e))},(i,s)=>{r=this.Dr(e,s)}).next(()=>r)}vr(t,e){let r={size:0,document:Tt.newInvalidDocument(e)};return dn(t).X({index:$s,range:IDBKeyRange.only(fi(e))},(i,s)=>{r={document:this.Dr(e,s),size:Io(s)}}).next(()=>r)}getEntries(t,e){let r=Bt();return this.Cr(t,e,(i,s)=>{let o=this.Dr(i,s);r=r.insert(i,o)}).next(()=>r)}Fr(t,e){let r=Bt(),i=new at(M.comparator);return this.Cr(t,e,(s,o)=>{let u=this.Dr(s,o);r=r.insert(s,u),i=i.insert(s,Io(o))}).next(()=>({documents:r,Mr:i}))}Cr(t,e,r){if(e.isEmpty())return R.resolve();let i=new rt(Gf);e.forEach(c=>i=i.add(c));let s=IDBKeyRange.bound(fi(i.first()),fi(i.last())),o=i.getIterator(),u=o.getNext();return dn(t).X({index:$s,range:s},(c,h,f)=>{let m=M.fromSegments([...h.prefixPath,h.collectionGroup,h.documentId]);for(;u&&Gf(u,m)<0;)r(u,null),u=o.getNext();u&&u.isEqual(m)&&(r(u,h),u=o.hasNext()?o.getNext():null),u?f.G(fi(u)):f.done()}).next(()=>{for(;u;)r(u,null),u=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(t,e,r,i,s){let o=e.path,u=[o.popLast().toArray(),o.lastSegment(),_o(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return dn(t).j(IDBKeyRange.bound(u,c,!0)).next(h=>{s?.incrementDocumentReadCount(h.length);let f=Bt();for(let m of h){let g=this.Dr(M.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);g.isFoundDocument()&&(us(e,g)||i.has(g.key))&&(f=f.insert(g.key,g))}return f})}getAllFromCollectionGroup(t,e,r,i){let s=Bt(),o=$f(e,r),u=$f(e,Kt.max());return dn(t).X({index:Am,range:IDBKeyRange.bound(o,u,!0)},(c,h,f)=>{let m=this.Dr(M.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);s=s.insert(m.key,m),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new bc(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return zf(t).get(Fu).next(e=>(q(!!e,20021),e))}br(t,e){return zf(t).put(Fu,e)}Dr(t,e){if(e){let r=Sw(this.serializer,e);if(!(r.isNoDocument()&&r.version.isEqual(z.min())))return r}return Tt.newInvalidDocument(t)}};function kp(n){return new Tc(n)}var bc=class extends Ao{constructor(t,e){super(),this.Or=t,this.trackRemovals=e,this.Nr=new Xt(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(t){let e=[],r=0,i=new rt((s,o)=>$(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let u=this.Nr.get(s);if(e.push(this.Or.removeEntry(t,s,u.readTime)),o.isValidDocument()){let c=Rf(this.Or.serializer,o);i=i.add(s.path.popLast());let h=Io(c);r+=h-u.size,e.push(this.Or.addEntry(t,s,c))}else if(r-=u.size,this.trackRemovals){let c=Rf(this.Or.serializer,o.convertToNoDocument(z.min()));e.push(this.Or.addEntry(t,s,c))}}),i.forEach(s=>{e.push(this.Or.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.Or.updateMetadata(t,r)),R.waitFor(e)}getFromCache(t,e){return this.Or.vr(t,e).next(r=>(this.Nr.set(e,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(t,e){return this.Or.Fr(t,e).next(({documents:r,Mr:i})=>(i.forEach((s,o)=>{this.Nr.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function zf(n){return bt(n,Ci)}function dn(n){return bt(n,no)}function fi(n){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function $f(n,t){let e=t.documentKey.path.toArray();return[n,_o(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Gf(n,t){let e=n.path.toArray(),r=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<r.length-2;++s)if(i=$(e[s],r[s]),i)return i;return i=$(e.length,r.length),i||(i=$(e[e.length-2],r[r.length-2]),i||$(e[e.length-1],r[r.length-1]))}var Ac=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var So=class{constructor(t,e,r,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=i}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(r=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(r!==null&&Ii(r.mutation,i,zt.empty(),ct.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.getLocalViewOfDocuments(t,r,G()).next(()=>r))}getLocalViewOfDocuments(t,e,r=G()){let i=ne();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,r).next(s=>{let o=pi();return s.forEach((u,c)=>{o=o.insert(u,c.overlayedDocument)}),o}))}getOverlayedDocuments(t,e){let r=ne();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,G()))}populateOverlays(t,e,r){let i=[];return r.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((o,u)=>{e.set(o,u)})})}computeViews(t,e,r,i){let s=Bt(),o=Ei(),u=(function(){return Ei()})();return e.forEach((c,h)=>{let f=r.get(h.key);i.has(h.key)&&(f===void 0||f.mutation instanceof Jt)?s=s.insert(h.key,h):f!==void 0?(o.set(h.key,f.mutation.getFieldMask()),Ii(f.mutation,h,f.mutation.getFieldMask(),ct.now())):o.set(h.key,zt.empty())}),this.recalculateAndSaveOverlays(t,s).next(c=>(c.forEach((h,f)=>o.set(h,f)),e.forEach((h,f)=>{var m;return u.set(h,new Ac(f,(m=o.get(h))!==null&&m!==void 0?m:null))}),u))}recalculateAndSaveOverlays(t,e){let r=Ei(),i=new at((o,u)=>o-u),s=G();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(o=>{for(let u of o)u.keys().forEach(c=>{let h=e.get(c);if(h===null)return;let f=r.get(c)||zt.empty();f=u.applyToLocalView(h,f),r.set(c,f);let m=(i.get(u.batchId)||G()).add(c);i=i.insert(u.batchId,m)})}).next(()=>{let o=[],u=i.getReverseIterator();for(;u.hasNext();){let c=u.getNext(),h=c.key,f=c.value,m=rp();f.forEach(g=>{if(!s.has(g)){let T=lp(e.get(g),r.get(g));T!==null&&m.set(g,T),s=s.add(g)}}),o.push(this.documentOverlayCache.saveOverlays(t,h,m))}return R.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(r=>this.recalculateAndSaveOverlays(t,r))}getDocumentsMatchingQuery(t,e,r,i){return(function(o){return M.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):$l(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,i):this.getDocumentsMatchingCollectionQuery(t,e,r,i)}getNextDocuments(t,e,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,i-s.size):R.resolve(ne()),u=ur,c=s;return o.next(h=>R.forEach(h,(f,m)=>(u<m.largestBatchId&&(u=m.largestBatchId),s.get(f)?R.resolve():this.remoteDocumentCache.getEntry(t,f).next(g=>{c=c.insert(f,g)}))).next(()=>this.populateOverlays(t,h,s)).next(()=>this.computeViews(t,c,h,G())).next(f=>({batchId:u,changes:np(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next(r=>{let i=pi();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,r,i){let s=e.collectionGroup,o=pi();return this.indexManager.getCollectionParents(t,s).next(u=>R.forEach(u,c=>{let h=(function(m,g){return new Ht(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)})(e,c.child(s));return this.getDocumentsMatchingCollectionQuery(t,h,r,i).next(f=>{f.forEach((m,g)=>{o=o.insert(m,g)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(t,e,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,s,i))).next(o=>{s.forEach((c,h)=>{let f=h.getKey();o.get(f)===null&&(o=o.insert(f,Tt.newInvalidDocument(f)))});let u=pi();return o.forEach((c,h)=>{let f=s.get(c);f!==void 0&&Ii(f.mutation,h,zt.empty(),ct.now()),us(e,h)&&(u=u.insert(c,h))}),u})}};var Sc=class{constructor(t){this.serializer=t,this.Br=new Map,this.Lr=new Map}getBundleMetadata(t,e){return R.resolve(this.Br.get(e))}saveBundleMetadata(t,e){return this.Br.set(e.id,(function(i){return{id:i.id,version:i.version,createTime:mt(i.createTime)}})(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.Lr.get(e))}saveNamedQuery(t,e){return this.Lr.set(e.name,(function(i){return{name:i.name,query:ua(i.bundledQuery),readTime:mt(i.readTime)}})(e)),R.resolve()}};var Rc=class{constructor(){this.overlays=new at(M.comparator),this.kr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){let r=ne();return R.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(t,e,r){return r.forEach((i,s)=>{this.wt(t,e,s)}),R.resolve()}removeOverlaysForBatchId(t,e,r){let i=this.kr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.kr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){let i=ne(),s=e.length+1,o=new M(e.child("")),u=this.overlays.getIteratorFrom(o);for(;u.hasNext();){let c=u.getNext().value,h=c.getKey();if(!e.isPrefixOf(h.path))break;h.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return R.resolve(i)}getOverlaysForCollectionGroup(t,e,r,i){let s=new at((h,f)=>h-f),o=this.overlays.getIterator();for(;o.hasNext();){let h=o.getNext().value;if(h.getKey().getCollectionGroup()===e&&h.largestBatchId>r){let f=s.get(h.largestBatchId);f===null&&(f=ne(),s=s.insert(h.largestBatchId,f)),f.set(h.getKey(),h)}}let u=ne(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((h,f)=>u.set(h,f)),!(u.size()>=i)););return R.resolve(u)}wt(t,e,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.kr.get(i.largestBatchId).delete(r.key);this.kr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Li(e,r));let s=this.kr.get(e);s===void 0&&(s=G(),this.kr.set(e,s)),this.kr.set(e,s.add(r.key))}};var Pc=class{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}};var $i=class{constructor(){this.qr=new rt(_t.Qr),this.$r=new rt(_t.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(t,e){let r=new _t(t,e);this.qr=this.qr.add(r),this.$r=this.$r.add(r)}Kr(t,e){t.forEach(r=>this.addReference(r,e))}removeReference(t,e){this.Wr(new _t(t,e))}Gr(t,e){t.forEach(r=>this.removeReference(r,e))}zr(t){let e=new M(new H([])),r=new _t(e,t),i=new _t(e,t+1),s=[];return this.$r.forEachInRange([r,i],o=>{this.Wr(o),s.push(o.key)}),s}jr(){this.qr.forEach(t=>this.Wr(t))}Wr(t){this.qr=this.qr.delete(t),this.$r=this.$r.delete(t)}Jr(t){let e=new M(new H([])),r=new _t(e,t),i=new _t(e,t+1),s=G();return this.$r.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(t){let e=new _t(t,0),r=this.qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}},_t=class{constructor(t,e){this.key=t,this.Hr=e}static Qr(t,e){return M.comparator(t.key,e.key)||$(t.Hr,e.Hr)}static Ur(t,e){return $(t.Hr,e.Hr)||M.comparator(t.key,e.key)}};var Cc=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.er=1,this.Yr=new rt(_t.Qr)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,i){let s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Mi(s,e,r,i);this.mutationQueue.push(o);for(let u of i)this.Yr=this.Yr.add(new _t(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return R.resolve(o)}lookupMutationBatch(t,e){return R.resolve(this.Zr(e))}getNextMutationBatchAfterBatchId(t,e){let r=e+1,i=this.Xr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?qe:this.er-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let r=new _t(e,0),i=new _t(e,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([r,i],o=>{let u=this.Zr(o.Hr);s.push(u)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new rt($);return e.forEach(i=>{let s=new _t(i,0),o=new _t(i,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([s,o],u=>{r=r.add(u.Hr)})}),R.resolve(this.ei(r))}getAllMutationBatchesAffectingQuery(t,e){let r=e.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new _t(new M(s),0),u=new rt($);return this.Yr.forEachWhile(c=>{let h=c.key.path;return!!r.isPrefixOf(h)&&(h.length===i&&(u=u.add(c.Hr)),!0)},o),R.resolve(this.ei(u))}ei(t){let e=[];return t.forEach(r=>{let i=this.Zr(r);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){q(this.ti(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Yr;return R.forEach(e.mutations,i=>{let s=new _t(i.key,e.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.Yr=r})}rr(t){}containsKey(t,e){let r=new _t(e,0),i=this.Yr.firstAfterOrEqual(r);return R.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ti(t,e){return this.Xr(t)}Xr(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Zr(t){let e=this.Xr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var Dc=class{constructor(t){this.ni=t,this.docs=(function(){return new at(M.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let r=e.key,i=this.docs.get(r),s=i?i.size:0,o=this.ni(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():Tt.newInvalidDocument(e))}getEntries(t,e){let r=Bt();return e.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Tt.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,i){let s=Bt(),o=e.path,u=new M(o.child("__id-9223372036854775808__")),c=this.docs.getIteratorFrom(u);for(;c.hasNext();){let{key:h,value:{document:f}}=c.getNext();if(!o.isPrefixOf(h.path))break;h.path.length>o.length+1||Ol(vm(f),r)<=0||(i.has(f.key)||us(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(t,e,r,i){L(9500)}ri(t,e){return R.forEach(this.docs,r=>e(r))}newChangeBuffer(t){return new Vc(this)}getSize(t){return R.resolve(this.size)}},Vc=class extends Ao{constructor(t){super(),this.Or=t}applyChanges(t){let e=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?e.push(this.Or.addEntry(t,i)):this.Or.removeEntry(r)}),R.waitFor(e)}getFromCache(t,e){return this.Or.getEntry(t,e)}getAllFromCache(t,e){return this.Or.getEntries(t,e)}};var xc=class{constructor(t){this.persistence=t,this.ii=new Xt(e=>An(e),os),this.lastRemoteSnapshotVersion=z.min(),this.highestTargetId=0,this.si=0,this.oi=new $i,this.targetCount=0,this._i=Ir.ar()}forEachTarget(t,e){return this.ii.forEach((r,i)=>e(i)),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.si)}allocateTargetId(t){return this.highestTargetId=this._i.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.si&&(this.si=e),R.resolve()}hr(t){this.ii.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this._i=new Ir(e),this.highestTargetId=e),t.sequenceNumber>this.si&&(this.si=t.sequenceNumber)}addTargetData(t,e){return this.hr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.hr(e),R.resolve()}removeTargetData(t,e){return this.ii.delete(e.target),this.oi.zr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let i=0,s=[];return this.ii.forEach((o,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.ii.delete(o),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){let r=this.ii.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this.oi.Kr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this.oi.Gr(e,r);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(o=>{s.push(i.markPotentiallyOrphaned(t,o))}),R.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.oi.zr(e),R.resolve()}getMatchingKeysForTargetId(t,e){let r=this.oi.Jr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this.oi.containsKey(e))}};var Gi=class{constructor(t,e){this.ai={},this.overlays={},this.ui=new jt(0),this.ci=!1,this.ci=!0,this.li=new Pc,this.referenceDelegate=t(this),this.hi=new xc(this),this.indexManager=new yc,this.remoteDocumentCache=(function(i){return new Dc(i)})(r=>this.referenceDelegate.Pi(r)),this.serializer=new yo(e),this.Ti=new Sc(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Rc,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ai[t.toKey()];return r||(r=new Cc(e,this.referenceDelegate),this.ai[t.toKey()]=r),r}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(t,e,r){k("MemoryPersistence","Starting transaction:",t);let i=new Nc(this.ui.next());return this.referenceDelegate.Ii(),r(i).next(s=>this.referenceDelegate.di(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ei(t,e){return R.or(Object.values(this.ai).map(r=>()=>r.containsKey(t,e)))}},Nc=class extends Zs{constructor(t){super(),this.currentSequenceNumber=t}},Ro=class n{constructor(t){this.persistence=t,this.Ai=new $i,this.Ri=null}static Vi(t){return new n(t)}get mi(){if(this.Ri)return this.Ri;throw L(60996)}addReference(t,e,r){return this.Ai.addReference(r,e),this.mi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Ai.removeReference(r,e),this.mi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.mi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ai.zr(e.targetId).forEach(i=>this.mi.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.mi.add(s.toString()))}).next(()=>r.removeTargetData(t,e))}Ii(){this.Ri=new Set}di(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.mi,r=>{let i=M.fromPath(r);return this.fi(t,i).next(s=>{s||e.removeEntry(i,z.min())})}).next(()=>(this.Ri=null,e.apply(t)))}updateLimboDocument(t,e){return this.fi(t,e).next(r=>{r?this.mi.delete(e.toString()):this.mi.add(e.toString())})}Pi(t){return 0}fi(t,e){return R.or([()=>R.resolve(this.Ai.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ei(t,e)])}},Po=class n{constructor(t,e){this.persistence=t,this.gi=new Xt(r=>Nt(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=Np(this,e)}static Vi(t,e){return new n(t,e)}Ii(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}mr(t){let e=this.yr(t);return this.persistence.getTargetCache().getTargetCount(t).next(r=>e.next(i=>r+i))}yr(t){let e=0;return this.gr(t,r=>{e++}).next(()=>e)}gr(t,e){return R.forEach(this.gi,(r,i)=>this.Sr(t,r,i).next(s=>s?R.resolve():e(i)))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0,i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(t,o=>this.Sr(t,o,e).next(u=>{u||(r++,s.removeEntry(o,z.min()))})).next(()=>s.apply(t)).next(()=>r)}markPotentiallyOrphaned(t,e){return this.gi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){let r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.gi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.gi.set(e,t.currentSequenceNumber),R.resolve()}Pi(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Ks(t.data.value)),e}Sr(t,e,r){return R.or([()=>this.persistence.Ei(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{let i=this.gi.get(e);return R.resolve(i!==void 0&&i>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}};var kc=class{constructor(t){this.serializer=t}q(t,e,r,i){let s=new to("createOrUpgrade",e);r<1&&i>=1&&((function(c){c.createObjectStore(ss)})(t),(function(c){c.createObjectStore(Pi,{keyPath:P_}),c.createObjectStore(Qt,{keyPath:sf,autoIncrement:!0}).createIndex(wn,of,{unique:!0}),c.createObjectStore(lr)})(t),Kf(t),(function(c){c.createObjectStore(mn)})(t));let o=R.resolve();return r<3&&i>=3&&(r!==0&&((function(c){c.deleteObjectStore(dr),c.deleteObjectStore(hr),c.deleteObjectStore(In)})(t),Kf(t)),o=o.next(()=>(function(c){let h=c.store(In),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:z.min().toTimestamp(),targetCount:0};return h.put(ro,f)})(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>(function(c,h){return h.store(Qt).j().next(m=>{c.deleteObjectStore(Qt),c.createObjectStore(Qt,{keyPath:sf,autoIncrement:!0}).createIndex(wn,of,{unique:!0});let g=h.store(Qt),T=m.map(D=>g.put(D));return R.waitFor(T)})})(t,s))),o=o.next(()=>{(function(c){c.createObjectStore(fr,{keyPath:M_})})(t)})),r<5&&i>=5&&(o=o.next(()=>this.pi(s))),r<6&&i>=6&&(o=o.next(()=>((function(c){c.createObjectStore(Ci)})(t),this.yi(s)))),r<7&&i>=7&&(o=o.next(()=>this.wi(s))),r<8&&i>=8&&(o=o.next(()=>this.Si(t,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(t)})),r<10&&i>=10&&(o=o.next(()=>this.bi(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore(ta,{keyPath:L_})})(t),(function(c){c.createObjectStore(ea,{keyPath:B_})})(t)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){let h=c.createObjectStore(na,{keyPath:K_});h.createIndex(Lu,W_,{unique:!1}),h.createIndex(Cm,Q_,{unique:!1})})(t)})),r<13&&i>=13&&(o=o.next(()=>(function(c){let h=c.createObjectStore(no,{keyPath:D_});h.createIndex($s,V_),h.createIndex(Am,x_)})(t)).next(()=>this.Di(t,s)).next(()=>t.deleteObjectStore(mn))),r<14&&i>=14&&(o=o.next(()=>this.Ci(t,s))),r<15&&i>=15&&(o=o.next(()=>(function(c){c.createObjectStore(Ll,{keyPath:U_,autoIncrement:!0}).createIndex(Mu,q_,{unique:!1}),c.createObjectStore(_i,{keyPath:j_}).createIndex(Rm,z_,{unique:!1}),c.createObjectStore(wi,{keyPath:$_}).createIndex(Pm,G_,{unique:!1})})(t))),r<16&&i>=16&&(o=o.next(()=>{e.objectStore(_i).clear()}).next(()=>{e.objectStore(wi).clear()})),r<17&&i>=17&&(o=o.next(()=>{(function(c){c.createObjectStore(Bl,{keyPath:H_})})(t)})),r<18&&i>=18&&Xa()&&(o=o.next(()=>{e.objectStore(_i).clear()}).next(()=>{e.objectStore(wi).clear()})),o}yi(t){let e=0;return t.store(mn).X((r,i)=>{e+=Io(i)}).next(()=>{let r={byteSize:e};return t.store(Ci).put(Fu,r)})}pi(t){let e=t.store(Pi),r=t.store(Qt);return e.j().next(i=>R.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,qe],[s.userId,s.lastAcknowledgedBatchId]);return r.j(wn,o).next(u=>R.forEach(u,c=>{q(c.userId===s.userId,18650,"Cannot process batch from unexpected user",{batchId:c.batchId});let h=gn(this.serializer,c);return Cp(t,s.userId,h).next(()=>{})}))}))}wi(t){let e=t.store(dr),r=t.store(mn);return t.store(In).get(ro).next(i=>{let s=[];return r.X((o,u)=>{let c=new H(o),h=(function(m){return[0,Nt(m)]})(c);s.push(e.get(h).next(f=>f?R.resolve():(m=>e.put({targetId:0,path:Nt(m),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>R.waitFor(s))})}Si(t,e){t.createObjectStore(Di,{keyPath:F_});let r=e.store(Di),i=new zi,s=o=>{if(i.add(o)){let u=o.lastSegment(),c=o.popLast();return r.put({collectionId:u,parent:Nt(c)})}};return e.store(mn).X({Z:!0},(o,u)=>{let c=new H(o);return s(c.popLast())}).next(()=>e.store(lr).X({Z:!0},([o,u,c],h)=>{let f=ee(u);return s(f.popLast())}))}bi(t){let e=t.store(hr);return e.X((r,i)=>{let s=gi(i),o=Ap(this.serializer,s);return e.put(o)})}Di(t,e){let r=e.store(mn),i=[];return r.X((s,o)=>{let u=e.store(no),c=(function(m){return m.document?new M(H.fromString(m.document.name).popFirst(5)):m.noDocument?M.fromSegments(m.noDocument.path):m.unknownDocument?M.fromSegments(m.unknownDocument.path):L(36783)})(o).path.toArray(),h={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(u.put(h))}).next(()=>R.waitFor(i))}Ci(t,e){let r=e.store(Qt),i=kp(this.serializer),s=new Gi(Ro.Vi,this.serializer.gt);return r.j().next(o=>{let u=new Map;return o.forEach(c=>{var h;let f=(h=u.get(c.userId))!==null&&h!==void 0?h:G();gn(this.serializer,c).keys().forEach(m=>f=f.add(m)),u.set(c.userId,f)}),R.forEach(u,(c,h)=>{let f=new wt(h),m=wo.yt(this.serializer,f),g=s.getIndexManager(f),T=To.yt(f,this.serializer,g,s.referenceDelegate);return new So(i,T,m,g).recalculateAndSaveOverlaysForDocumentKeys(new Vi(e,jt.ue),c).next()})})}};function Kf(n){n.createObjectStore(dr,{keyPath:k_}).createIndex(Ml,O_,{unique:!0}),n.createObjectStore(hr,{keyPath:"targetId"}).createIndex(Sm,N_,{unique:!0}),n.createObjectStore(In)}var Fe="IndexedDbPersistence",yu=18e5,_u=5e3,wu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Op="main",Oc=class n{constructor(t,e,r,i,s,o,u,c,h,f,m=18){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=r,this.Fi=s,this.window=o,this.document=u,this.Mi=h,this.xi=f,this.Oi=m,this.ui=null,this.ci=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ni=null,this.inForeground=!1,this.Bi=null,this.Li=null,this.ki=Number.NEGATIVE_INFINITY,this.qi=g=>Promise.resolve(),!n.C())throw new V(A.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Ic(this,i),this.Qi=e+Op,this.serializer=new yo(c),this.$i=new Ge(this.Qi,this.Oi,new kc(this.serializer)),this.li=new lc,this.hi=new wc(this.referenceDelegate,this.serializer),this.remoteDocumentCache=kp(this.serializer),this.Ti=new cc,this.window&&this.window.localStorage?this.Ui=this.window.localStorage:(this.Ui=null,f===!1&&ft(Fe,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ki().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(A.FAILED_PRECONDITION,wu);return this.Wi(),this.Gi(),this.zi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.hi.getHighestSequenceNumber(t))}).then(t=>{this.ui=new jt(t,this.Mi)}).then(()=>{this.ci=!0}).catch(t=>(this.$i&&this.$i.close(),Promise.reject(t)))}ji(t){return this.qi=e=>P(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.$i.setDatabaseDeletedListener(t)}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Fi.enqueueAndForget(()=>P(this,null,function*(){this.started&&(yield this.Ki())})))}Ki(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Us(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Ji(t).next(e=>{e||(this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)))})}).next(()=>this.Hi(t)).next(e=>this.isPrimary&&!e?this.Yi(t).next(()=>!1):!!e&&this.Zi(t).next(()=>!0))).catch(t=>{if(en(t))return k(Fe,"Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return k(Fe,"Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Fi.enqueueRetryable(()=>this.qi(t)),this.isPrimary=t})}Ji(t){return mi(t).get(Kn).next(e=>R.resolve(this.Xi(e)))}es(t){return Us(t).delete(this.clientId)}ts(){return P(this,null,function*(){if(this.isPrimary&&!this.ns(this.ki,yu)){this.ki=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let r=bt(e,fr);return r.j().next(i=>{let s=this.rs(i,yu),o=i.filter(u=>s.indexOf(u)===-1);return R.forEach(o,u=>r.delete(u.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ui)for(let e of t)this.Ui.removeItem(this.ss(e.clientId))}})}zi(){this.Li=this.Fi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ki().then(()=>this.ts()).then(()=>this.zi()))}Xi(t){return!!t&&t.ownerId===this.clientId}Hi(t){return this.xi?R.resolve(!0):mi(t).get(Kn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,_u)&&!this._s(e.ownerId)){if(this.Xi(e)&&this.networkEnabled)return!0;if(!this.Xi(e)){if(!e.allowTabSynchronization)throw new V(A.FAILED_PRECONDITION,wu);return!1}}return!(!this.networkEnabled||!this.inForeground)||Us(t).j().next(r=>this.rs(r,_u).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||o&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&k(Fe,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return P(this,null,function*(){this.ci=!1,this.us(),this.Li&&(this.Li.cancel(),this.Li=null),this.cs(),this.ls(),yield this.$i.runTransaction("shutdown","readwrite",[ss,fr],t=>{let e=new Vi(t,jt.ue);return this.Yi(e).next(()=>this.es(e))}),this.$i.close(),this.hs()})}rs(t,e){return t.filter(r=>this.ns(r.updateTimeMs,e)&&!this._s(r.clientId))}Ps(){return this.runTransaction("getActiveClients","readonly",t=>Us(t).j().next(e=>this.rs(e,yu).map(r=>r.clientId)))}get started(){return this.ci}getGlobalsCache(){return this.li}getMutationQueue(t,e){return To.yt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new _c(t,this.serializer.gt.databaseId)}getDocumentOverlayCache(t){return wo.yt(this.serializer,t)}getBundleCache(){return this.Ti}runTransaction(t,e,r){k(Fe,"Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=(function(c){return c===18?Y_:c===17?Nm:c===16?J_:c===15?Ul:c===14?xm:c===13?Vm:c===12?X_:c===11?Dm:void L(60245)})(this.Oi),o;return this.$i.runTransaction(t,i,s,u=>(o=new Vi(u,this.ui?this.ui.next():jt.ue),e==="readwrite-primary"?this.Ji(o).next(c=>!!c||this.Hi(o)).next(c=>{if(!c)throw ft(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Fi.enqueueRetryable(()=>this.qi(!1)),new V(A.FAILED_PRECONDITION,Em);return r(o)}).next(c=>this.Zi(o).next(()=>c)):this.Ts(o).next(()=>r(o)))).then(u=>(o.raiseOnCommittedEvent(),u))}Ts(t){return mi(t).get(Kn).next(e=>{if(e!==null&&this.ns(e.leaseTimestampMs,_u)&&!this._s(e.ownerId)&&!this.Xi(e)&&!(this.xi||this.allowTabSynchronization&&e.allowTabSynchronization))throw new V(A.FAILED_PRECONDITION,wu)})}Zi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return mi(t).put(Kn,e)}static C(){return Ge.C()}Yi(t){let e=mi(t);return e.get(Kn).next(r=>this.Xi(r)?(k(Fe,"Releasing primary lease."),e.delete(Kn)):R.resolve())}ns(t,e){let r=Date.now();return!(t<r-e)&&(!(t>r)||(ft(`Detected an update time that is in the future: ${t} > ${r}`),!1))}Wi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Bi=()=>{this.Fi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ki()))},this.document.addEventListener("visibilitychange",this.Bi),this.inForeground=this.document.visibilityState==="visible")}cs(){this.Bi&&(this.document.removeEventListener("visibilitychange",this.Bi),this.Bi=null)}Gi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Ni=()=>{this.us();let e=/(?:Version|Mobile)\/1[456]/;Ha()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.Fi.enterRestrictedMode(!0),this.Fi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Ni))}ls(){this.Ni&&(this.window.removeEventListener("pagehide",this.Ni),this.Ni=null)}_s(t){var e;try{let r=((e=this.Ui)===null||e===void 0?void 0:e.getItem(this.ss(t)))!==null;return k(Fe,`Client '${t}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return ft(Fe,"Failed to get zombied client id.",r),!1}}us(){if(this.Ui)try{this.Ui.setItem(this.ss(this.clientId),String(Date.now()))}catch(t){ft("Failed to set zombie client id.",t)}}hs(){if(this.Ui)try{this.Ui.removeItem(this.ss(this.clientId))}catch{}}ss(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function mi(n){return bt(n,ss)}function Us(n){return bt(n,fr)}function Hl(n,t){let e=n.projectId;return n.isDefaultDatabase||(e+="."+n.database),"firestore/"+t+"/"+e+"/"}var Fc=class n{constructor(t,e,r,i){this.targetId=t,this.fromCache=e,this.Is=r,this.ds=i}static Es(t,e){let r=G(),i=G();for(let s of e.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(t,e.fromCache,r,i)}};var Mc=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var Co=class{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(function(){return Ha()?8:Im(ln())>0?6:4})()}initialize(t,e){this.gs=t,this.indexManager=e,this.As=!0}getDocumentsMatchingQuery(t,e,r,i){let s={result:null};return this.ps(t,e).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ys(t,e,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Mc;return this.ws(t,e,o).next(u=>{if(s.result=u,this.Rs)return this.Ss(t,e,o,u.size)})}).next(()=>s.result)}Ss(t,e,r,i){return r.documentReadCount<this.Vs?(Yn()<=J.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Zn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),R.resolve()):(Yn()<=J.DEBUG&&k("QueryEngine","Query:",Zn(e),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.fs*i?(Yn()<=J.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Zn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,kt(e))):R.resolve())}ps(t,e){if(_f(e))return R.resolve(null);let r=kt(e);return this.indexManager.getIndexType(t,r).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=lo(e,null,"F"),r=kt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next(s=>{let o=G(...s);return this.gs.getDocuments(t,o).next(u=>this.indexManager.getMinOffset(t,r).next(c=>{let h=this.bs(e,u);return this.Ds(e,h,o,c.readTime)?this.ps(t,lo(e,null,"F")):this.vs(t,h,e,c)}))})))}ys(t,e,r,i){return _f(e)||i.isEqual(z.min())?R.resolve(null):this.gs.getDocuments(t,r).next(s=>{let o=this.bs(e,s);return this.Ds(e,o,r,i)?R.resolve(null):(Yn()<=J.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Zn(e)),this.vs(t,o,e,wm(i,ur)).next(u=>u))})}bs(t,e){let r=new rt(tp(t));return e.forEach((i,s)=>{us(t,s)&&(r=r.add(s))}),r}Ds(t,e,r,i){if(t.limit===null)return!1;if(r.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(t,e,r){return Yn()<=J.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Zn(e)),this.gs.getDocumentsMatchingQuery(t,e,Kt.min(),r)}vs(t,e,r,i){return this.gs.getDocumentsMatchingQuery(t,r,i).next(s=>(e.forEach(o=>{s=s.insert(o.key,o)}),s))}};var Xl="LocalStore",Cw=3e8,Lc=class{constructor(t,e,r,i){this.persistence=t,this.Cs=e,this.serializer=i,this.Fs=new at($),this.Ms=new Xt(s=>An(s),os),this.xs=new Map,this.Os=t.getRemoteDocumentCache(),this.hi=t.getTargetCache(),this.Ti=t.getBundleCache(),this.Ns(r)}Ns(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new So(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.Fs))}};function Fp(n,t,e,r){return new Lc(n,t,e,r)}function Mp(n,t){return P(this,null,function*(){let e=O(n);return yield e.persistence.runTransaction("Handle user change","readonly",r=>{let i;return e.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,e.Ns(t),e.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],u=[],c=G();for(let h of i){o.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}for(let h of s){u.push(h.batchId);for(let f of h.mutations)c=c.add(f.key)}return e.localDocuments.getDocuments(r,c).next(h=>({Bs:h,removedBatchIds:o,addedBatchIds:u}))})})})}function Dw(n,t){let e=O(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=t.batch.keys(),s=e.Os.newChangeBuffer({trackRemovals:!0});return(function(u,c,h,f){let m=h.batch,g=m.keys(),T=R.resolve();return g.forEach(D=>{T=T.next(()=>f.getEntry(c,D)).next(x=>{let N=h.docVersions.get(D);q(N!==null,48541),x.version.compareTo(N)<0&&(m.applyToRemoteDocument(x,h),x.isValidDocument()&&(x.setReadTime(h.commitVersion),f.addEntry(x)))})}),T.next(()=>u.mutationQueue.removeMutationBatch(c,m))})(e,r,t,s).next(()=>s.apply(r)).next(()=>e.mutationQueue.performConsistencyCheck(r)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(r,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let c=G();for(let h=0;h<u.mutationResults.length;++h)u.mutationResults[h].transformResults.length>0&&(c=c.add(u.batch.mutations[h].key));return c})(t))).next(()=>e.localDocuments.getDocuments(r,i))})}function Lp(n){let t=O(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.hi.getLastRemoteSnapshotVersion(e))}function Vw(n,t){let e=O(n),r=t.snapshotVersion,i=e.Fs;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=e.Os.newChangeBuffer({trackRemovals:!0});i=e.Fs;let u=[];t.targetChanges.forEach((f,m)=>{let g=i.get(m);if(!g)return;u.push(e.hi.removeMatchingKeys(s,f.removedDocuments,m).next(()=>e.hi.addMatchingKeys(s,f.addedDocuments,m)));let T=g.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(m)!==null?T=T.withResumeToken(pt.EMPTY_BYTE_STRING,z.min()).withLastLimboFreeSnapshotVersion(z.min()):f.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(f.resumeToken,r)),i=i.insert(m,T),(function(x,N,B){return x.resumeToken.approximateByteSize()===0||N.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=Cw?!0:B.addedDocuments.size+B.modifiedDocuments.size+B.removedDocuments.size>0})(g,T,f)&&u.push(e.hi.updateTargetData(s,T))});let c=Bt(),h=G();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(Bp(s,o,t.documentUpdates).next(f=>{c=f.Ls,h=f.ks})),!r.isEqual(z.min())){let f=e.hi.getLastRemoteSnapshotVersion(s).next(m=>e.hi.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(f)}return R.waitFor(u).next(()=>o.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,c,h)).next(()=>c)}).then(s=>(e.Fs=i,s))}function Bp(n,t,e){let r=G(),i=G();return e.forEach(s=>r=r.add(s)),t.getEntries(n,r).next(s=>{let o=Bt();return e.forEach((u,c)=>{let h=s.get(u);c.isFoundDocument()!==h.isFoundDocument()&&(i=i.add(u)),c.isNoDocument()&&c.version.isEqual(z.min())?(t.removeEntry(u,c.readTime),o=o.insert(u,c)):!h.isValidDocument()||c.version.compareTo(h.version)>0||c.version.compareTo(h.version)===0&&h.hasPendingWrites?(t.addEntry(c),o=o.insert(u,c)):k(Xl,"Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version)}),{Ls:o,ks:i}})}function xw(n,t){let e=O(n);return e.persistence.runTransaction("Get next mutation batch","readonly",r=>(t===void 0&&(t=qe),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t)))}function Tr(n,t){let e=O(n);return e.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return e.hi.getTargetData(r,t).next(s=>s?(i=s,R.resolve(i)):e.hi.allocateTargetId(r).next(o=>(i=new Er(t,o,"TargetPurposeListen",r.currentSequenceNumber),e.hi.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=e.Fs.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.Fs=e.Fs.insert(r.targetId,r),e.Ms.set(t,r.targetId)),r})}function br(n,t,e){return P(this,null,function*(){let r=O(n),i=r.Fs.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!en(o))throw o;k(Xl,`Failed to update sequence numbers for target ${t}: ${o}`)}r.Fs=r.Fs.remove(t),r.Ms.delete(i.target)})}function Do(n,t,e){let r=O(n),i=z.min(),s=G();return r.persistence.runTransaction("Execute query","readwrite",o=>(function(c,h,f){let m=O(c),g=m.Ms.get(f);return g!==void 0?R.resolve(m.Fs.get(g)):m.hi.getTargetData(h,f)})(r,o,kt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.hi.getMatchingKeysForTargetId(o,u.targetId).next(c=>{s=c})}).next(()=>r.Cs.getDocumentsMatchingQuery(o,t,e?i:z.min(),e?s:G())).next(u=>(jp(r,Zm(t),u),{documents:u,qs:s})))}function Up(n,t){let e=O(n),r=O(e.hi),i=e.Fs.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>r.Et(s,t).next(o=>o?o.target:null))}function qp(n,t){let e=O(n),r=e.xs.get(t)||z.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.Os.getAllFromCollectionGroup(i,t,wm(r,ur),Number.MAX_SAFE_INTEGER)).then(i=>(jp(e,t,i),i))}function jp(n,t,e){let r=n.xs.get(t)||z.min();e.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.xs.set(t,r)}function Nw(n,t,e,r){return P(this,null,function*(){let i=O(n),s=G(),o=Bt();for(let h of e){let f=t.Qs(h.metadata.name);h.document&&(s=s.add(f));let m=t.$s(h);m.setReadTime(t.Us(h.metadata.readTime)),o=o.insert(f,m)}let u=i.Os.newChangeBuffer({trackRemovals:!0}),c=yield Tr(i,(function(f){return kt(Vr(H.fromString(`__bundle__/docs/${f}`)))})(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",h=>Bp(h,u,o).next(f=>(u.apply(h),f)).next(f=>i.hi.removeMatchingKeysForTargetId(h,c.targetId).next(()=>i.hi.addMatchingKeys(h,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(h,f.Ls,f.ks)).next(()=>f.Ls)))})}function kw(r,i){return P(this,arguments,function*(n,t,e=G()){let s=yield Tr(n,kt(ua(t.bundledQuery))),o=O(n);return o.persistence.runTransaction("Save named query","readwrite",u=>{let c=mt(t.readTime);if(s.snapshotVersion.compareTo(c)>=0)return o.Ti.saveNamedQuery(u,t);let h=s.withResumeToken(pt.EMPTY_BYTE_STRING,c);return o.Fs=o.Fs.insert(h.targetId,h),o.hi.updateTargetData(u,h).next(()=>o.hi.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>o.hi.addMatchingKeys(u,e,s.targetId)).next(()=>o.Ti.saveNamedQuery(u,t))})})}var zp="firestore_clients";function Wf(n,t){return`${zp}_${n}_${t}`}var $p="firestore_mutations";function Qf(n,t,e){let r=`${$p}_${n}_${e}`;return t.isAuthenticated()&&(r+=`_${t.uid}`),r}var Gp="firestore_targets";function vu(n,t){return`${Gp}_${n}_${t}`}var te="SharedClientState",Vo=class n{constructor(t,e,r,i){this.user=t,this.batchId=e,this.state=r,this.error=i}static Ks(t,e,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new V(i.error.code,i.error.message))),o?new n(t,e,i.state,s):(ft(te,`Failed to parse mutation state for ID '${e}': ${r}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ti=class n{constructor(t,e,r){this.targetId=t,this.state=e,this.error=r}static Ks(t,e){let r=JSON.parse(e),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new V(r.error.code,r.error.message))),s?new n(t,r.state,i):(ft(te,`Failed to parse target state for ID '${t}': ${e}`),null)}Ws(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},xo=class n{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ks(t,e){let r=JSON.parse(e),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Gl();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Tm(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(t,s):(ft(te,`Failed to parse client data for instance '${t}': ${e}`),null)}},Bc=class n{constructor(t,e){this.clientId=t,this.onlineState=e}static Ks(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new n(e.clientId,e.onlineState):(ft(te,`Failed to parse online state: ${t}`),null)}},Ki=class{constructor(){this.activeTargetIds=Gl()}Gs(t){this.activeTargetIds=this.activeTargetIds.add(t)}zs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Ws(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},bi=class{constructor(t,e,r,i,s){this.window=t,this.Fi=e,this.persistenceKey=r,this.js=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Js=this.Hs.bind(this),this.Ys=new at($),this.started=!1,this.Zs=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Xs=Wf(this.persistenceKey,this.js),this.eo=(function(c){return`firestore_sequence_number_${c}`})(this.persistenceKey),this.Ys=this.Ys.insert(this.js,new Ki),this.no=new RegExp(`^${zp}_${o}_([^_]*)$`),this.ro=new RegExp(`^${$p}_${o}_(\\d+)(?:_(.*))?$`),this.io=new RegExp(`^${Gp}_${o}_(\\d+)$`),this.so=(function(c){return`firestore_online_state_${c}`})(this.persistenceKey),this.oo=(function(c){return`firestore_bundle_loaded_v2_${c}`})(this.persistenceKey),this.window.addEventListener("storage",this.Js)}static C(t){return!(!t||!t.localStorage)}start(){return P(this,null,function*(){let t=yield this.syncEngine.Ps();for(let r of t){if(r===this.js)continue;let i=this.getItem(Wf(this.persistenceKey,r));if(i){let s=xo.Ks(r,i);s&&(this.Ys=this.Ys.insert(s.clientId,s))}}this._o();let e=this.storage.getItem(this.so);if(e){let r=this.ao(e);r&&this.uo(r)}for(let r of this.Zs)this.Hs(r);this.Zs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.eo,JSON.stringify(t))}getAllActiveQueryTargets(){return this.co(this.Ys)}isActiveQueryTarget(t){let e=!1;return this.Ys.forEach((r,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.lo(t,"pending")}updateMutationState(t,e,r){this.lo(t,e,r),this.ho(t)}addLocalQueryTarget(t,e=!0){let r="not-current";if(this.isActiveQueryTarget(t)){let i=this.storage.getItem(vu(this.persistenceKey,t));if(i){let s=Ti.Ks(t,i);s&&(r=s.state)}}return e&&this.Po.Gs(t),this._o(),r}removeLocalQueryTarget(t){this.Po.zs(t),this._o()}isLocalQueryTarget(t){return this.Po.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(vu(this.persistenceKey,t))}updateQueryState(t,e,r){this.To(t,e,r)}handleUserChange(t,e,r){e.forEach(i=>{this.ho(i)}),this.currentUser=t,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Io(t)}notifyBundleLoaded(t){this.Eo(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Js),this.removeItem(this.Xs),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return k(te,"READ",t,e),e}setItem(t,e){k(te,"SET",t,e),this.storage.setItem(t,e)}removeItem(t){k(te,"REMOVE",t),this.storage.removeItem(t)}Hs(t){let e=t;if(e.storageArea===this.storage){if(k(te,"EVENT",e.key,e.newValue),e.key===this.Xs)return void ft("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Fi.enqueueRetryable(()=>P(this,null,function*(){if(this.started){if(e.key!==null){if(this.no.test(e.key)){if(e.newValue==null){let r=this.Ao(e.key);return this.Ro(r,null)}{let r=this.Vo(e.key,e.newValue);if(r)return this.Ro(r.clientId,r)}}else if(this.ro.test(e.key)){if(e.newValue!==null){let r=this.mo(e.key,e.newValue);if(r)return this.fo(r)}}else if(this.io.test(e.key)){if(e.newValue!==null){let r=this.po(e.key,e.newValue);if(r)return this.yo(r)}}else if(e.key===this.so){if(e.newValue!==null){let r=this.ao(e.newValue);if(r)return this.uo(r)}}else if(e.key===this.eo){let r=(function(s){let o=jt.ue;if(s!=null)try{let u=JSON.parse(s);q(typeof u=="number",30636,{wo:s}),o=u}catch(u){ft(te,"Failed to read sequence number from WebStorage",u)}return o})(e.newValue);r!==jt.ue&&this.sequenceNumberHandler(r)}else if(e.key===this.oo){let r=this.So(e.newValue);yield Promise.all(r.map(i=>this.syncEngine.bo(i)))}}}else this.Zs.push(e)}))}}get Po(){return this.Ys.get(this.js)}_o(){this.setItem(this.Xs,this.Po.Ws())}lo(t,e,r){let i=new Vo(this.currentUser,t,e,r),s=Qf(this.persistenceKey,this.currentUser,t);this.setItem(s,i.Ws())}ho(t){let e=Qf(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Io(t){let e={clientId:this.js,onlineState:t};this.storage.setItem(this.so,JSON.stringify(e))}To(t,e,r){let i=vu(this.persistenceKey,t),s=new Ti(t,e,r);this.setItem(i,s.Ws())}Eo(t){let e=JSON.stringify(Array.from(t));this.setItem(this.oo,e)}Ao(t){let e=this.no.exec(t);return e?e[1]:null}Vo(t,e){let r=this.Ao(t);return xo.Ks(r,e)}mo(t,e){let r=this.ro.exec(t),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Vo.Ks(new wt(s),i,e)}po(t,e){let r=this.io.exec(t),i=Number(r[1]);return Ti.Ks(i,e)}ao(t){return Bc.Ks(t)}So(t){return JSON.parse(t)}fo(t){return P(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Do(t.batchId,t.state,t.error);k(te,`Ignoring mutation for non-active user ${t.user.uid}`)})}yo(t){return this.syncEngine.vo(t.targetId,t.state,t.error)}Ro(t,e){let r=e?this.Ys.insert(t,e):this.Ys.remove(t),i=this.co(this.Ys),s=this.co(r),o=[],u=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||u.push(c)}),this.syncEngine.Co(o,u).then(()=>{this.Ys=r})}uo(t){this.Ys.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}co(t){let e=Gl();return t.forEach((r,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},No=class{constructor(){this.Fo=new Ki,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Fo.Gs(t),this.Mo[t]||"not-current"}updateQueryState(t,e,r){this.Mo[t]=e}removeLocalQueryTarget(t){this.Fo.zs(t)}isLocalQueryTarget(t){return this.Fo.activeTargetIds.has(t)}clearQueryState(t){delete this.Mo[t]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(t){return this.Fo.activeTargetIds.has(t)}start(){return this.Fo=new Ki,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Uc=class{xo(t){}shutdown(){}};var Hf="ConnectivityMonitor",ko=class{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(t){this.ko.push(t)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){k(Hf,"Network connectivity changed: AVAILABLE");for(let t of this.ko)t(0)}Lo(){k(Hf,"Network connectivity changed: UNAVAILABLE");for(let t of this.ko)t(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var qs=null;function qc(){return qs===null?qs=(function(){return 268435456+Math.round(2147483648*Math.random())})():qs++,"0x"+qs.toString(16)}var Eu="RestConnection",Ow={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"},jc=class{get Qo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=e+"://"+t.host,this.Uo=`projects/${r}/databases/${i}`,this.Ko=this.databaseId.database===Ni?`project_id=${r}`:`project_id=${r}&database_id=${i}`}Wo(t,e,r,i,s){let o=qc(),u=this.Go(t,e.toUriEncodedString());k(Eu,`Sending RPC '${t}' ${o}:`,u,r);let c={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(c,i,s);let{host:h}=new URL(u),f=oi(h);return this.jo(t,u,c,r,f).then(m=>(k(Eu,`Received RPC '${t}' ${o}: `,m),m),m=>{throw Mt(Eu,`RPC '${t}' ${o} failed with error: `,m,"url: ",u,"request:",r),m})}Jo(t,e,r,i,s,o){return this.Wo(t,e,r,i,s)}zo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Dr})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((i,s)=>t[s]=i),r&&r.headers.forEach((i,s)=>t[s]=i)}Go(t,e){let r=Ow[t];return`${this.$o}/v1/${e}:${r}`}terminate(){}};var zc=class{constructor(t){this.Ho=t.Ho,this.Yo=t.Yo}Zo(t){this.Xo=t}e_(t){this.t_=t}n_(t){this.r_=t}onMessage(t){this.i_=t}close(){this.Yo()}send(t){this.Ho(t)}s_(){this.Xo()}o_(){this.t_()}__(t){this.r_(t)}a_(t){this.i_(t)}};var Vt="WebChannelConnection",$c=class extends jc{constructor(t){super(t),this.u_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}jo(t,e,r,i,s){let o=qc();return new Promise((u,c)=>{let h=new hu;h.setWithCredentials(!0),h.listenOnce(du.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case li.NO_ERROR:let m=h.getResponseJson();k(Vt,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(m)),u(m);break;case li.TIMEOUT:k(Vt,`RPC '${t}' ${o} timed out`),c(new V(A.DEADLINE_EXCEEDED,"Request time out"));break;case li.HTTP_ERROR:let g=h.getStatus();if(k(Vt,`RPC '${t}' ${o} failed with status:`,g,"response text:",h.getResponseText()),g>0){let T=h.getResponseJson();Array.isArray(T)&&(T=T[0]);let D=T?.error;if(D&&D.status&&D.message){let x=(function(B){let j=B.toLowerCase().replace(/_/g,"-");return Object.values(A).indexOf(j)>=0?j:A.UNKNOWN})(D.status);c(new V(x,D.message))}else c(new V(A.UNKNOWN,"Server responded with status "+h.getStatus()))}else c(new V(A.UNAVAILABLE,"Connection failed."));break;default:L(9055,{c_:t,streamId:o,l_:h.getLastErrorCode(),h_:h.getLastError()})}}finally{k(Vt,`RPC '${t}' ${o} completed.`)}});let f=JSON.stringify(i);k(Vt,`RPC '${t}' ${o} sending request:`,i),h.send(e,"POST",f,r,15)})}P_(t,e,r){let i=qc(),s=[this.$o,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pu(),u=mu(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;h!==void 0&&(c.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(c.useFetchStreams=!0),this.zo(c.initMessageHeaders,e,r),c.encodeInitMessageHeaders=!0;let f=s.join("");k(Vt,`Creating RPC '${t}' stream ${i}: ${f}`,c);let m=o.createWebChannel(f,c);this.T_(m);let g=!1,T=!1,D=new zc({Ho:N=>{T?k(Vt,`Not sending because RPC '${t}' stream ${i} is closed:`,N):(g||(k(Vt,`Opening RPC '${t}' stream ${i} transport.`),m.open(),g=!0),k(Vt,`RPC '${t}' stream ${i} sending:`,N),m.send(N))},Yo:()=>m.close()}),x=(N,B,j)=>{N.listen(B,U=>{try{j(U)}catch(W){setTimeout(()=>{throw W},0)}})};return x(m,Gn.EventType.OPEN,()=>{T||(k(Vt,`RPC '${t}' stream ${i} transport opened.`),D.s_())}),x(m,Gn.EventType.CLOSE,()=>{T||(T=!0,k(Vt,`RPC '${t}' stream ${i} transport closed`),D.__(),this.I_(m))}),x(m,Gn.EventType.ERROR,N=>{T||(T=!0,Mt(Vt,`RPC '${t}' stream ${i} transport errored. Name:`,N.name,"Message:",N.message),D.__(new V(A.UNAVAILABLE,"The operation could not be completed")))}),x(m,Gn.EventType.MESSAGE,N=>{var B;if(!T){let j=N.data[0];q(!!j,16349);let U=j,W=U?.error||((B=U[0])===null||B===void 0?void 0:B.error);if(W){k(Vt,`RPC '${t}' stream ${i} received error:`,W);let tt=W.status,K=(function(w){let E=yt[w];if(E!==void 0)return fp(E)})(tt),v=W.message;K===void 0&&(K=A.INTERNAL,v="Unknown error status: "+tt+" with message "+W.message),T=!0,D.__(new V(K,v)),m.close()}else k(Vt,`RPC '${t}' stream ${i} received:`,j),D.a_(j)}}),x(u,fu.STAT_EVENT,N=>{N.stat===Fs.PROXY?k(Vt,`RPC '${t}' stream ${i} detected buffering proxy`):N.stat===Fs.NOPROXY&&k(Vt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{D.o_()},0),D}terminate(){this.u_.forEach(t=>t.close()),this.u_=[]}T_(t){this.u_.push(t)}I_(t){this.u_=this.u_.filter(e=>e===t)}};function Kp(){return typeof window<"u"?window:null}function Xs(){return typeof document<"u"?document:null}function Fn(n){return new ic(n,!0)}var Wi=class{constructor(t,e,r=1e3,i=1.5,s=6e4){this.Fi=t,this.timerId=e,this.d_=r,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(t){this.cancel();let e=Math.floor(this.R_+this.p_()),r=Math.max(0,Date.now()-this.m_),i=Math.max(0,e-r);i>0&&k("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,()=>(this.m_=Date.now(),t())),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){this.V_!==null&&(this.V_.skipDelay(),this.V_=null)}cancel(){this.V_!==null&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}};var Xf="PersistentStream",Oo=class{constructor(t,e,r,i,s,o,u,c){this.Fi=t,this.w_=r,this.S_=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=u,this.listener=c,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new Wi(t,e)}M_(){return this.state===1||this.state===5||this.x_()}x_(){return this.state===2||this.state===3}start(){this.C_=0,this.state!==4?this.auth():this.O_()}stop(){return P(this,null,function*(){this.M_()&&(yield this.close(0))})}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&this.D_===null&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,()=>this.L_()))}k_(t){this.q_(),this.stream.send(t)}L_(){return P(this,null,function*(){if(this.x_())return this.close(0)})}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}close(t,e){return P(this,null,function*(){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,t!==4?this.F_.reset():e&&e.code===A.RESOURCE_EXHAUSTED?(ft(e.toString()),ft("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):e&&e.code===A.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.U_(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.n_(e)})}U_(){}auth(){this.state=1;let t=this.K_(this.b_),e=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.b_===e&&this.W_(r,i)},r=>{t(()=>{let i=new V(A.UNKNOWN,"Fetching auth token failed: "+r.message);return this.G_(i)})})}W_(t,e){let r=this.K_(this.b_);this.stream=this.z_(t,e),this.stream.Zo(()=>{r(()=>this.listener.Zo())}),this.stream.e_(()=>{r(()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,()=>(this.x_()&&(this.state=3),Promise.resolve())),this.listener.e_()))}),this.stream.n_(i=>{r(()=>this.G_(i))}),this.stream.onMessage(i=>{r(()=>++this.C_==1?this.j_(i):this.onNext(i))})}O_(){this.state=5,this.F_.g_(()=>P(this,null,function*(){this.state=0,this.start()}))}G_(t){return k(Xf,`close with error: ${t}`),this.stream=null,this.close(4,t)}K_(t){return e=>{this.Fi.enqueueAndForget(()=>this.b_===t?e():(k(Xf,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Gc=class extends Oo{constructor(t,e,r,i,s,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}z_(t,e){return this.connection.P_("Listen",t,e)}j_(t){return this.onNext(t)}onNext(t){this.F_.reset();let e=ww(this.serializer,t),r=(function(s){if(!("targetChange"in s))return z.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?z.min():o.readTime?mt(o.readTime):z.min()})(t);return this.listener.J_(e,r)}H_(t){let e={};e.database=ac(this.serializer),e.addTarget=(function(s,o){let u,c=o.target;if(u=uo(c)?{documents:wp(s,c)}:{query:aa(s,c).Vt},u.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){u.resumeToken=mp(s,o.resumeToken);let h=sc(s,o.expectedCount);h!==null&&(u.expectedCount=h)}else if(o.snapshotVersion.compareTo(z.min())>0){u.readTime=vr(s,o.snapshotVersion.toTimestamp());let h=sc(s,o.expectedCount);h!==null&&(u.expectedCount=h)}return u})(this.serializer,t);let r=Ew(this.serializer,t);r&&(e.labels=r),this.k_(e)}Y_(t){let e={};e.database=ac(this.serializer),e.removeTarget=t,this.k_(e)}},Kc=class extends Oo{constructor(t,e,r,i,s,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,i,o),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(t,e){return this.connection.P_("Write",t,e)}j_(t){return q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ea()}onNext(t){q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.F_.reset();let e=vw(t.writeResults,t.commitTime),r=mt(t.commitTime);return this.listener.ta(r,e)}na(){let t={};t.database=ac(this.serializer),this.k_(t)}X_(t){let e={streamToken:this.lastStreamToken,writes:t.map(r=>ji(this.serializer,r))};this.k_(e)}};var Wc=class{},Qc=class extends Wc{constructor(t,e,r,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new V(A.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(t,e,r,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Wo(t,oc(e,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(A.UNKNOWN,s.toString())})}Jo(t,e,r,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,u])=>this.connection.Jo(t,oc(e,r),i,o,u,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===A.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new V(A.UNKNOWN,o.toString())})}terminate(){this.ra=!0,this.connection.terminate()}},Hc=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){this.sa===0&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve())))}la(t){this.state==="Online"?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ua("Offline")))}set(t){this.ha(),this.sa=0,t==="Online"&&(this._a=!1),this.ua(t)}ua(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ca(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(ft(e),this._a=!1):k("OnlineStateTracker",e)}ha(){this.oa!==null&&(this.oa.cancel(),this.oa=null)}};var Cn="RemoteStore",Xc=class{constructor(t,e,r,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo(o=>{r.enqueueAndForget(()=>P(this,null,function*(){rn(this)&&(k(Cn,"Restarting streams for network reachability change."),yield(function(c){return P(this,null,function*(){let h=O(c);h.Ia.add(4),yield xr(h),h.Aa.set("Unknown"),h.Ia.delete(4),yield cs(h)})})(this))}))}),this.Aa=new Hc(r,i)}};function cs(n){return P(this,null,function*(){if(rn(n))for(let t of n.da)yield t(!0)})}function xr(n){return P(this,null,function*(){for(let t of n.da)yield t(!1)})}function ca(n,t){let e=O(n);e.Ta.has(t.targetId)||(e.Ta.set(t.targetId,t),Zl(e)?Yl(e):kr(e).x_()&&Jl(e,t))}function Ar(n,t){let e=O(n),r=kr(e);e.Ta.delete(t),r.x_()&&Wp(e,t),e.Ta.size===0&&(r.x_()?r.B_():rn(e)&&e.Aa.set("Unknown"))}function Jl(n,t){if(n.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(z.min())>0){let e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}kr(n).H_(t)}function Wp(n,t){n.Ra.$e(t),kr(n).Y_(t)}function Yl(n){n.Ra=new rc({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>n.Ta.get(t)||null,lt:()=>n.datastore.serializer.databaseId}),kr(n).start(),n.Aa.aa()}function Zl(n){return rn(n)&&!kr(n).M_()&&n.Ta.size>0}function rn(n){return O(n).Ia.size===0}function Qp(n){n.Ra=void 0}function Fw(n){return P(this,null,function*(){n.Aa.set("Online")})}function Mw(n){return P(this,null,function*(){n.Ta.forEach((t,e)=>{Jl(n,t)})})}function Lw(n,t){return P(this,null,function*(){Qp(n),Zl(n)?(n.Aa.la(t),Yl(n)):n.Aa.set("Unknown")})}function Bw(n,t,e){return P(this,null,function*(){if(n.Aa.set("Online"),t instanceof po&&t.state===2&&t.cause)try{yield(function(i,s){return P(this,null,function*(){let o=s.cause;for(let u of s.targetIds)i.Ta.has(u)&&(yield i.remoteSyncer.rejectListen(u,o),i.Ta.delete(u),i.Ra.removeTarget(u))})})(n,t)}catch(r){k(Cn,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),yield Fo(n,r)}else if(t instanceof ir?n.Ra.Ye(t):t instanceof mo?n.Ra.it(t):n.Ra.et(t),!e.isEqual(z.min()))try{let r=yield Lp(n.localStore);e.compareTo(r)>=0&&(yield(function(s,o){let u=s.Ra.Pt(o);return u.targetChanges.forEach((c,h)=>{if(c.resumeToken.approximateByteSize()>0){let f=s.Ta.get(h);f&&s.Ta.set(h,f.withResumeToken(c.resumeToken,o))}}),u.targetMismatches.forEach((c,h)=>{let f=s.Ta.get(c);if(!f)return;s.Ta.set(c,f.withResumeToken(pt.EMPTY_BYTE_STRING,f.snapshotVersion)),Wp(s,c);let m=new Er(f.target,c,h,f.sequenceNumber);Jl(s,m)}),s.remoteSyncer.applyRemoteEvent(u)})(n,e))}catch(r){k(Cn,"Failed to raise snapshot:",r),yield Fo(n,r)}})}function Fo(n,t,e){return P(this,null,function*(){if(!en(t))throw t;n.Ia.add(1),yield xr(n),n.Aa.set("Offline"),e||(e=()=>Lp(n.localStore)),n.asyncQueue.enqueueRetryable(()=>P(null,null,function*(){k(Cn,"Retrying IndexedDB access"),yield e(),n.Ia.delete(1),yield cs(n)}))})}function Hp(n,t){return t().catch(e=>Fo(n,e,t))}function Nr(n){return P(this,null,function*(){let t=O(n),e=Ye(t),r=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:qe;for(;Uw(t);)try{let i=yield xw(t.localStore,r);if(i===null){t.Pa.length===0&&e.B_();break}r=i.batchId,qw(t,i)}catch(i){yield Fo(t,i)}Xp(t)&&Jp(t)})}function Uw(n){return rn(n)&&n.Pa.length<10}function qw(n,t){n.Pa.push(t);let e=Ye(n);e.x_()&&e.Z_&&e.X_(t.mutations)}function Xp(n){return rn(n)&&!Ye(n).M_()&&n.Pa.length>0}function Jp(n){Ye(n).start()}function jw(n){return P(this,null,function*(){Ye(n).na()})}function zw(n){return P(this,null,function*(){let t=Ye(n);for(let e of n.Pa)t.X_(e.mutations)})}function $w(n,t,e){return P(this,null,function*(){let r=n.Pa.shift(),i=tc.from(r,t,e);yield Hp(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Nr(n)})}function Gw(n,t){return P(this,null,function*(){t&&Ye(n).Z_&&(yield(function(r,i){return P(this,null,function*(){if((function(o){return dp(o)&&o!==A.ABORTED})(i.code)){let s=r.Pa.shift();Ye(r).N_(),yield Hp(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Nr(r)}})})(n,t)),Xp(n)&&Jp(n)})}function Jf(n,t){return P(this,null,function*(){let e=O(n);e.asyncQueue.verifyOperationInProgress(),k(Cn,"RemoteStore received new credentials");let r=rn(e);e.Ia.add(3),yield xr(e),r&&e.Aa.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.Ia.delete(3),yield cs(e)})}function Jc(n,t){return P(this,null,function*(){let e=O(n);t?(e.Ia.delete(2),yield cs(e)):t||(e.Ia.add(2),yield xr(e),e.Aa.set("Unknown"))})}function kr(n){return n.Va||(n.Va=(function(e,r,i){let s=O(e);return s.ia(),new Gc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:Fw.bind(null,n),e_:Mw.bind(null,n),n_:Lw.bind(null,n),J_:Bw.bind(null,n)}),n.da.push(t=>P(null,null,function*(){t?(n.Va.N_(),Zl(n)?Yl(n):n.Aa.set("Unknown")):(yield n.Va.stop(),Qp(n))}))),n.Va}function Ye(n){return n.ma||(n.ma=(function(e,r,i){let s=O(e);return s.ia(),new Kc(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)})(n.datastore,n.asyncQueue,{Zo:()=>Promise.resolve(),e_:jw.bind(null,n),n_:Gw.bind(null,n),ea:zw.bind(null,n),ta:$w.bind(null,n)}),n.da.push(t=>P(null,null,function*(){t?(n.ma.N_(),yield Nr(n)):(yield n.ma.stop(),n.Pa.length>0&&(k(Cn,`Stopping write stream with ${n.Pa.length} pending writes`),n.Pa=[]))}))),n.ma}var Yc=class n{constructor(t,e,r,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Et,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,i,s){let o=Date.now()+r,u=new n(t,e,o,i,s);return u.start(r),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new V(A.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Or(n,t){if(ft("AsyncQueue",`${t}: ${n}`),en(n))return new V(A.UNAVAILABLE,`${t}: ${n}`);throw n}var Qi=class n{static emptySet(t){return new n(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=pi(),this.sortedSet=new at(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,r)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof n)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let r=new n;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}};var Mo=class{constructor(){this.fa=new at(M.comparator)}track(t){let e=t.doc.key,r=this.fa.get(e);r?t.type!==0&&r.type===3?this.fa=this.fa.insert(e,t):t.type===3&&r.type!==1?this.fa=this.fa.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.fa=this.fa.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.fa=this.fa.remove(e):t.type===1&&r.type===2?this.fa=this.fa.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.fa=this.fa.insert(e,{type:2,doc:t.doc}):L(63341,{At:t,ga:r}):this.fa=this.fa.insert(e,t)}pa(){let t=[];return this.fa.inorderTraversal((e,r)=>{t.push(r)}),t}},Dn=class n{constructor(t,e,r,i,s,o,u,c,h){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=u,this.excludesMetadataChanges=c,this.hasCachedResults=h}static fromInitialDocuments(t,e,r,i,s){let o=[];return e.forEach(u=>{o.push({type:0,doc:u})}),new n(t,e,Qi.emptySet(e),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&as(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==r[i].type||!e[i].doc.isEqual(r[i].doc))return!1;return!0}};var Zc=class{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some(t=>t.ba())}},tl=class{constructor(){this.queries=Yf(),this.onlineState="Unknown",this.Da=new Set}terminate(){(function(e,r){let i=O(e),s=i.queries;i.queries=Yf(),s.forEach((o,u)=>{for(let c of u.wa)c.onError(r)})})(this,new V(A.ABORTED,"Firestore shutting down"))}};function Yf(){return new Xt(n=>Ym(n),as)}function th(n,t){return P(this,null,function*(){let e=O(n),r=3,i=t.query,s=e.queries.get(i);s?!s.Sa()&&t.ba()&&(r=2):(s=new Zc,r=t.ba()?0:1);try{switch(r){case 0:s.ya=yield e.onListen(i,!0);break;case 1:s.ya=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(o){let u=Or(o,`Initialization of query '${Zn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.wa.push(t),t.va(e.onlineState),s.ya&&t.Ca(s.ya)&&nh(e)})}function eh(n,t){return P(this,null,function*(){let e=O(n),r=t.query,i=3,s=e.queries.get(r);if(s){let o=s.wa.indexOf(t);o>=0&&(s.wa.splice(o,1),s.wa.length===0?i=t.ba()?0:1:!s.Sa()&&t.ba()&&(i=2))}switch(i){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}})}function Kw(n,t){let e=O(n),r=!1;for(let i of t){let s=i.query,o=e.queries.get(s);if(o){for(let u of o.wa)u.Ca(i)&&(r=!0);o.ya=i}}r&&nh(e)}function Ww(n,t,e){let r=O(n),i=r.queries.get(t);if(i)for(let s of i.wa)s.onError(e);r.queries.delete(t)}function nh(n){n.Da.forEach(t=>{t.next()})}var el,Zf;(Zf=el||(el={})).Fa="default",Zf.Cache="cache";var Hi=class{constructor(t,e,r){this.query=t,this.Ma=e,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=r||{}}Ca(t){if(!this.options.includeMetadataChanges){let r=[];for(let i of t.docChanges)i.type!==3&&r.push(i);t=new Dn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.xa?this.Na(t)&&(this.Ma.next(t),e=!0):this.Ba(t,this.onlineState)&&(this.La(t),e=!0),this.Oa=t,e}onError(t){this.Ma.error(t)}va(t){this.onlineState=t;let e=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,t)&&(this.La(this.Oa),e=!0),e}Ba(t,e){if(!t.fromCache||!this.ba())return!0;let r=e!=="Offline";return(!this.options.ka||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Na(t){if(t.docChanges.length>0)return!0;let e=this.Oa&&this.Oa.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}La(t){t=Dn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.xa=!0,this.Ma.next(t)}ba(){return this.options.source!==el.Cache}};var Lo=class{constructor(t,e){this.qa=t,this.byteLength=e}Qa(){return"metadata"in this.qa}};var Bo=class{constructor(t){this.serializer=t}Qs(t){return se(this.serializer,t)}$s(t){return t.metadata.exists?oa(this.serializer,t.document,!1):Tt.newNoDocument(this.Qs(t.metadata.name),this.Us(t.metadata.readTime))}Us(t){return mt(t)}},Xi=class{constructor(t,e){this.$a=t,this.serializer=e,this.Ua=[],this.Ka=[],this.collectionGroups=new Set,this.progress=Yp(t)}get queries(){return this.Ua}get documents(){return this.Ka}Wa(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.qa.namedQuery)this.Ua.push(t.qa.namedQuery);else if(t.qa.documentMetadata){this.Ka.push({metadata:t.qa.documentMetadata}),t.qa.documentMetadata.exists||++e;let r=H.fromString(t.qa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else t.qa.document&&(this.Ka[this.Ka.length-1].document=t.qa.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}Ga(t){let e=new Map,r=new Bo(this.serializer);for(let i of t)if(i.metadata.queries){let s=r.Qs(i.metadata.name);for(let o of i.metadata.queries){let u=(e.get(o)||G()).add(s);e.set(o,u)}}return e}za(t){return P(this,null,function*(){let e=yield Nw(t,new Bo(this.serializer),this.Ka,this.$a.id),r=this.Ga(this.documents);for(let i of this.Ua)yield kw(t,i,r.get(i.name));return this.progress.taskState="Success",{progress:this.progress,ja:this.collectionGroups,Ja:e}})}};function Yp(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var Uo=class{constructor(t){this.key=t}},qo=class{constructor(t){this.key=t}},jo=class{constructor(t,e){this.query=t,this.Ha=e,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=G(),this.mutatedKeys=G(),this.Xa=tp(t),this.eu=new Qi(this.Xa)}get tu(){return this.Ha}nu(t,e){let r=e?e.ru:new Mo,i=e?e.eu:this.eu,s=e?e.mutatedKeys:this.mutatedKeys,o=i,u=!1,c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,h=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,m)=>{let g=i.get(f),T=us(this.query,m)?m:null,D=!!g&&this.mutatedKeys.has(g.key),x=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations),N=!1;g&&T?g.data.isEqual(T.data)?D!==x&&(r.track({type:3,doc:T}),N=!0):this.iu(g,T)||(r.track({type:2,doc:T}),N=!0,(c&&this.Xa(T,c)>0||h&&this.Xa(T,h)<0)&&(u=!0)):!g&&T?(r.track({type:0,doc:T}),N=!0):g&&!T&&(r.track({type:1,doc:g}),N=!0,(c||h)&&(u=!0)),N&&(T?(o=o.add(T),s=x?s.add(f):s.delete(f)):(o=o.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let f=this.query.limitType==="F"?o.last():o.first();o=o.delete(f.key),s=s.delete(f.key),r.track({type:1,doc:f})}return{eu:o,ru:r,Ds:u,mutatedKeys:s}}iu(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,i){let s=this.eu;this.eu=t.eu,this.mutatedKeys=t.mutatedKeys;let o=t.ru.pa();o.sort((f,m)=>(function(T,D){let x=N=>{switch(N){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{At:N})}};return x(T)-x(D)})(f.type,m.type)||this.Xa(f.doc,m.doc)),this.su(r),i=i!=null&&i;let u=e&&!i?this.ou():[],c=this.Za.size===0&&this.current&&!i?1:0,h=c!==this.Ya;return this.Ya=c,o.length!==0||h?{snapshot:new Dn(this.query,t.eu,s,o,t.mutatedKeys,c===0,h,!1,!!r&&r.resumeToken.approximateByteSize()>0),_u:u}:{_u:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({eu:this.eu,ru:new Mo,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(t){return!this.Ha.has(t)&&!!this.eu.has(t)&&!this.eu.get(t).hasLocalMutations}su(t){t&&(t.addedDocuments.forEach(e=>this.Ha=this.Ha.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.Ha=this.Ha.delete(e)),this.current=t.current)}ou(){if(!this.current)return[];let t=this.Za;this.Za=G(),this.eu.forEach(r=>{this.au(r.key)&&(this.Za=this.Za.add(r.key))});let e=[];return t.forEach(r=>{this.Za.has(r)||e.push(new qo(r))}),this.Za.forEach(r=>{t.has(r)||e.push(new Uo(r))}),e}uu(t){this.Ha=t.qs,this.Za=G();let e=this.nu(t.documents);return this.applyChanges(e,!0)}cu(){return Dn.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,this.Ya===0,this.hasCachedResults)}},sn="SyncEngine",nl=class{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}},rl=class{constructor(t){this.key=t,this.lu=!1}},il=class{constructor(t,e,r,i,s,o){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.hu={},this.Pu=new Xt(u=>Ym(u),as),this.Tu=new Map,this.Iu=new Set,this.du=new at(M.comparator),this.Eu=new Map,this.Au=new $i,this.Ru={},this.Vu=new Map,this.mu=Ir.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return this.fu===!0}};function Qw(n,t,e=!0){return P(this,null,function*(){let r=la(n),i,s=r.Pu.get(t);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.cu()):i=yield Zp(r,t,e,!0),i})}function Hw(n,t){return P(this,null,function*(){let e=la(n);yield Zp(e,t,!0,!1)})}function Zp(n,t,e,r){return P(this,null,function*(){let i=yield Tr(n.localStore,kt(t)),s=i.targetId,o=n.sharedClientState.addLocalQueryTarget(s,e),u;return r&&(u=yield rh(n,t,s,o==="current",i.resumeToken)),n.isPrimaryClient&&e&&ca(n.remoteStore,i),u})}function rh(n,t,e,r,i){return P(this,null,function*(){n.gu=(m,g,T)=>(function(x,N,B,j){return P(this,null,function*(){let U=N.view.nu(B);U.Ds&&(U=yield Do(x.localStore,N.query,!1).then(({documents:v})=>N.view.nu(v,U)));let W=j&&j.targetChanges.get(N.targetId),tt=j&&j.targetMismatches.get(N.targetId)!=null,K=N.view.applyChanges(U,x.isPrimaryClient,W,tt);return sl(x,N.targetId,K._u),K.snapshot})})(n,m,g,T);let s=yield Do(n.localStore,t,!0),o=new jo(t,s.qs),u=o.nu(s.documents),c=Ui.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",i),h=o.applyChanges(u,n.isPrimaryClient,c);sl(n,e,h._u);let f=new nl(t,e,o);return n.Pu.set(t,f),n.Tu.has(e)?n.Tu.get(e).push(t):n.Tu.set(e,[t]),h.snapshot})}function Xw(n,t,e){return P(this,null,function*(){let r=O(n),i=r.Pu.get(t),s=r.Tu.get(i.targetId);if(s.length>1)return r.Tu.set(i.targetId,s.filter(o=>!as(o,t))),void r.Pu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield br(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),e&&Ar(r.remoteStore,i.targetId),Sr(r,i.targetId)}).catch(tn))):(Sr(r,i.targetId),yield br(r.localStore,i.targetId,!0))})}function Jw(n,t){return P(this,null,function*(){let e=O(n),r=e.Pu.get(t),i=e.Tu.get(r.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Ar(e.remoteStore,r.targetId))})}function Yw(n,t,e){return P(this,null,function*(){let r=ah(n);try{let i=yield(function(o,u){let c=O(o),h=ct.now(),f=u.reduce((T,D)=>T.add(D.key),G()),m,g;return c.persistence.runTransaction("Locally write mutations","readwrite",T=>{let D=Bt(),x=G();return c.Os.getEntries(T,f).next(N=>{D=N,D.forEach((B,j)=>{j.isValidDocument()||(x=x.add(B))})}).next(()=>c.localDocuments.getOverlayedDocuments(T,D)).next(N=>{m=N;let B=[];for(let j of u){let U=dw(j,m.get(j.key).overlayedDocument);U!=null&&B.push(new Jt(j.key,U,zm(U.value.mapValue),dt.exists(!0)))}return c.mutationQueue.addMutationBatch(T,h,B,u)}).next(N=>{g=N;let B=N.applyToLocalDocumentSet(m,x);return c.documentOverlayCache.saveOverlays(T,N.batchId,B)})}).then(()=>({batchId:g.batchId,changes:np(m)}))})(r.localStore,t);r.sharedClientState.addPendingMutation(i.batchId),(function(o,u,c){let h=o.Ru[o.currentUser.toKey()];h||(h=new at($)),h=h.insert(u,c),o.Ru[o.currentUser.toKey()]=h})(r,i.batchId,e),yield Pe(r,i.changes),yield Nr(r.remoteStore)}catch(i){let s=Or(i,"Failed to persist write");e.reject(s)}})}function tg(n,t){return P(this,null,function*(){let e=O(n);try{let r=yield Vw(e.localStore,t);t.targetChanges.forEach((i,s)=>{let o=e.Eu.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1,22616),i.addedDocuments.size>0?o.lu=!0:i.modifiedDocuments.size>0?q(o.lu,14607):i.removedDocuments.size>0&&(q(o.lu,42227),o.lu=!1))}),yield Pe(e,r,t)}catch(r){yield tn(r)}})}function tm(n,t,e){let r=O(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){let i=[];r.Pu.forEach((s,o)=>{let u=o.view.va(t);u.snapshot&&i.push(u.snapshot)}),(function(o,u){let c=O(o);c.onlineState=u;let h=!1;c.queries.forEach((f,m)=>{for(let g of m.wa)g.va(u)&&(h=!0)}),h&&nh(c)})(r.eventManager,t),i.length&&r.hu.J_(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Zw(n,t,e){return P(this,null,function*(){let r=O(n);r.sharedClientState.updateQueryState(t,"rejected",e);let i=r.Eu.get(t),s=i&&i.key;if(s){let o=new at(M.comparator);o=o.insert(s,Tt.newNoDocument(s,z.min()));let u=G().add(s),c=new Bi(z.min(),new Map,new at($),o,u);yield tg(r,c),r.du=r.du.remove(s),r.Eu.delete(t),oh(r)}else yield br(r.localStore,t,!1).then(()=>Sr(r,t,e)).catch(tn)})}function tv(n,t){return P(this,null,function*(){let e=O(n),r=t.batch.batchId;try{let i=yield Dw(e.localStore,t);sh(e,r,null),ih(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),yield Pe(e,i)}catch(i){yield tn(i)}})}function ev(n,t,e){return P(this,null,function*(){let r=O(n);try{let i=yield(function(o,u){let c=O(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",h=>{let f;return c.mutationQueue.lookupMutationBatch(h,u).next(m=>(q(m!==null,37113),f=m.keys(),c.mutationQueue.removeMutationBatch(h,m))).next(()=>c.mutationQueue.performConsistencyCheck(h)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(h,f,u)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(h,f)).next(()=>c.localDocuments.getDocuments(h,f))})})(r.localStore,t);sh(r,t,e),ih(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),yield Pe(r,i)}catch(i){yield tn(i)}})}function nv(n,t){return P(this,null,function*(){let e=O(n);rn(e.remoteStore)||k(sn,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield(function(o){let u=O(o);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>u.mutationQueue.getHighestUnacknowledgedBatchId(c))})(e.localStore);if(r===qe)return void t.resolve();let i=e.Vu.get(r)||[];i.push(t),e.Vu.set(r,i)}catch(r){let i=Or(r,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function ih(n,t){(n.Vu.get(t)||[]).forEach(e=>{e.resolve()}),n.Vu.delete(t)}function sh(n,t,e){let r=O(n),i=r.Ru[r.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),r.Ru[r.currentUser.toKey()]=i}}function Sr(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(let r of n.Tu.get(t))n.Pu.delete(r),e&&n.hu.pu(r,e);n.Tu.delete(t),n.isPrimaryClient&&n.Au.zr(t).forEach(r=>{n.Au.containsKey(r)||eg(n,r)})}function eg(n,t){n.Iu.delete(t.path.canonicalString());let e=n.du.get(t);e!==null&&(Ar(n.remoteStore,e),n.du=n.du.remove(t),n.Eu.delete(e),oh(n))}function sl(n,t,e){for(let r of e)r instanceof Uo?(n.Au.addReference(r.key,t),rv(n,r)):r instanceof qo?(k(sn,"Document no longer in limbo: "+r.key),n.Au.removeReference(r.key,t),n.Au.containsKey(r.key)||eg(n,r.key)):L(19791,{yu:r})}function rv(n,t){let e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Iu.has(r)||(k(sn,"New document in limbo: "+e),n.Iu.add(r),oh(n))}function oh(n){for(;n.Iu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){let t=n.Iu.values().next().value;n.Iu.delete(t);let e=new M(H.fromString(t)),r=n.mu.next();n.Eu.set(r,new rl(e)),n.du=n.du.insert(e,r),ca(n.remoteStore,new Er(kt(Vr(e.path)),r,"TargetPurposeLimboResolution",jt.ue))}}function Pe(n,t,e){return P(this,null,function*(){let r=O(n),i=[],s=[],o=[];r.Pu.isEmpty()||(r.Pu.forEach((u,c)=>{o.push(r.gu(c,t,e).then(h=>{var f;if((h||e)&&r.isPrimaryClient){let m=h?!h.fromCache:(f=e?.targetChanges.get(c.targetId))===null||f===void 0?void 0:f.current;r.sharedClientState.updateQueryState(c.targetId,m?"current":"not-current")}if(h){i.push(h);let m=Fc.Es(c.targetId,h);s.push(m)}}))}),yield Promise.all(o),r.hu.J_(i),yield(function(c,h){return P(this,null,function*(){let f=O(c);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(h,g=>R.forEach(g.Is,T=>f.persistence.referenceDelegate.addReference(m,g.targetId,T)).next(()=>R.forEach(g.ds,T=>f.persistence.referenceDelegate.removeReference(m,g.targetId,T)))))}catch(m){if(!en(m))throw m;k(Xl,"Failed to update sequence numbers: "+m)}for(let m of h){let g=m.targetId;if(!m.fromCache){let T=f.Fs.get(g),D=T.snapshotVersion,x=T.withLastLimboFreeSnapshotVersion(D);f.Fs=f.Fs.insert(g,x)}}})})(r.localStore,s))})}function iv(n,t){return P(this,null,function*(){let e=O(n);if(!e.currentUser.isEqual(t)){k(sn,"User change. New user:",t.toKey());let r=yield Mp(e.localStore,t);e.currentUser=t,(function(s,o){s.Vu.forEach(u=>{u.forEach(c=>{c.reject(new V(A.CANCELLED,o))})}),s.Vu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),yield Pe(e,r.Bs)}})}function sv(n,t){let e=O(n),r=e.Eu.get(t);if(r&&r.lu)return G().add(r.key);{let i=G(),s=e.Tu.get(t);if(!s)return i;for(let o of s){let u=e.Pu.get(o);i=i.unionWith(u.view.tu)}return i}}function ov(n,t){return P(this,null,function*(){let e=O(n),r=yield Do(e.localStore,t.query,!0),i=t.view.uu(r);return e.isPrimaryClient&&sl(e,t.targetId,i._u),i})}function av(n,t){return P(this,null,function*(){let e=O(n);return qp(e.localStore,t).then(r=>Pe(e,r))})}function uv(n,t,e,r){return P(this,null,function*(){let i=O(n),s=yield(function(u,c){let h=O(u),f=O(h.mutationQueue);return h.persistence.runTransaction("Lookup mutation documents","readonly",m=>f.Xn(m,c).next(g=>g?h.localDocuments.getDocuments(m,g):R.resolve(null)))})(i.localStore,t);s!==null?(e==="pending"?yield Nr(i.remoteStore):e==="acknowledged"||e==="rejected"?(sh(i,t,r||null),ih(i,t),(function(u,c){O(O(u).mutationQueue).rr(c)})(i.localStore,t)):L(6720,"Unknown batchState",{wu:e}),yield Pe(i,s)):k(sn,"Cannot apply mutation batch with id: "+t)})}function cv(n,t){return P(this,null,function*(){let e=O(n);if(la(e),ah(e),t===!0&&e.fu!==!0){let r=e.sharedClientState.getAllActiveQueryTargets(),i=yield em(e,r.toArray());e.fu=!0,yield Jc(e.remoteStore,!0);for(let s of i)ca(e.remoteStore,s)}else if(t===!1&&e.fu!==!1){let r=[],i=Promise.resolve();e.Tu.forEach((s,o)=>{e.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Sr(e,o),br(e.localStore,o,!0))),Ar(e.remoteStore,o)}),yield i,yield em(e,r),(function(o){let u=O(o);u.Eu.forEach((c,h)=>{Ar(u.remoteStore,h)}),u.Au.jr(),u.Eu=new Map,u.du=new at(M.comparator)})(e),e.fu=!1,yield Jc(e.remoteStore,!1)}})}function em(n,t,e){return P(this,null,function*(){let r=O(n),i=[],s=[];for(let o of t){let u,c=r.Tu.get(o);if(c&&c.length!==0){u=yield Tr(r.localStore,kt(c[0]));for(let h of c){let f=r.Pu.get(h),m=yield ov(r,f);m.snapshot&&s.push(m.snapshot)}}else{let h=yield Up(r.localStore,o);u=yield Tr(r.localStore,h),yield rh(r,ng(h),o,!1,u.resumeToken)}i.push(u)}return r.hu.J_(s),i})}function ng(n){return Hm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function lv(n){return(function(e){return O(O(e).persistence).Ps()})(O(n).localStore)}function hv(n,t,e,r){return P(this,null,function*(){let i=O(n);if(i.fu)return void k(sn,"Ignoring unexpected query state notification.");let s=i.Tu.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let o=yield qp(i.localStore,Zm(s[0])),u=Bi.createSynthesizedRemoteEventForCurrentChange(t,e==="current",pt.EMPTY_BYTE_STRING);yield Pe(i,o,u);break}case"rejected":yield br(i.localStore,t,!0),Sr(i,t,r);break;default:L(64155,e)}})}function dv(n,t,e){return P(this,null,function*(){let r=la(n);if(r.fu){for(let i of t){if(r.Tu.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){k(sn,"Adding an already active target "+i);continue}let s=yield Up(r.localStore,i),o=yield Tr(r.localStore,s);yield rh(r,ng(s),o.targetId,!1,o.resumeToken),ca(r.remoteStore,o)}for(let i of e)r.Tu.has(i)&&(yield br(r.localStore,i,!1).then(()=>{Ar(r.remoteStore,i),Sr(r,i)}).catch(tn))}})}function la(n){let t=O(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=tg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=sv.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Zw.bind(null,t),t.hu.J_=Kw.bind(null,t.eventManager),t.hu.pu=Ww.bind(null,t.eventManager),t}function ah(n){let t=O(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=tv.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=ev.bind(null,t),t}function fv(n,t,e){let r=O(n);(function(s,o,u){return P(this,null,function*(){try{let c=yield o.getMetadata();if(yield(function(T,D){let x=O(T),N=mt(D.createTime);return x.persistence.runTransaction("hasNewerBundle","readonly",B=>x.Ti.getBundleMetadata(B,D.id)).then(B=>!!B&&B.createTime.compareTo(N)>=0)})(s.localStore,c))return yield o.close(),u._completeWith((function(T){return{taskState:"Success",documentsLoaded:T.totalDocuments,bytesLoaded:T.totalBytes,totalDocuments:T.totalDocuments,totalBytes:T.totalBytes}})(c)),Promise.resolve(new Set);u._updateProgress(Yp(c));let h=new Xi(c,o.serializer),f=yield o.Su();for(;f;){let g=yield h.Wa(f);g&&u._updateProgress(g),f=yield o.Su()}let m=yield h.za(s.localStore);return yield Pe(s,m.Ja,void 0),yield(function(T,D){let x=O(T);return x.persistence.runTransaction("Save bundle","readwrite",N=>x.Ti.saveBundleMetadata(N,D))})(s.localStore,c),u._completeWith(m.progress),Promise.resolve(m.ja)}catch(c){return Mt(sn,`Loading bundle failed with ${c}`),u._failWith(c),Promise.resolve(new Set)}})})(r,t,e).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var ha=(()=>{class n{constructor(){this.kind="memory",this.synchronizeTabs=!1}initialize(e){return P(this,null,function*(){this.serializer=Fn(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),yield this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)})}Cu(e,r){return null}Fu(e,r){return null}vu(e){return Fp(this.persistence,new Co,e.initialUser,this.serializer)}Du(e){return new Gi(Ro.Vi,this.serializer)}bu(e){return new No}terminate(){return P(this,null,function*(){var e,r;(e=this.gcScheduler)===null||e===void 0||e.stop(),(r=this.indexBackfillerScheduler)===null||r===void 0||r.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}}return n.provider={build:()=>new n},n})(),Ji=class extends ha{constructor(t){super(),this.cacheSizeBytes=t}Cu(t,e){q(this.persistence.referenceDelegate instanceof Po,46915);let r=this.persistence.referenceDelegate.garbageCollector;return new bo(r,t.asyncQueue,e)}Du(t){let e=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new Gi(r=>Po.Vi(r,e),this.serializer)}},Yi=class n extends ha{constructor(t,e,r){super(),this.Mu=t,this.cacheSizeBytes=e,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}initialize(t){return P(this,null,function*(){yield ja(n.prototype,this,"initialize").call(this,t),yield this.Mu.initialize(this,t),yield ah(this.Mu.syncEngine),yield Nr(this.Mu.remoteStore),yield this.persistence.ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}vu(t){return Fp(this.persistence,new Co,t.initialUser,this.serializer)}Cu(t,e){let r=this.persistence.referenceDelegate.garbageCollector;return new bo(r,t.asyncQueue,e)}Fu(t,e){let r=new Ou(e,this.persistence);return new ku(t.asyncQueue,r)}Du(t){let e=Hl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Lt.withCacheSize(this.cacheSizeBytes):Lt.DEFAULT;return new Oc(this.synchronizeTabs,e,t.clientId,r,t.asyncQueue,Kp(),Xs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}bu(t){return new No}},zo=class n extends Yi{constructor(t,e){super(t,e,!1),this.Mu=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return P(this,null,function*(){yield ja(n.prototype,this,"initialize").call(this,t);let e=this.Mu.syncEngine;this.sharedClientState instanceof bi&&(this.sharedClientState.syncEngine={Do:uv.bind(null,e),vo:hv.bind(null,e),Co:dv.bind(null,e),Ps:lv.bind(null,e),bo:av.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.ji(r=>P(this,null,function*(){yield cv(this.Mu.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}bu(t){let e=Kp();if(!bi.C(e))throw new V(A.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Hl(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new bi(e,t.asyncQueue,r,t.clientId,t.initialUser)}},Fr=(()=>{class n{initialize(e,r){return P(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(r),this.remoteStore=this.createRemoteStore(r),this.eventManager=this.createEventManager(r),this.syncEngine=this.createSyncEngine(r,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>tm(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=iv.bind(null,this.syncEngine),yield Jc(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return(function(){return new tl})()}createDatastore(e){let r=Fn(e.databaseInfo.databaseId),i=(function(o){return new $c(o)})(e.databaseInfo);return(function(o,u,c,h){return new Qc(o,u,c,h)})(e.authCredentials,e.appCheckCredentials,i,r)}createRemoteStore(e){return(function(i,s,o,u,c){return new Xc(i,s,o,u,c)})(this.localStore,this.datastore,e.asyncQueue,r=>tm(this.syncEngine,r,0),(function(){return ko.C()?new ko:new Uc})())}createSyncEngine(e,r){return(function(s,o,u,c,h,f,m){let g=new il(s,o,u,c,h,f);return m&&(g.fu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,r)}terminate(){return P(this,null,function*(){var e,r;yield(function(s){return P(this,null,function*(){let o=O(s);k(Cn,"RemoteStore shutting down."),o.Ia.add(5),yield xr(o),o.Ea.shutdown(),o.Aa.set("Unknown")})})(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(r=this.eventManager)===null||r===void 0||r.terminate()})}}return n.provider={build:()=>new n},n})();function nm(n,t=10240){let e=0;return{read(){return P(this,null,function*(){if(e<n.byteLength){let i={value:n.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return P(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Rr=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.xu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.xu(this.observer.error,t):ft("Uncaught Error in snapshot listener:",t.toString()))}Ou(){this.muted=!0}xu(t,e){setTimeout(()=>{this.muted||t(e)},0)}};var ol=class{constructor(t,e){this.Nu=t,this.serializer=e,this.metadata=new Et,this.buffer=new Uint8Array,this.Bu=(function(){return new TextDecoder("utf-8")})(),this.Lu().then(r=>{r&&r.Qa()?this.metadata.resolve(r.qa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.qa)}`))},r=>this.metadata.reject(r))}close(){return this.Nu.cancel()}getMetadata(){return P(this,null,function*(){return this.metadata.promise})}Su(){return P(this,null,function*(){return yield this.getMetadata(),this.Lu()})}Lu(){return P(this,null,function*(){let t=yield this.ku();if(t===null)return null;let e=this.Bu.decode(t),r=Number(e);isNaN(r)&&this.qu(`length string (${e}) is not valid number`);let i=yield this.Qu(r);return new Lo(JSON.parse(i),t.length+r)})}$u(){return this.buffer.findIndex(t=>t===123)}ku(){return P(this,null,function*(){for(;this.$u()<0&&!(yield this.Uu()););if(this.buffer.length===0)return null;let t=this.$u();t<0&&this.qu("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Qu(t){return P(this,null,function*(){for(;this.buffer.length<t;)(yield this.Uu())&&this.qu("Reached the end of bundle when more is expected.");let e=this.Bu.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}qu(t){throw this.Nu.cancel(),new Error(`Invalid bundle format: ${t}`)}Uu(){return P(this,null,function*(){let t=yield this.Nu.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var al=class{constructor(t,e){this.bundleData=t,this.serializer=e,this.cursor=0,this.elements=[];let r=this.Su();if(!r||!r.Qa())throw new Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.qa)}`);this.metadata=r;do r=this.Su(),r!==null&&this.elements.push(r);while(r!==null)}getMetadata(){return this.metadata}Ku(){return this.elements}Su(){if(this.cursor===this.bundleData.length)return null;let t=this.ku(),e=this.Qu(t);return new Lo(JSON.parse(e),t)}Qu(t){if(this.cursor+t>this.bundleData.length)throw new V(A.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=t)}ku(){let t=this.cursor,e=this.cursor;for(;e<this.bundleData.length;){if(this.bundleData[e]==="{"){if(e===t)throw new Error("First character is a bracket and not a number");return this.cursor=e,Number(this.bundleData.slice(t,e))}e++}throw new Error("Reached the end of bundle when more is expected.")}};var ul=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new V(A.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield(function(i,s){return P(this,null,function*(){let o=O(i),u={documents:s.map(m=>qi(o.serializer,m))},c=yield o.Jo("BatchGetDocuments",o.serializer.databaseId,H.emptyPath(),u,s.length),h=new Map;c.forEach(m=>{let g=_w(o.serializer,m);h.set(g.key.toString(),g)});let f=[];return s.forEach(m=>{let g=h.get(m.toString());q(!!g,55234,{key:m}),f.push(g)}),f})})(this.datastore,t);return e.forEach(r=>this.recordVersion(r)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(t.toString())}delete(t){this.write(new Je(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return P(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,r)=>{let i=M.fromPath(r);this.mutations.push(new Fi(i,this.precondition(i)))}),yield(function(r,i){return P(this,null,function*(){let s=O(r),o={writes:i.map(u=>ji(s.serializer,u))};yield s.Wo("Commit",s.serializer.databaseId,H.emptyPath(),o)})})(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L(50498,{Wu:t.constructor.name});e=z.min()}let r=this.readVersions.get(t.key.toString());if(r){if(!e.isEqual(r))throw new V(A.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(z.min())?dt.exists(!1):dt.updateTime(e):dt.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(z.min()))throw new V(A.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return dt.updateTime(e)}return dt.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var cl=class{constructor(t,e,r,i,s){this.asyncQueue=t,this.datastore=e,this.options=r,this.updateFunction=i,this.deferred=s,this.Gu=r.maxAttempts,this.F_=new Wi(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_(()=>P(this,null,function*(){let t=new ul(this.datastore),e=this.Ju(t);e&&e.then(r=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.Hu(i)}))}).catch(r=>{this.Hu(r)})}))}Ju(t){try{let e=this.updateFunction(t);return!is(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(t){this.Gu>0&&this.Yu(t)?(this.Gu-=1,this.asyncQueue.enqueueAndForget(()=>(this.ju(),Promise.resolve()))):this.deferred.reject(t)}Yu(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!dp(e)}return!1}};var Ze="FirestoreClient",ll=class{constructor(t,e,r,i,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=i,this.user=wt.UNAUTHENTICATED,this.clientId=Si.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,o=>P(this,null,function*(){k(Ze,"Received user=",o.uid),yield this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(r,o=>(k(Ze,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();let t=new Et;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>P(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let r=Or(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}};function Iu(n,t){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),k(Ze,"Initializing OfflineComponentProvider");let e=n.configuration;yield t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener(i=>P(null,null,function*(){r.isEqual(i)||(yield Mp(t.localStore,i),r=i)})),t.persistence.setDatabaseDeletedListener(()=>{Mt("Terminating Firestore due to IndexedDb database deletion"),n.terminate().then(()=>{k("Terminating Firestore due to IndexedDb database deletion completed successfully")}).catch(i=>{Mt("Terminating Firestore due to IndexedDb database deletion failed",i)})}),n._offlineComponents=t})}function rm(n,t){return P(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let e=yield uh(n);k(Ze,"Initializing OnlineComponentProvider"),yield t.initialize(e,n.configuration),n.setCredentialChangeListener(r=>Jf(t.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>Jf(t.remoteStore,i)),n._onlineComponents=t})}function uh(n){return P(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(Ze,"Using user provided OfflineComponentProvider");try{yield Iu(n,n._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!(function(i){return i.name==="FirebaseError"?i.code===A.FAILED_PRECONDITION||i.code===A.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11})(e))throw e;Mt("Error using user provided cache. Falling back to memory cache: "+e),yield Iu(n,new ha)}}else k(Ze,"Using default OfflineComponentProvider"),yield Iu(n,new Ji(void 0));return n._offlineComponents})}function da(n){return P(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(Ze,"Using user provided OnlineComponentProvider"),yield rm(n,n._uninitializedComponentsProvider._online)):(k(Ze,"Using default OnlineComponentProvider"),yield rm(n,new Fr))),n._onlineComponents})}function rg(n){return uh(n).then(t=>t.persistence)}function Mr(n){return uh(n).then(t=>t.localStore)}function ig(n){return da(n).then(t=>t.remoteStore)}function ch(n){return da(n).then(t=>t.syncEngine)}function sg(n){return da(n).then(t=>t.datastore)}function Pr(n){return P(this,null,function*(){let t=yield da(n),e=t.eventManager;return e.onListen=Qw.bind(null,t.syncEngine),e.onUnlisten=Xw.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Hw.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Jw.bind(null,t.syncEngine),e})}function mv(n){return n.asyncQueue.enqueue(()=>P(null,null,function*(){let t=yield rg(n),e=yield ig(n);return t.setNetworkEnabled(!0),(function(i){let s=O(i);return s.Ia.delete(0),cs(s)})(e)}))}function pv(n){return n.asyncQueue.enqueue(()=>P(null,null,function*(){let t=yield rg(n),e=yield ig(n);return t.setNetworkEnabled(!1),(function(i){return P(this,null,function*(){let s=O(i);s.Ia.add(0),yield xr(s),s.Aa.set("Offline")})})(e)}))}function gv(n,t){let e=new Et;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(i,s,o){return P(this,null,function*(){try{let u=yield(function(h,f){let m=O(h);return m.persistence.runTransaction("read document","readonly",g=>m.localDocuments.getDocument(g,f))})(i,s);u.isFoundDocument()?o.resolve(u):u.isNoDocument()?o.resolve(null):o.reject(new V(A.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let c=Or(u,`Failed to get document '${s} from cache`);o.reject(c)}})})(yield Mr(n),t,e)})),e.promise}function og(n,t,e={}){let r=new Et;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(s,o,u,c,h){let f=new Rr({next:g=>{f.Ou(),o.enqueueAndForget(()=>eh(s,m));let T=g.docs.has(u);!T&&g.fromCache?h.reject(new V(A.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&g.fromCache&&c&&c.source==="server"?h.reject(new V(A.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new Hi(Vr(u.path),f,{includeMetadataChanges:!0,ka:!0});return th(s,m)})(yield Pr(n),n.asyncQueue,t,e,r)})),r.promise}function yv(n,t){let e=new Et;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(i,s,o){return P(this,null,function*(){try{let u=yield Do(i,s,!0),c=new jo(s,u.qs),h=c.nu(u.documents),f=c.applyChanges(h,!1);o.resolve(f.snapshot)}catch(u){let c=Or(u,`Failed to execute query '${s} against cache`);o.reject(c)}})})(yield Mr(n),t,e)})),e.promise}function ag(n,t,e={}){let r=new Et;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(s,o,u,c,h){let f=new Rr({next:g=>{f.Ou(),o.enqueueAndForget(()=>eh(s,m)),g.fromCache&&c.source==="server"?h.reject(new V(A.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):h.resolve(g)},error:g=>h.reject(g)}),m=new Hi(u,f,{includeMetadataChanges:!0,ka:!0});return th(s,m)})(yield Pr(n),n.asyncQueue,t,e,r)})),r.promise}function _v(n,t,e){let r=new Et;return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){try{let i=yield sg(n);r.resolve((function(o,u,c){return P(this,null,function*(){var h;let f=O(o),{request:m,ft:g,parent:T}=vp(f.serializer,Xm(u),c);f.connection.Qo||delete m.parent;let D=(yield f.Jo("RunAggregationQuery",f.serializer.databaseId,T,m,1)).filter(N=>!!N.result);q(D.length===1,64727);let x=(h=D[0].result)===null||h===void 0?void 0:h.aggregateFields;return Object.keys(x).reduce((N,B)=>(N[g[B]]=x[B],N),{})})})(i,t,e))}catch(i){r.reject(i)}})),r.promise}function wv(n,t){let e=new Rr(t);return n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(i,s){O(i).Da.add(s),s.next()})(yield Pr(n),e)})),()=>{e.Ou(),n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return(function(i,s){O(i).Da.delete(s)})(yield Pr(n),e)}))}}function vv(n,t,e,r){let i=(function(o,u){let c;return c=typeof o=="string"?Nl().encode(o):o,(function(f,m){return new ol(f,m)})((function(f,m){if(f instanceof Uint8Array)return nm(f,m);if(f instanceof ArrayBuffer)return nm(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")})(c),u)})(e,Fn(t));n.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){fv(yield ch(n),i,r)}))}function Ev(n,t){return n.asyncQueue.enqueue(()=>P(null,null,function*(){return(function(r,i){let s=O(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Ti.getNamedQuery(o,i))})(yield Mr(n),t)}))}function ug(n,t){return(function(r,i){return new al(r,i)})(n,t)}function Iv(n,t){return n.asyncQueue.enqueue(()=>P(null,null,function*(){return(function(r,i){return P(this,null,function*(){let s=O(r),o=s.indexManager,u=[];return s.persistence.runTransaction("Configure indexes","readwrite",c=>o.getFieldIndexes(c).next(h=>(function(m,g,T,D,x){m=[...m],g=[...g],m.sort(T),g.sort(T);let N=m.length,B=g.length,j=0,U=0;for(;j<B&&U<N;){let W=T(m[U],g[j]);W<0?x(m[U++]):W>0?D(g[j++]):(j++,U++)}for(;j<B;)D(g[j++]);for(;U<N;)x(m[U++])})(h,i,A_,f=>{u.push(o.addFieldIndex(c,f))},f=>{u.push(o.deleteFieldIndex(c,f))})).next(()=>R.waitFor(u)))})})(yield Mr(n),t)}))}function Tv(n,t){return n.asyncQueue.enqueue(()=>P(null,null,function*(){return(function(r,i){O(r).Cs.Rs=i})(yield Mr(n),t)}))}function bv(n){return n.asyncQueue.enqueue(()=>P(null,null,function*(){return(function(e){let r=O(e),i=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))})(yield Mr(n))}))}function cg(n){let t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}var im=new Map;var lg="firestore.googleapis.com",sm=!0,$o=class{constructor(t){var e,r;if(t.host===void 0){if(t.ssl!==void 0)throw new V(A.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lg,this.ssl=sm}else this.host=t.host,this.ssl=(e=t.ssl)!==null&&e!==void 0?e:sm;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Pp;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<xp)throw new V(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}b_("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cg((r=t.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),(function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new V(A.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,i){return r.timeoutSeconds===i.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},Vn=class{constructor(t,e,r,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $o({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new V(A.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new V(A.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $o(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Tu;switch(r.type){case"firstParty":return new Ru(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new V(A.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}_restart(){return P(this,null,function*(){this._terminateTask==="notTerminated"?yield this._terminate():this._terminateTask="notTerminated"})}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){let r=im.get(e);r&&(k("ComponentProvider","Removing Datastore"),im.delete(e),r.terminate())})(this),Promise.resolve()}};function Av(n,t,e,r={}){var i;n=Q(n,Vn);let s=oi(t),o=n._getSettings(),u=Object.assign(Object.assign({},o),{emulatorOptions:n._getEmulatorOptions()}),c=`${t}:${e}`;s&&(Qa(`https://${c}`),Ad("Firestore",!0)),o.host!==lg&&o.host!==c&&Mt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let h=Object.assign(Object.assign({},o),{host:c,ssl:s,emulatorOptions:r});if(!Yt(h,u)&&(n._setSettings(h),r.mockUserToken)){let f,m;if(typeof r.mockUserToken=="string")f=r.mockUserToken,m=wt.MOCK_USER;else{f=bd(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new V(A.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");m=new wt(g)}n._authCredentials=new bu(new Js(f,m))}}var At=class n{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new n(this.firestore,t,this._query)}},ot=class n{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new n(this.firestore,t,this._key)}toJSON(){return{type:n._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(On(e,n._jsonSchema))return new n(t,r||null,new M(H.fromString(e.referencePath)))}};ot._jsonSchemaVersion="firestore/documentReference/1.0",ot._jsonSchema={type:vt("string",ot._jsonSchemaVersion),referencePath:vt("string")};var oe=class n extends At{constructor(t,e,r){super(t,e,Vr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ot(this.firestore,null,new M(t))}withConverter(t){return new n(this.firestore,t,this._path)}};function DE(n,t,...e){if(n=gt(n),kl("collection","path",t),n instanceof Vn){let r=H.fromString(t,...e);return Zd(r),new oe(n,null,r)}{if(!(n instanceof ot||n instanceof oe))throw new V(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(H.fromString(t,...e));return Zd(r),new oe(n.firestore,null,r)}}function VE(n,t){if(n=Q(n,Vn),kl("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(A.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(n,null,(function(r){return new Ht(H.emptyPath(),r)})(t))}function Sv(n,t,...e){if(n=gt(n),arguments.length===1&&(t=Si.newId()),kl("doc","path",t),n instanceof Vn){let r=H.fromString(t,...e);return Yd(r),new ot(n,null,new M(r))}{if(!(n instanceof ot||n instanceof oe))throw new V(A.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(H.fromString(t,...e));return Yd(r),new ot(n.firestore,n instanceof oe?n.converter:null,new M(r))}}function xE(n,t){return n=gt(n),t=gt(t),(n instanceof ot||n instanceof oe)&&(t instanceof ot||t instanceof oe)&&n.firestore===t.firestore&&n.path===t.path&&n.converter===t.converter}function hg(n,t){return n=gt(n),t=gt(t),n instanceof At&&t instanceof At&&n.firestore===t.firestore&&as(n._query,t._query)&&n.converter===t.converter}var om="AsyncQueue",Go=class{constructor(t=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new Wi(this,"async_queue_retry"),this.oc=()=>{let r=Xs();r&&k(om,"Visibility state changed to "+r.visibilityState),this.F_.y_()},this._c=t;let e=Xs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.ac(),this.uc(t)}enterRestrictedMode(t){if(!this.Xu){this.Xu=!0,this.rc=t||!1;let e=Xs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.oc)}}enqueue(t){if(this.ac(),this.Xu)return new Promise(()=>{});let e=new Et;return this.uc(()=>this.Xu&&this.rc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Zu.push(t),this.cc()))}cc(){return P(this,null,function*(){if(this.Zu.length!==0){try{yield this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(t){if(!en(t))throw t;k(om,"Operation failed with retryable error: "+t)}this.Zu.length>0&&this.F_.g_(()=>this.cc())}})}uc(t){let e=this._c.then(()=>(this.nc=!0,t().catch(r=>{throw this.tc=r,this.nc=!1,ft("INTERNAL UNHANDLED ERROR: ",am(r)),r}).then(r=>(this.nc=!1,r))));return this._c=e,e}enqueueAfterDelay(t,e,r){this.ac(),this.sc.indexOf(t)>-1&&(e=0);let i=Yc.createAndSchedule(this,t,e,r,s=>this.lc(s));return this.ec.push(i),i}ac(){this.tc&&L(47125,{hc:am(this.tc)})}verifyOperationInProgress(){}Pc(){return P(this,null,function*(){let t;do t=this._c,yield t;while(t!==this._c)})}Tc(t){for(let e of this.ec)if(e.timerId===t)return!0;return!1}Ic(t){return this.Pc().then(()=>{this.ec.sort((e,r)=>e.targetTimeMs-r.targetTimeMs);for(let e of this.ec)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Pc()})}dc(t){this.sc.push(t)}lc(t){let e=this.ec.indexOf(t);this.ec.splice(e,1)}};function am(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function sr(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1})(n,["next","error","complete"])}var hl=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Et,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,r){this._progressObserver={next:t,error:e,complete:r}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var NE=-1,nt=class extends Vn{constructor(t,e,r,i){super(t,e,r,i),this.type="firestore",this._queue=new Go,this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return P(this,null,function*(){if(this._firestoreClient){let t=this._firestoreClient.terminate();this._queue=new Go(t),this._firestoreClient=void 0,yield t}})}};function kE(n,t,e){e||(e=Ni);let r=ks(n,"firestore");if(r.isInitialized(e)){let i=r.getImmediate({identifier:e}),s=r.getOptions(e);if(Yt(s,t))return i;throw new V(A.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(t.cacheSizeBytes!==void 0&&t.localCache!==void 0)throw new V(A.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(t.cacheSizeBytes!==void 0&&t.cacheSizeBytes!==-1&&t.cacheSizeBytes<xp)throw new V(A.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return t.host&&oi(t.host)&&Qa(t.host),r.initialize({options:t,instanceIdentifier:e})}function OE(n,t){let e=typeof n=="object"?n:zd(),r=typeof n=="string"?n:t||Ni,i=ks(e,"firestore").getImmediate({identifier:r});if(!i._initialized){let s=Td("firestore");s&&Av(i,...s)}return i}function lt(n){if(n._terminated)throw new V(A.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||dg(n),n._firestoreClient}function dg(n){var t,e,r;let i=n._freezeSettings(),s=(function(u,c,h,f){return new Bu(u,c,h,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,cg(f.experimentalLongPollingOptions),f.useFetchStreams,f.isUsingEmulator)})(n._databaseId,((t=n._app)===null||t===void 0?void 0:t.options.appId)||"",n._persistenceKey,i);n._componentsProvider||!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),n._firestoreClient=new ll(n._authCredentials,n._appCheckCredentials,n._queue,s,n._componentsProvider&&(function(u){let c=u?._online.build();return{_offline:u?._offline.build(c),_online:c}})(n._componentsProvider))}function FE(n,t){Mt("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=n._freezeSettings();return fg(n,Fr.provider,{build:r=>new Yi(r,e.cacheSizeBytes,t?.forceOwnership)}),Promise.resolve()}function ME(n){return P(this,null,function*(){Mt("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings();fg(n,Fr.provider,{build:e=>new zo(e,t.cacheSizeBytes)})})}function fg(n,t,e){if((n=Q(n,nt))._firestoreClient||n._terminated)throw new V(A.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(n._componentsProvider||n._getSettings().localCache)throw new V(A.FAILED_PRECONDITION,"SDK cache is already specified.");n._componentsProvider={_online:t,_offline:e},dg(n)}function LE(n){if(n._initialized&&!n._terminated)throw new V(A.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new Et;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>P(null,null,function*(){try{yield(function(r){return P(this,null,function*(){if(!Ge.C())return Promise.resolve();let i=r+Op;yield Ge.delete(i)})})(Hl(n._databaseId,n._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function BE(n){return(function(e){let r=new Et;return e.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return nv(yield ch(e),r)})),r.promise})(lt(n=Q(n,nt)))}function UE(n){return mv(lt(n=Q(n,nt)))}function qE(n){return pv(lt(n=Q(n,nt)))}function jE(n){return Ud(n.app,"firestore",n._databaseId.database),n._delete()}function um(n,t){let e=lt(n=Q(n,nt)),r=new hl;return vv(e,n._databaseId,t,r),r}function Rv(n,t){return Ev(lt(n=Q(n,nt)),t).then(e=>e?new At(n,null,e.query):null)}var xn=class{constructor(t="count",e){this._internalFieldPath=e,this.type="AggregateField",this.aggregateType=t}},dl=class{constructor(t,e,r){this._userDataWriter=e,this._data=r,this.type="AggregateQuerySnapshot",this.query=t}data(){return this._userDataWriter.convertObjectMap(this._data)}};var ve=class n{constructor(t){this._byteString=t}static fromBase64String(t){try{return new n(pt.fromBase64String(t))}catch(e){throw new V(A.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new n(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:n._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(On(t,n._jsonSchema))return n.fromBase64String(t.bytes)}};ve._jsonSchemaVersion="firestore/bytes/1.0",ve._jsonSchema={type:vt("string",ve._jsonSchemaVersion),bytes:vt("string")};var Se=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new V(A.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new It(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};function zE(){return new Se(Du)}var Re=class{constructor(t){this._methodName=t}};var je=class n{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new V(A.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new V(A.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return $(this._lat,t._lat)||$(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:n._jsonSchemaVersion}}static fromJSON(t){if(On(t,n._jsonSchema))return new n(t.latitude,t.longitude)}};je._jsonSchemaVersion="firestore/geoPoint/1.0",je._jsonSchema={type:vt("string",je._jsonSchemaVersion),latitude:vt("number"),longitude:vt("number")};var Ee=class n{constructor(t){this._values=(t||[]).map(e=>e)}toArray(){return this._values.map(t=>t)}isEqual(t){return(function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0})(this._values,t._values)}toJSON(){return{type:n._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(On(t,n._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every(e=>typeof e=="number"))return new n(t.vectorValues);throw new V(A.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}};Ee._jsonSchemaVersion="firestore/vectorValue/1.0",Ee._jsonSchema={type:vt("string",Ee._jsonSchemaVersion),vectorValues:vt("object")};var Pv=/^__.*__$/,fl=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms):new Xe(t,this.data,e,this.fieldTransforms)}},Ko=class{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return new Jt(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function mg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ec:n})}}var Wo=class n{constructor(t,e,r,i,s,o){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(t){return new n(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:r,mc:!1});return i.fc(t),i}gc(t){var e;let r=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.Rc({path:r,mc:!1});return i.Ac(),i}yc(t){return this.Rc({path:void 0,mc:!0})}wc(t){return Qo(t,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}Ac(){if(this.path)for(let t=0;t<this.path.length;t++)this.fc(this.path.get(t))}fc(t){if(t.length===0)throw this.wc("Document fields must not be empty");if(mg(this.Ec)&&Pv.test(t))throw this.wc('Document fields cannot begin and end with "__"')}},ml=class{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Fn(t)}Dc(t,e,r,i=!1){return new Wo({Ec:t,methodName:e,bc:r,path:It.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Mn(n){let t=n._freezeSettings(),e=Fn(n._databaseId);return new ml(n._databaseId,!!t.ignoreUndefinedProperties,e)}function fa(n,t,e,r,i,s={}){let o=n.Dc(s.merge||s.mergeFields?2:0,t,e,i);dh("Data must be an object, but it was:",o,r);let u=yg(r,o),c,h;if(s.merge)c=new zt(o.fieldMask),h=o.fieldTransforms;else if(s.mergeFields){let f=[];for(let m of s.mergeFields){let g=ts(t,m,e);if(!o.contains(g))throw new V(A.INVALID_ARGUMENT,`Field '${g}' is specified in your field mask but missing from your input data.`);wg(f,g)||f.push(g)}c=new zt(f),h=o.fieldTransforms.filter(m=>c.covers(m.field))}else c=null,h=o.fieldTransforms;return new fl(new xt(u),c,h)}var Zi=class n extends Re{_toFieldTransform(t){if(t.Ec!==2)throw t.Ec===1?t.wc(`${this._methodName}() can only appear at the top level of your update data`):t.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof n}};function pg(n,t,e){return new Wo({Ec:3,bc:t.settings.bc,methodName:n._methodName,mc:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var pl=class n extends Re{_toFieldTransform(t){return new Sn(t.path,new Qe)}isEqual(t){return t instanceof n}},gl=class n extends Re{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=pg(this,t,!0),r=this.vc.map(s=>Ln(s,e)),i=new be(r);return new Sn(t.path,i)}isEqual(t){return t instanceof n&&Yt(this.vc,t.vc)}},yl=class n extends Re{constructor(t,e){super(t),this.vc=e}_toFieldTransform(t){let e=pg(this,t,!0),r=this.vc.map(s=>Ln(s,e)),i=new Ae(r);return new Sn(t.path,i)}isEqual(t){return t instanceof n&&Yt(this.vc,t.vc)}},_l=class n extends Re{constructor(t,e){super(t),this.Cc=e}_toFieldTransform(t){let e=new He(t.serializer,sp(t.serializer,this.Cc));return new Sn(t.path,e)}isEqual(t){return t instanceof n&&this.Cc===t.Cc}};function lh(n,t,e,r){let i=n.Dc(1,t,e);dh("Data must be an object, but it was:",i,r);let s=[],o=xt.empty();nn(r,(c,h)=>{let f=ma(t,c,e);h=gt(h);let m=i.gc(f);if(h instanceof Zi)s.push(f);else{let g=Ln(h,m);g!=null&&(s.push(f),o.set(f,g))}});let u=new zt(s);return new Ko(o,u,i.fieldTransforms)}function hh(n,t,e,r,i,s){let o=n.Dc(1,t,e),u=[ts(t,r,e)],c=[i];if(s.length%2!=0)throw new V(A.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let g=0;g<s.length;g+=2)u.push(ts(t,s[g])),c.push(s[g+1]);let h=[],f=xt.empty();for(let g=u.length-1;g>=0;--g)if(!wg(h,u[g])){let T=u[g],D=c[g];D=gt(D);let x=o.gc(T);if(D instanceof Zi)h.push(T);else{let N=Ln(D,x);N!=null&&(h.push(T),f.set(T,N))}}let m=new zt(h);return new Ko(f,m,o.fieldTransforms)}function gg(n,t,e,r=!1){return Ln(e,n.Dc(r?4:3,t))}function Ln(n,t){if(_g(n=gt(n)))return dh("Unsupported field value:",t,n),yg(n,t);if(n instanceof Re)return(function(r,i){if(!mg(i.Ec))throw i.wc(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.wc(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.mc&&t.Ec!==4)throw t.wc("Nested arrays are not supported");return(function(r,i){let s=[],o=0;for(let u of r){let c=Ln(u,i.yc(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}})(n,t)}return(function(r,i){if((r=gt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return sp(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ct.fromDate(r);return{timestampValue:vr(i.serializer,s)}}if(r instanceof ct){let s=new ct(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:vr(i.serializer,s)}}if(r instanceof je)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof ve)return{bytesValue:mp(i.serializer,r._byteString)};if(r instanceof ot){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.wc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Wl(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ee)return(function(o,u){return{mapValue:{fields:{[ql]:{stringValue:jl},[pr]:{arrayValue:{values:o.toArray().map(h=>{if(typeof h!="number")throw u.wc("VectorValues must only contain numeric values.");return Kl(u.serializer,h)})}}}}}})(r,i);throw i.wc(`Unsupported field value: ${Zo(r)}`)})(n,t)}function yg(n,t){let e={};return Om(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):nn(n,(r,i)=>{let s=Ln(i,t.Vc(r));s!=null&&(e[r]=s)}),{mapValue:{fields:e}}}function _g(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ct||n instanceof je||n instanceof ve||n instanceof ot||n instanceof Re||n instanceof Ee)}function dh(n,t,e){if(!_g(e)||!ym(e)){let r=Zo(e);throw r==="an object"?t.wc(n+" a custom object"):t.wc(n+" "+r)}}function ts(n,t,e){if((t=gt(t))instanceof Se)return t._internalPath;if(typeof t=="string")return ma(n,t);throw Qo("Field path arguments must be of type string or ",n,!1,void 0,e)}var Cv=new RegExp("[~\\*/\\[\\]]");function ma(n,t,e){if(t.search(Cv)>=0)throw Qo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Se(...t.split("."))._internalPath}catch{throw Qo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Qo(n,t,e,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new V(A.INVALID_ARGUMENT,u+n+c)}function wg(n,t){return n.some(e=>e.isEqual(t))}var Nn=class{constructor(t,e,r,i,s){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ot(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new wl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(pa("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},wl=class extends Nn{data(){return super.data()}};function pa(n,t){return typeof t=="string"?ma(n,t):t instanceof Se?t._internalPath:t._delegate._internalPath}function vg(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new V(A.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var es=class{},kn=class extends es{};function $E(n,t,...e){let r=[];t instanceof es&&r.push(t),r=r.concat(e),(function(s){let o=s.filter(c=>c instanceof Cr).length,u=s.filter(c=>c instanceof ns).length;if(o>1||o>0&&u>0)throw new V(A.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(let i of r)n=i._apply(n);return n}var ns=class n extends kn{constructor(t,e,r){super(),this._field=t,this._op=e,this._value=r,this.type="where"}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=this._parse(t);return Ig(t._query,e),new At(t.firestore,t.converter,Yu(t._query,e))}_parse(t){let e=Mn(t.firestore);return(function(s,o,u,c,h,f,m){let g;if(h.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new V(A.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){lm(m,f);let D=[];for(let x of m)D.push(cm(c,s,x));g={arrayValue:{values:D}}}else g=cm(c,s,m)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||lm(m,f),g=gg(u,o,m,f==="in"||f==="not-in");return X.create(h,f,g)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function GE(n,t,e){let r=t,i=pa("where",n);return ns._create(i,r,e)}var Cr=class n extends es{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new n(t,e)}_parse(t){let e=this._queryConstraints.map(r=>r._parse(t)).filter(r=>r.getFilters().length>0);return e.length===1?e[0]:et.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:((function(i,s){let o=i,u=s.getFlattenedFilters();for(let c of u)Ig(o,c),o=Yu(o,c)})(t._query,e),new At(t.firestore,t.converter,Yu(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};function KE(...n){return n.forEach(t=>Tg("or",t)),Cr._create("or",n)}function WE(...n){return n.forEach(t=>Tg("and",t)),Cr._create("and",n)}var vl=class n extends kn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new n(t,e)}_apply(t){let e=(function(i,s,o){if(i.startAt!==null)throw new V(A.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new V(A.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new bn(s,o)})(t._query,this._field,this._direction);return new At(t.firestore,t.converter,(function(i,s){let o=i.explicitOrderBy.concat([s]);return new Ht(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(t._query,e))}};function QE(n,t="asc"){let e=t,r=pa("orderBy",n);return vl._create(r,e)}var Ho=class n extends kn{constructor(t,e,r){super(),this.type=t,this._limit=e,this._limitType=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){return new At(t.firestore,t.converter,lo(t._query,this._limit,this._limitType))}};function HE(n){return _m("limit",n),Ho._create("limit",n,"F")}function XE(n){return _m("limitToLast",n),Ho._create("limitToLast",n,"L")}var Xo=class n extends kn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Eg(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,(function(i,s){return new Ht(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)})(t._query,e))}};function JE(...n){return Xo._create("startAt",n,!0)}function YE(...n){return Xo._create("startAfter",n,!1)}var Jo=class n extends kn{constructor(t,e,r){super(),this.type=t,this._docOrFields=e,this._inclusive=r}static _create(t,e,r){return new n(t,e,r)}_apply(t){let e=Eg(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,(function(i,s){return new Ht(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)})(t._query,e))}};function ZE(...n){return Jo._create("endBefore",n,!1)}function tI(...n){return Jo._create("endAt",n,!0)}function Eg(n,t,e,r){if(e[0]=gt(e[0]),e[0]instanceof Nn)return(function(s,o,u,c,h){if(!c)throw new V(A.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let m of rr(s))if(m.field.isKeyField())f.push(Tn(o,c.key));else{let g=c.data.field(m.field);if(ra(g))throw new V(A.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(g===null){let T=m.field.canonicalString();throw new V(A.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${T}' (used as the orderBy) does not exist.`)}f.push(g)}return new ue(f,h)})(n._query,n.firestore._databaseId,t,e[0]._document,r);{let i=Mn(n.firestore);return(function(o,u,c,h,f,m){let g=o.explicitOrderBy;if(f.length>g.length)throw new V(A.INVALID_ARGUMENT,`Too many arguments provided to ${h}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let T=[];for(let D=0;D<f.length;D++){let x=f[D];if(g[D].field.isKeyField()){if(typeof x!="string")throw new V(A.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${h}(), but got a ${typeof x}`);if(!$l(o)&&x.indexOf("/")!==-1)throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${h}() must be a plain document ID, but '${x}' contains a slash.`);let N=o.path.child(H.fromString(x));if(!M.isDocumentKey(N))throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${h}() must result in a valid document path, but '${N}' is not because it contains an odd number of segments.`);let B=new M(N);T.push(Tn(u,B))}else{let N=gg(c,h,x);T.push(N)}}return new ue(T,m)})(n._query,n.firestore._databaseId,i,t,e,r)}}function cm(n,t,e){if(typeof(e=gt(e))=="string"){if(e==="")throw new V(A.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!$l(t)&&e.indexOf("/")!==-1)throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let r=t.path.child(H.fromString(e));if(!M.isDocumentKey(r))throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Tn(n,new M(r))}if(e instanceof ot)return Tn(n,e._key);throw new V(A.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Zo(e)}.`)}function lm(n,t){if(!Array.isArray(n)||n.length===0)throw new V(A.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function Ig(n,t){let e=(function(i,s){for(let o of i)for(let u of o.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null})(n.filters,(function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new V(A.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new V(A.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}function Tg(n,t){if(!(t instanceof ns||t instanceof Cr))throw new V(A.INVALID_ARGUMENT,`Function ${n}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}var Yo=class{convertValue(t,e="none"){switch(Ke(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ut(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Te(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let r={};return nn(t,(i,s)=>{r[i]=this.convertValue(s,e)}),r}convertVectorValue(t){var e,r,i;let s=(i=(r=(e=t.fields)===null||e===void 0?void 0:e[pr].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(o=>ut(o.doubleValue));return new Ee(s)}convertGeoPoint(t){return new je(ut(t.latitude),ut(t.longitude))}convertArray(t,e){return(t.values||[]).map(r=>this.convertValue(r,e))}convertServerTimestamp(t,e){switch(e){case"previous":let r=ia(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(xi(t));default:return null}}convertTimestamp(t){let e=Ie(t);return new ct(e.seconds,e.nanos)}convertDocumentKey(t,e){let r=H.fromString(t);q(bp(r),9688,{name:t});let i=new mr(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(e)||ft(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function ga(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}var rs=class extends Yo{constructor(t){super(),this.firestore=t}convertBytes(t){return new ve(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function eI(n){return new xn("sum",ts("sum",n))}function nI(n){return new xn("avg",ts("average",n))}function Dv(){return new xn("count")}function rI(n,t){var e,r;return n instanceof xn&&t instanceof xn&&n.aggregateType===t.aggregateType&&((e=n._internalFieldPath)===null||e===void 0?void 0:e.canonicalString())===((r=t._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function iI(n,t){return hg(n.query,t.query)&&Yt(n.data(),t.data())}var bg="NOT SUPPORTED",re=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},$t=class n extends Nn{constructor(t,e,r,i,s,o){super(t,e,r,i,o),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new or(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let r=this._document.data.field(pa("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new V(A.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t=this._document,e={};return e.type=n._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}};function sI(n,t,e){if(On(t,$t._jsonSchema)){if(t.bundle===bg)throw new V(A.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Fn(n._databaseId),i=ug(t.bundle,r),s=i.Ku(),o=new Xi(i.getMetadata(),r);for(let f of s)o.Wa(f);let u=o.documents;if(u.length!==1)throw new V(A.INVALID_ARGUMENT,`Expected bundle data to contain 1 document, but it contains ${u.length} documents.`);let c=oa(r,u[0].document),h=new M(H.fromString(t.bundleName));return new $t(n,new rs(n),h,c,new re(!1,!1),e||null)}}$t._jsonSchemaVersion="firestore/documentSnapshot/1.0",$t._jsonSchema={type:vt("string",$t._jsonSchemaVersion),bundleSource:vt("string","DocumentSnapshot"),bundleName:vt("string"),bundle:vt("string")};var or=class extends $t{data(t={}){return super.data(t)}},Gt=class n{constructor(t,e,r,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new re(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(r=>{t.call(e,new or(this._firestore,this._userDataWriter,r.key,r,new re(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new V(A.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(u=>{let c=new or(i._firestore,i._userDataWriter,u.doc.key,u.doc,new re(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let c=new or(i._firestore,i._userDataWriter,u.doc.key,u.doc,new re(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),h=-1,f=-1;return u.type!==0&&(h=o.indexOf(u.doc.key),o=o.delete(u.doc.key)),u.type!==1&&(o=o.add(u.doc),f=o.indexOf(u.doc.key)),{type:Vv(u.type),doc:c,oldIndex:h,newIndex:f}})}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new V(A.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let t={};t.type=n._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Si.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let e=[],r=[],i=[];return this.docs.forEach(s=>{s._document!==null&&(e.push(s._document),r.push(this._userDataWriter.convertObjectMap(s._document.data.value.mapValue.fields,"previous")),i.push(s.ref.path))}),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}};function oI(n,t,e){if(On(t,Gt._jsonSchema)){if(t.bundle===bg)throw new V(A.INVALID_ARGUMENT,"The provided JSON object was created in a client environment, which is not supported.");let r=Fn(n._databaseId),i=ug(t.bundle,r),s=i.Ku(),o=new Xi(i.getMetadata(),r);for(let g of s)o.Wa(g);if(o.queries.length!==1)throw new V(A.INVALID_ARGUMENT,`Snapshot data expected 1 query but found ${o.queries.length} queries.`);let u=ua(o.queries[0].bundledQuery),c=o.documents,h=new Qi;c.map(g=>{let T=oa(r,g.document);h=h.add(T)});let f=Dn.fromInitialDocuments(u,h,G(),!1,!1),m=new At(n,e||null,u);return new Gt(n,new rs(n),m,f)}}function Vv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}function aI(n,t){return n instanceof $t&&t instanceof $t?n._firestore===t._firestore&&n._key.isEqual(t._key)&&(n._document===null?t._document===null:n._document.isEqual(t._document))&&n._converter===t._converter:n instanceof Gt&&t instanceof Gt&&n._firestore===t._firestore&&hg(n.query,t.query)&&n.metadata.isEqual(t.metadata)&&n._snapshot.isEqual(t._snapshot)}function uI(n){n=Q(n,ot);let t=Q(n.firestore,nt);return og(lt(t),n._key).then(e=>fh(t,n,e))}Gt._jsonSchemaVersion="firestore/querySnapshot/1.0",Gt._jsonSchema={type:vt("string",Gt._jsonSchemaVersion),bundleSource:vt("string","QuerySnapshot"),bundleName:vt("string"),bundle:vt("string")};var ce=class extends Yo{constructor(t){super(),this.firestore=t}convertBytes(t){return new ve(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ot(this.firestore,null,e)}};function cI(n){n=Q(n,ot);let t=Q(n.firestore,nt),e=lt(t),r=new ce(t);return gv(e,n._key).then(i=>new $t(t,r,n._key,i,new re(i!==null&&i.hasLocalMutations,!0),n.converter))}function lI(n){n=Q(n,ot);let t=Q(n.firestore,nt);return og(lt(t),n._key,{source:"server"}).then(e=>fh(t,n,e))}function hI(n){n=Q(n,At);let t=Q(n.firestore,nt),e=lt(t),r=new ce(t);return vg(n._query),ag(e,n._query).then(i=>new Gt(t,r,n,i))}function dI(n){n=Q(n,At);let t=Q(n.firestore,nt),e=lt(t),r=new ce(t);return yv(e,n._query).then(i=>new Gt(t,r,n,i))}function fI(n){n=Q(n,At);let t=Q(n.firestore,nt),e=lt(t),r=new ce(t);return ag(e,n._query,{source:"server"}).then(i=>new Gt(t,r,n,i))}function mI(n,t,e){n=Q(n,ot);let r=Q(n.firestore,nt),i=ga(n.converter,t,e);return ls(r,[fa(Mn(r),"setDoc",n._key,i,n.converter!==null,e).toMutation(n._key,dt.none())])}function pI(n,t,e,...r){n=Q(n,ot);let i=Q(n.firestore,nt),s=Mn(i),o;return o=typeof(t=gt(t))=="string"||t instanceof Se?hh(s,"updateDoc",n._key,t,e,r):lh(s,"updateDoc",n._key,t),ls(i,[o.toMutation(n._key,dt.exists(!0))])}function gI(n){return ls(Q(n.firestore,nt),[new Je(n._key,dt.none())])}function yI(n,t){let e=Q(n.firestore,nt),r=Sv(n),i=ga(n.converter,t);return ls(e,[fa(Mn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,dt.exists(!1))]).then(()=>r)}function hm(n,...t){var e,r,i;n=gt(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof t[o]!="object"||sr(t[o])||(s=t[o++]);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(sr(t[o])){let m=t[o];t[o]=(e=m.next)===null||e===void 0?void 0:e.bind(m),t[o+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),t[o+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let c,h,f;if(n instanceof ot)h=Q(n.firestore,nt),f=Vr(n._key.path),c={next:m=>{t[o]&&t[o](fh(h,n,m))},error:t[o+1],complete:t[o+2]};else{let m=Q(n,At);h=Q(m.firestore,nt),f=m._query;let g=new ce(h);c={next:T=>{t[o]&&t[o](new Gt(h,g,m,T))},error:t[o+1],complete:t[o+2]},vg(n._query)}return(function(g,T,D,x){let N=new Rr(x),B=new Hi(T,N,D);return g.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return th(yield Pr(g),B)})),()=>{N.Ou(),g.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return eh(yield Pr(g),B)}))}})(lt(h),f,u,c)}function _I(n,t,...e){let r=gt(n),i=(function(c){let h={bundle:"",bundleName:"",bundleSource:""},f=["bundle","bundleName","bundleSource"];for(let m of f){if(!(m in c)){h.error=`snapshotJson missing required field: ${m}`;break}let g=c[m];if(typeof g!="string"){h.error=`snapshotJson field '${m}' must be a string.`;break}if(g.length===0){h.error=`snapshotJson field '${m}' cannot be an empty string.`;break}m==="bundle"?h.bundle=g:m==="bundleName"?h.bundleName=g:m==="bundleSource"&&(h.bundleSource=g)}return h})(t);if(i.error)throw new V(A.INVALID_ARGUMENT,i.error);let s,o=0;if(typeof e[o]!="object"||sr(e[o])||(s=e[o++]),i.bundleSource==="QuerySnapshot"){let u=null;if(typeof e[o]=="object"&&sr(e[o])){let c=e[o++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[o++],error:e[o++],complete:e[o++]};return(function(h,f,m,g,T){let D,x=!1;return um(h,f.bundle).then(()=>Rv(h,f.bundleName)).then(B=>{B&&!x&&(T&&B.withConverter(T),D=hm(B,m||{},g))}).catch(B=>(g.error&&g.error(B),()=>{})),()=>{x||(x=!0,D&&D())}})(r,i,s,u,e[o])}if(i.bundleSource==="DocumentSnapshot"){let u=null;if(typeof e[o]=="object"&&sr(e[o])){let c=e[o++];u={next:c.next,error:c.error,complete:c.complete}}else u={next:e[o++],error:e[o++],complete:e[o++]};return(function(h,f,m,g,T){let D,x=!1;return um(h,f.bundle).then(()=>{if(!x){let B=new ot(h,T||null,M.fromPath(f.bundleName));D=hm(B,m||{},g)}}).catch(B=>(g.error&&g.error(B),()=>{})),()=>{x||(x=!0,D&&D())}})(r,i,s,u,e[o])}throw new V(A.INVALID_ARGUMENT,`unsupported bundle source: ${i.bundleSource}`)}function wI(n,t){return wv(lt(n=Q(n,nt)),sr(t)?t:{next:t})}function ls(n,t){return(function(r,i){let s=new Et;return r.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){return Yw(yield ch(r),i,s)})),s.promise})(lt(n),t)}function fh(n,t,e){let r=e.docs.get(t._key),i=new ce(n);return new $t(n,i,t._key,r,new re(e.hasPendingWrites,e.fromCache),t.converter)}function vI(n){return xv(n,{count:Dv()})}function xv(n,t){let e=Q(n.firestore,nt),r=lt(e),i=km(t,(s,o)=>new ho(o,s.aggregateType,s._internalFieldPath));return _v(r,n._query,i).then(s=>(function(u,c,h){let f=new ce(u);return new dl(c,f,h)})(e,n,s))}var El=class{constructor(t){this.kind="memory",this._onlineComponentProvider=Fr.provider,t?.garbageCollector?this._offlineComponentProvider=t.garbageCollector._offlineComponentProvider:this._offlineComponentProvider={build:()=>new Ji(void 0)}}toJSON(){return{kind:this.kind}}},Il=class{constructor(t){let e;this.kind="persistent",t?.tabManager?(t.tabManager._initialize(t),e=t.tabManager):(e=Nv(void 0),e._initialize(t)),this._onlineComponentProvider=e._onlineComponentProvider,this._offlineComponentProvider=e._offlineComponentProvider}toJSON(){return{kind:this.kind}}},Tl=class{constructor(){this.kind="memoryEager",this._offlineComponentProvider=ha.provider}toJSON(){return{kind:this.kind}}},bl=class{constructor(t){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new Ji(t)}}toJSON(){return{kind:this.kind}}};function EI(){return new Tl}function II(n){return new bl(n?.cacheSizeBytes)}function TI(n){return new El(n)}function bI(n){return new Il(n)}var Al=class{constructor(t){this.forceOwnership=t,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Fr.provider,this._offlineComponentProvider={build:e=>new Yi(e,t?.cacheSizeBytes,this.forceOwnership)}}},Sl=class{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(t){this._onlineComponentProvider=Fr.provider,this._offlineComponentProvider={build:e=>new zo(e,t?.cacheSizeBytes)}}};function Nv(n){return new Al(n?.forceOwnership)}function AI(){return new Sl}var kv={maxAttempts:5};var Rl=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Mn(t)}set(t,e,r){this._verifyNotCommitted();let i=Ue(t,this._firestore),s=ga(i.converter,e,r),o=fa(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,dt.none())),this}update(t,e,r,...i){this._verifyNotCommitted();let s=Ue(t,this._firestore),o;return o=typeof(e=gt(e))=="string"||e instanceof Se?hh(this._dataReader,"WriteBatch.update",s._key,e,r,i):lh(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,dt.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=Ue(t,this._firestore);return this._mutations=this._mutations.concat(new Je(e._key,dt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(A.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Ue(n,t){if((n=gt(n)).firestore!==t)throw new V(A.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var Pl=class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=Mn(t)}get(t){let e=Ue(t,this._firestore),r=new rs(this._firestore);return this._transaction.lookup([e._key]).then(i=>{if(!i||i.length!==1)return L(24041);let s=i[0];if(s.isFoundDocument())return new Nn(this._firestore,r,s.key,s,e.converter);if(s.isNoDocument())return new Nn(this._firestore,r,e._key,null,e.converter);throw L(18433,{doc:s})})}set(t,e,r){let i=Ue(t,this._firestore),s=ga(i.converter,e,r),o=fa(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(t,e,r,...i){let s=Ue(t,this._firestore),o;return o=typeof(e=gt(e))=="string"||e instanceof Se?hh(this._dataReader,"Transaction.update",s._key,e,r,i):lh(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this}delete(t){let e=Ue(t,this._firestore);return this._transaction.delete(e._key),this}};var Cl=class extends Pl{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=Ue(t,this._firestore),r=new ce(this._firestore);return super.get(t).then(i=>new $t(this._firestore,r,e._key,i._document,new re(!1,!1),e.converter))}};function SI(n,t,e){n=Q(n,nt);let r=Object.assign(Object.assign({},kv),e);return(function(s){if(s.maxAttempts<1)throw new V(A.INVALID_ARGUMENT,"Max attempts must be at least 1")})(r),(function(s,o,u){let c=new Et;return s.asyncQueue.enqueueAndForget(()=>P(null,null,function*(){let h=yield sg(s);new cl(s.asyncQueue,h,u,o,c).zu()})),c.promise})(lt(n),i=>t(new Cl(n,i)),r)}function RI(){return new Zi("deleteField")}function PI(){return new pl("serverTimestamp")}function CI(...n){return new gl("arrayUnion",n)}function DI(...n){return new yl("arrayRemove",n)}function VI(n){return new _l("increment",n)}function xI(n){return new Ee(n)}function NI(n){return lt(n=Q(n,nt)),new Rl(n,t=>ls(n,t))}function kI(n,t){let e=lt(n=Q(n,nt));if(!e._uninitializedComponentsProvider||e._uninitializedComponentsProvider._offline.kind==="memory")return Mt("Cannot enable indexes when persistence is disabled"),Promise.resolve();let r=(function(s){let o=typeof s=="string"?(function(h){try{return JSON.parse(h)}catch(f){throw new V(A.INVALID_ARGUMENT,"Failed to parse JSON: "+f?.message)}})(s):s,u=[];if(Array.isArray(o.indexes))for(let c of o.indexes){let h=dm(c,"collectionGroup"),f=[];if(Array.isArray(c.fields))for(let m of c.fields){let g=ma("setIndexConfiguration",dm(m,"fieldPath"));m.arrayConfig==="CONTAINS"?f.push(new we(g,2)):m.order==="ASCENDING"?f.push(new we(g,0)):m.order==="DESCENDING"&&f.push(new we(g,1))}u.push(new $e($e.UNKNOWN_ID,h,f,cr.empty()))}return u})(t);return Iv(e,r)}function dm(n,t){if(typeof n[t]!="string")throw new V(A.INVALID_ARGUMENT,"Missing string value for: "+t);return n[t]}var Dl=class{constructor(t){this._firestore=t,this.type="PersistentCacheIndexManager"}};function OI(n){var t;n=Q(n,nt);let e=fm.get(n);if(e)return e;if(((t=lt(n)._uninitializedComponentsProvider)===null||t===void 0?void 0:t._offline.kind)!=="persistent")return null;let r=new Dl(n);return fm.set(n,r),r}function FI(n){Ag(n,!0)}function MI(n){Ag(n,!1)}function LI(n){bv(lt(n._firestore)).then(t=>k("deleting all persistent cache indexes succeeded")).catch(t=>Mt("deleting all persistent cache indexes failed",t))}function Ag(n,t){Tv(lt(n._firestore),t).then(e=>k(`setting persistent cache index auto creation isEnabled=${t} succeeded`)).catch(e=>Mt(`setting persistent cache index auto creation isEnabled=${t} failed`,e))}var fm=new WeakMap;function BI(n){var t;let e=(t=lt(Q(n.firestore,nt))._onlineComponents)===null||t===void 0?void 0:t.datastore.serializer;return e===void 0?null:aa(e,kt(n._query)).Vt}function UI(n,t){var e;let r=km(t,(s,o)=>new ho(o,s.aggregateType,s._internalFieldPath)),i=(e=lt(Q(n.firestore,nt))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return i===void 0?null:vp(i,Xm(n._query),r,!0).request}var mm=class{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(t){return Vl.instance.onExistenceFilterMismatch(t)}},Vl=class n{constructor(){this.Fc=new Map}static get instance(){return js||(js=new n,(function(e){if(fo)throw new Error("a TestingHooksSpi instance is already set");fo=e})(js)),js}ct(t){this.Fc.forEach(e=>e(t))}onExistenceFilterMismatch(t){let e=Symbol(),r=this.Fc;return r.set(e,t),()=>r.delete(e)}},js=null;(function(t,e=!0){(function(i){Dr=i})(jd),ui(new me("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),u=new nt(new Au(r.getProvider("auth-internal")),new Pu(o,r.getProvider("app-check-internal")),(function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new V(A.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new mr(h.options.projectId,f)})(o,i),o);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),$n(Qd,Hd,t),$n(Qd,Hd,"esm2017")})();export{Ed as a,Id as b,hy as c,Td as d,Mv as e,Ps as f,oi as g,Qa as h,Ad as i,ln as j,Lv as k,Bv as l,Uv as m,qv as n,jv as o,Ds as p,fe as q,si as r,zv as s,Yt as t,$v as u,Gv as v,gt as w,me as x,J as y,zn as z,ui as A,ks as B,qd as C,jd as D,h_ as E,zd as F,dE as G,$n as H,SE as I,Mt as J,RE as K,V as L,Tu as M,Xd as N,Si as O,It as P,M as Q,b_ as R,Q as S,ct as T,CE as U,pt as V,mr as W,Av as X,At as Y,ot as Z,oe as _,DE as $,VE as aa,Sv as ba,xE as ca,hg as da,hl as ea,NE as fa,nt as ga,kE as ha,OE as ia,lt as ja,FE as ka,ME as la,LE as ma,BE as na,UE as oa,qE as pa,jE as qa,um as ra,Rv as sa,xn as ta,dl as ua,ve as va,Se as wa,zE as xa,Re as ya,je as za,Ee as Aa,kn as Ba,$E as Ca,ns as Da,GE as Ea,Cr as Fa,KE as Ga,WE as Ha,vl as Ia,QE as Ja,Ho as Ka,HE as La,XE as Ma,Xo as Na,JE as Oa,YE as Pa,Jo as Qa,ZE as Ra,tI as Sa,Yo as Ta,eI as Ua,nI as Va,Dv as Wa,rI as Xa,iI as Ya,re as Za,$t as _a,sI as $a,or as ab,Gt as bb,oI as cb,aI as db,uI as eb,cI as fb,lI as gb,hI as hb,dI as ib,fI as jb,mI as kb,pI as lb,gI as mb,yI as nb,hm as ob,_I as pb,wI as qb,ls as rb,vI as sb,xv as tb,EI as ub,II as vb,TI as wb,bI as xb,Nv as yb,AI as zb,Rl as Ab,Cl as Bb,SI as Cb,RI as Db,PI as Eb,CI as Fb,DI as Gb,VI as Hb,xI as Ib,NI as Jb,kI as Kb,Dl as Lb,OI as Mb,FI as Nb,MI as Ob,LI as Pb,BI as Qb,UI as Rb,mm as Sb};
